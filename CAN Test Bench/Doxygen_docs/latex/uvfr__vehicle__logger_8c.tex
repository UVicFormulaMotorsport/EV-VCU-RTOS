\doxysection{Core/\+Src/uvfr\+\_\+vehicle\+\_\+logger.c File Reference}
\hypertarget{uvfr__vehicle__logger_8c}{}\label{uvfr__vehicle__logger_8c}\index{Core/Src/uvfr\_vehicle\_logger.c@{Core/Src/uvfr\_vehicle\_logger.c}}
{\ttfamily \#include "{}uvfr\+\_\+utils.\+h"{}}\newline
{\ttfamily \#include "{}uvfr\+\_\+state\+\_\+engine.\+h"{}}\newline
{\ttfamily \#include "{}uvfr\+\_\+vehicle\+\_\+logger.\+h"{}}\newline
{\ttfamily \#include "{}can.\+h"{}}\newline
Include dependency graph for uvfr\+\_\+vehicle\+\_\+logger.\+c\+:
% FIG 0
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{uvfr__vehicle__logger_8c_ac4c8e6dfde87119d473a7a456723a685}{MAX\+\_\+\+LOG\+\_\+\+ENTRIES}}~32
\item 
\#define \mbox{\hyperlink{uvfr__vehicle__logger_8c_ac9f21673f6b5bab372190e049308fca1}{LOG\+\_\+\+DUMP\+\_\+\+CAN\+\_\+\+ID}}~0x666
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint32\+\_\+t \mbox{\hyperlink{uvfr__vehicle__logger_8c_a0740a0b8e0f90b9d10e5c6d833f354a1}{get\+System\+Fault\+Flags}} (void)
\item 
void \mbox{\hyperlink{uvfr__vehicle__logger_8c_ad3e144bde2ddbde7303c84f1212ce5bd}{clear\+System\+Fault\+Flags}} (uint32\+\_\+t flags\+\_\+to\+\_\+clear)
\item 
uint8\+\_\+t \mbox{\hyperlink{uvfr__vehicle__logger_8c_a6d1f4ece72fbe83dad38b2c6b2915d23}{get\+Log\+Count}} (void)
\item 
const \mbox{\hyperlink{structvehicle__log__entry}{vehicle\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{uvfr__vehicle__logger_8c_ad631886dcbc57302eb94d953a0f0921e}{get\+Log\+Entry}} (uint8\+\_\+t index)
\item 
void \mbox{\hyperlink{uvfr__vehicle__logger_8c_a112da491c6b8ff895e11674f28381e0e}{dump\+Logs\+To\+UART}} (void)
\item 
void \mbox{\hyperlink{uvfr__vehicle__logger_8c_aa83c417d242e0852d3da6e3df47252f0}{log\+Vehicle\+Fault}} (\mbox{\hyperlink{uvfr__vehicle__logger_8h_a6678121815d6405973fdc68812442fc7}{fault\+\_\+event\+\_\+type\+\_\+e}} type, \mbox{\hyperlink{structuv__task__info}{uv\+\_\+task\+\_\+info}} \texorpdfstring{$\ast$}{*}task, const char \texorpdfstring{$\ast$}{*}msg, const char \texorpdfstring{$\ast$}{*}file, int line, const char \texorpdfstring{$\ast$}{*}func, \mbox{\hyperlink{uvfr__utils_8h_a0ecf26b576b9a54eca656b9be7ba6a06}{bool}} is\+\_\+panic)
\item 
void \mbox{\hyperlink{uvfr__vehicle__logger_8c_aa94a06d1457baf8f7a2bdffc9bdb0f34}{flush\+Logs\+To\+CAN}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{uvfr__vehicle__logger_8c_ac9f21673f6b5bab372190e049308fca1}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!LOG\_DUMP\_CAN\_ID@{LOG\_DUMP\_CAN\_ID}}
\index{LOG\_DUMP\_CAN\_ID@{LOG\_DUMP\_CAN\_ID}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{LOG\_DUMP\_CAN\_ID}{LOG\_DUMP\_CAN\_ID}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_ac9f21673f6b5bab372190e049308fca1} 
\#define LOG\+\_\+\+DUMP\+\_\+\+CAN\+\_\+\+ID~0x666}



Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00022}{22}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



Referenced by \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00155}{flush\+Logs\+To\+CAN()}}.

\Hypertarget{uvfr__vehicle__logger_8c_ac4c8e6dfde87119d473a7a456723a685}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!MAX\_LOG\_ENTRIES@{MAX\_LOG\_ENTRIES}}
\index{MAX\_LOG\_ENTRIES@{MAX\_LOG\_ENTRIES}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{MAX\_LOG\_ENTRIES}{MAX\_LOG\_ENTRIES}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_ac4c8e6dfde87119d473a7a456723a685} 
\#define MAX\+\_\+\+LOG\+\_\+\+ENTRIES~32}



Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00021}{21}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



Referenced by \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00053}{get\+Log\+Count()}}, and \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00097}{log\+Vehicle\+Fault()}}.



\doxysubsection{Function Documentation}
\Hypertarget{uvfr__vehicle__logger_8c_ad3e144bde2ddbde7303c84f1212ce5bd}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!clearSystemFaultFlags@{clearSystemFaultFlags}}
\index{clearSystemFaultFlags@{clearSystemFaultFlags}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{clearSystemFaultFlags()}{clearSystemFaultFlags()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_ad3e144bde2ddbde7303c84f1212ce5bd} 
void clear\+System\+Fault\+Flags (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{flags\+\_\+to\+\_\+clear}{}\end{DoxyParamCaption})}

clears specific fault flags (set bits) from the bitfield 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00046}{46}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.

\Hypertarget{uvfr__vehicle__logger_8c_a112da491c6b8ff895e11674f28381e0e}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!dumpLogsToUART@{dumpLogsToUART}}
\index{dumpLogsToUART@{dumpLogsToUART}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{dumpLogsToUART()}{dumpLogsToUART()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_a112da491c6b8ff895e11674f28381e0e} 
void dump\+Logs\+To\+UART (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

prints all stored logs to UART (e.\+x, for debugging) 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00068}{68}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



References \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00047}{vehicle\+\_\+log\+\_\+entry\+::file}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00049}{vehicle\+\_\+log\+\_\+entry\+::func}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00053}{get\+Log\+Count()}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00060}{get\+Log\+Entry()}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00050}{vehicle\+\_\+log\+\_\+entry\+::is\+\_\+panic}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00048}{vehicle\+\_\+log\+\_\+entry\+::line}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00045}{vehicle\+\_\+log\+\_\+entry\+::msg}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00051}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+id}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00044}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+name}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00053}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+state}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00046}{vehicle\+\_\+log\+\_\+entry\+::timestamp}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00043}{vehicle\+\_\+log\+\_\+entry\+::type}}, and \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00052}{vehicle\+\_\+log\+\_\+entry\+::vehicle\+\_\+state}}.

Here is the call graph for this function\+:
% FIG 1
\Hypertarget{uvfr__vehicle__logger_8c_aa94a06d1457baf8f7a2bdffc9bdb0f34}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!flushLogsToCAN@{flushLogsToCAN}}
\index{flushLogsToCAN@{flushLogsToCAN}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{flushLogsToCAN()}{flushLogsToCAN()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_aa94a06d1457baf8f7a2bdffc9bdb0f34} 
void flush\+Logs\+To\+CAN (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

Flush all current log entries out over CAN for diagnostic laptop tools. Each entry is sent as a single compact CAN frame.

Frame layout\+: ID = LOG\+\_\+\+DUMP\+\_\+\+CAN\+\_\+\+ID DLC = 8 Byte 0 \+: fault type Byte 1 \+: timestamp LSB Byte 2 \+: timestamp MSB Byte 3 \+: task ID Byte 4 \+: is\+\_\+panic flag Byte 5 \+: vehicle\+\_\+state Byte 6 \+: reserved (0) Byte 7 \+: reserved (0) 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00155}{155}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



References \mbox{\hyperlink{uvfr__utils_8h_source_l00289}{uv\+\_\+\+CAN\+\_\+msg\+::data}}, \mbox{\hyperlink{uvfr__utils_8h_source_l00287}{uv\+\_\+\+CAN\+\_\+msg\+::dlc}}, \mbox{\hyperlink{uvfr__utils_8h_source_l00283}{uv\+\_\+\+CAN\+\_\+msg\+::flags}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00053}{get\+Log\+Count()}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00060}{get\+Log\+Entry()}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00050}{vehicle\+\_\+log\+\_\+entry\+::is\+\_\+panic}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00022}{LOG\+\_\+\+DUMP\+\_\+\+CAN\+\_\+\+ID}}, \mbox{\hyperlink{uvfr__utils_8h_source_l00288}{uv\+\_\+\+CAN\+\_\+msg\+::msg\+\_\+id}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00051}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+id}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00046}{vehicle\+\_\+log\+\_\+entry\+::timestamp}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00043}{vehicle\+\_\+log\+\_\+entry\+::type}}, \mbox{\hyperlink{can_8c_source_l00864}{uv\+Send\+Can\+MSG()}}, and \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00052}{vehicle\+\_\+log\+\_\+entry\+::vehicle\+\_\+state}}.



Referenced by \mbox{\hyperlink{uvfr__settings_8c_source_l00160}{handle\+Incoming\+Laptop\+Msg()}}.

Here is the call graph for this function\+:
% FIG 2
\Hypertarget{uvfr__vehicle__logger_8c_a6d1f4ece72fbe83dad38b2c6b2915d23}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!getLogCount@{getLogCount}}
\index{getLogCount@{getLogCount}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{getLogCount()}{getLogCount()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_a6d1f4ece72fbe83dad38b2c6b2915d23} 
uint8\+\_\+t get\+Log\+Count (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

returns how many logs are stored right now 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00053}{53}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



References \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00021}{MAX\+\_\+\+LOG\+\_\+\+ENTRIES}}.



Referenced by \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00068}{dump\+Logs\+To\+UART()}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00155}{flush\+Logs\+To\+CAN()}}, and \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00060}{get\+Log\+Entry()}}.

\Hypertarget{uvfr__vehicle__logger_8c_ad631886dcbc57302eb94d953a0f0921e}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!getLogEntry@{getLogEntry}}
\index{getLogEntry@{getLogEntry}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{getLogEntry()}{getLogEntry()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_ad631886dcbc57302eb94d953a0f0921e} 
const \mbox{\hyperlink{structvehicle__log__entry}{vehicle\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*} get\+Log\+Entry (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{index}{}\end{DoxyParamCaption})}

returns a specific log entry by index 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00060}{60}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



References \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00053}{get\+Log\+Count()}}.



Referenced by \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00068}{dump\+Logs\+To\+UART()}}, and \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00155}{flush\+Logs\+To\+CAN()}}.

Here is the call graph for this function\+:
% FIG 3
\Hypertarget{uvfr__vehicle__logger_8c_a0740a0b8e0f90b9d10e5c6d833f354a1}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!getSystemFaultFlags@{getSystemFaultFlags}}
\index{getSystemFaultFlags@{getSystemFaultFlags}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{getSystemFaultFlags()}{getSystemFaultFlags()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_a0740a0b8e0f90b9d10e5c6d833f354a1} 
uint32\+\_\+t get\+System\+Fault\+Flags (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

returns the current bitfield (1 bit per fault type) 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00039}{39}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.

\Hypertarget{uvfr__vehicle__logger_8c_aa83c417d242e0852d3da6e3df47252f0}\index{uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}!logVehicleFault@{logVehicleFault}}
\index{logVehicleFault@{logVehicleFault}!uvfr\_vehicle\_logger.c@{uvfr\_vehicle\_logger.c}}
\doxysubsubsection{\texorpdfstring{logVehicleFault()}{logVehicleFault()}}
{\footnotesize\ttfamily \label{uvfr__vehicle__logger_8c_aa83c417d242e0852d3da6e3df47252f0} 
void log\+Vehicle\+Fault (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{uvfr__vehicle__logger_8h_a6678121815d6405973fdc68812442fc7}{fault\+\_\+event\+\_\+type\+\_\+e}}}]{type}{, }\item[{\mbox{\hyperlink{structuv__task__info}{uv\+\_\+task\+\_\+info}} \texorpdfstring{$\ast$}{*}}]{task}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{msg}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{file}{, }\item[{int}]{line}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{func}{, }\item[{\mbox{\hyperlink{uvfr__utils_8h_a0ecf26b576b9a54eca656b9be7ba6a06}{bool}}}]{is\+\_\+panic}{}\end{DoxyParamCaption})}

adds a new log entry for a fault or error. 

Definition at line \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00097}{97}} of file \mbox{\hyperlink{uvfr__vehicle__logger_8c_source}{uvfr\+\_\+vehicle\+\_\+logger.\+c}}.



References \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00047}{vehicle\+\_\+log\+\_\+entry\+::file}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00049}{vehicle\+\_\+log\+\_\+entry\+::func}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00050}{vehicle\+\_\+log\+\_\+entry\+::is\+\_\+panic}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00048}{vehicle\+\_\+log\+\_\+entry\+::line}}, \mbox{\hyperlink{uvfr__vehicle__logger_8c_source_l00021}{MAX\+\_\+\+LOG\+\_\+\+ENTRIES}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00045}{vehicle\+\_\+log\+\_\+entry\+::msg}}, \mbox{\hyperlink{uvfr__state__engine_8h_source_l00228}{uv\+\_\+task\+\_\+info\+::task\+\_\+id}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00051}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+id}}, \mbox{\hyperlink{uvfr__state__engine_8h_source_l00229}{uv\+\_\+task\+\_\+info\+::task\+\_\+name}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00044}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+name}}, \mbox{\hyperlink{uvfr__state__engine_8h_source_l00243}{uv\+\_\+task\+\_\+info\+::task\+\_\+state}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00053}{vehicle\+\_\+log\+\_\+entry\+::task\+\_\+state}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00046}{vehicle\+\_\+log\+\_\+entry\+::timestamp}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00043}{vehicle\+\_\+log\+\_\+entry\+::type}}, \mbox{\hyperlink{uvfr__state__engine_8h_source_l00132}{UV\+\_\+\+TASK\+\_\+\+NOT\+\_\+\+STARTED}}, \mbox{\hyperlink{uvfr__vehicle__logger_8h_source_l00052}{vehicle\+\_\+log\+\_\+entry\+::vehicle\+\_\+state}}, and \mbox{\hyperlink{uvfr__state__engine_8c_source_l00038}{vehicle\+\_\+state}}.



Referenced by \mbox{\hyperlink{uvfr__state__engine_8c_source_l00708}{\+\_\+\+\_\+uv\+Panic()}}.

