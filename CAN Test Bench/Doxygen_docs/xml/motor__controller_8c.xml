<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.12.0" xml:lang="en-US">
  <compounddef id="motor__controller_8c" kind="file" language="C++">
    <compoundname>motor_controller.c</compoundname>
    <includes refid="motor__controller_8h" local="yes">motor_controller.h</includes>
    <includes refid="can_8h" local="yes">can.h</includes>
    <includes refid="uvfr__utils_8h" local="yes">uvfr_utils.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">stdio.h</includes>
    <includes refid="uvfr__settings_8h" local="yes">uvfr_settings.h</includes>
    <includes refid="cmsis__os_8h" local="yes">cmsis_os.h</includes>
    <incdepgraph>
      <node id="34">
        <label>cmsis_os.h</label>
        <link refid="cmsis__os_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>FreeRTOS.h</label>
        <link refid="_free_r_t_o_s_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="23">
        <label>FreeRTOSConfig.h</label>
        <link refid="_free_r_t_o_s_config_8h"/>
      </node>
      <node id="26">
        <label>deprecated_definitions.h</label>
        <link refid="deprecated__definitions_8h"/>
      </node>
      <node id="35">
        <label>event_groups.h</label>
        <link refid="event__groups_8h"/>
        <childnode refid="36" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>list.h</label>
        <link refid="list_8h"/>
      </node>
      <node id="37">
        <label>message_buffer.h</label>
        <link refid="message__buffer_8h"/>
        <childnode refid="38" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>mpu_wrappers.h</label>
        <link refid="mpu__wrappers_8h"/>
      </node>
      <node id="25">
        <label>portable.h</label>
        <link refid="portable_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="24">
        <label>projdefs.h</label>
        <link refid="projdefs_8h"/>
      </node>
      <node id="32">
        <label>queue.h</label>
        <link refid="queue_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>semphr.h</label>
        <link refid="semphr_8h"/>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="38">
        <label>stream_buffer.h</label>
        <link refid="stream__buffer_8h"/>
      </node>
      <node id="30">
        <label>task.h</label>
        <link refid="task_8h"/>
        <childnode refid="31" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>timers.h</label>
        <link refid="timers_8h"/>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="27">
        <label>portmacro.h</label>
        <link refid="portmacro_8h"/>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>adc.h</label>
        <link refid="adc_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>bms.h</label>
        <link refid="bms_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>can.h</label>
        <link refid="can_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>constants.h</label>
        <link refid="constants_8h"/>
      </node>
      <node id="16">
        <label>daq.h</label>
        <link refid="daq_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="42">
        <label>dash.h</label>
        <link refid="dash_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>dma.h</label>
        <link refid="dma_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>driving_loop.h</label>
        <link refid="driving__loop_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>gpio.h</label>
        <link refid="gpio_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="43">
        <label>imd.h</label>
        <link refid="imd_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>main.h</label>
        <link refid="main_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>motor_controller.h</label>
        <link refid="motor__controller_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="48">
        <label>odometer.h</label>
        <link refid="odometer_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="44">
        <label>pdu.h</label>
        <link refid="pdu_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>rb_tree.h</label>
        <link refid="rb__tree_8h"/>
      </node>
      <node id="47">
        <label>temp_monitoring.h</label>
        <link refid="temp__monitoring_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>tim.h</label>
        <link refid="tim_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>uvfr_conifer.h</label>
        <link refid="uvfr__conifer_8h"/>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="39">
        <label>uvfr_diagnostics.h</label>
        <link refid="uvfr__diagnostics_8h"/>
        <childnode refid="40" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>uvfr_global_config.h</label>
        <link refid="uvfr__global__config_8h"/>
      </node>
      <node id="14">
        <label>uvfr_settings.h</label>
        <link refid="uvfr__settings_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>uvfr_state_engine.h</label>
        <link refid="uvfr__state__engine_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>uvfr_utils.h</label>
        <link refid="uvfr__utils_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="41">
        <label>uvfr_vehicle_commands.h</label>
        <link refid="uvfr__vehicle__commands_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="46">
        <label>uvfr_vehicle_logger.h</label>
        <link refid="uvfr__vehicle__logger_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>Core/Src/motor_controller.c</label>
        <link refid="motor__controller_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>stdarg.h</label>
      </node>
      <node id="21">
        <label>stddef.h</label>
      </node>
      <node id="22">
        <label>stdint.h</label>
      </node>
      <node id="49">
        <label>stdio.h</label>
      </node>
      <node id="28">
        <label>stdlib.h</label>
      </node>
      <node id="4">
        <label>stm32f4xx_hal.h</label>
      </node>
      <node id="40">
        <label>string.h</label>
      </node>
    </incdepgraph>
    <sectiondef kind="define">
      <memberdef kind="define" id="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" prot="public" static="no">
        <name>mc_settings</name>
        <initializer>(<ref refid="uvfr__settings_8h_1a03566822d1b8893362970a459bd67daf" kindref="member">current_vehicle_settings</ref>-&gt;mc_settings)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="16" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="16" bodyend="-1"/>
        <referencedby refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" compoundref="motor__controller_8c" startline="407" endline="436">MC_EnableCyclicSpeedTransmission</referencedby>
        <referencedby refid="motor__controller_8h_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" compoundref="motor__controller_8c" startline="110" endline="125">MC_Request_Data</referencedby>
        <referencedby refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" compoundref="motor__controller_8c" startline="141" endline="159">MC_Set_Param</referencedby>
        <referencedby refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" compoundref="motor__controller_8c" startline="458" endline="536">MC_Startup</referencedby>
        <referencedby refid="motor__controller_8h_1ae71f2a8631fd64b7d7ce321470d4fab0" compoundref="motor__controller_8c" startline="69" endline="103">sendTorqueToMotorController</referencedby>
      </memberdef>
    </sectiondef>
    <sectiondef kind="var">
      <memberdef kind="variable" id="motor__controller_8c_1a03566822d1b8893362970a459bd67daf" prot="public" static="no" extern="yes" mutable="no">
        <type><ref refid="structuv__vehicle__settings" kindref="compound">uv_vehicle_settings</ref> *</type>
        <definition>uv_vehicle_settings* current_vehicle_settings</definition>
        <argsstring></argsstring>
        <name>current_vehicle_settings</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="12" column="28" bodyfile="Core/Src/uvfr_settings.c" bodystart="25" bodyend="-1" declfile="Core/Src/motor_controller.c" declline="12" declcolumn="28"/>
        <referencedby refid="uvfr__settings_8h_1add1ebdaa7f93f2a43ca6afc6e05fdd44" compoundref="uvfr__settings_8c" startline="250" endline="275">setupDefaultSettings</referencedby>
        <referencedby refid="uvfr__settings_8c_1ae9ab130db00266635709bb7fb72c1844" compoundref="uvfr__settings_8c" startline="294" endline="322">uvLoadSettingsFromFlash</referencedby>
        <referencedby refid="uvfr__settings_8h_1a80856a38d7040ca10b8106ff0fa4acf4" compoundref="uvfr__settings_8c" startline="359" endline="432">uvSettingsInit</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1aeb37f26e053d2887099e01f7fcfb62d5" prot="public" static="no" extern="yes" mutable="no">
        <type><ref refid="queue_8h_1a57349603001f8ddf51c888c49e2804d7" kindref="member">QueueHandle_t</ref></type>
        <definition>QueueHandle_t CAN_Rx_Queue</definition>
        <argsstring></argsstring>
        <name>CAN_Rx_Queue</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="13" column="22" declfile="Core/Src/motor_controller.c" declline="13" declcolumn="22"/>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" prot="public" static="no" mutable="no">
        <type><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref></type>
        <definition>uv_CAN_msg last_mc_response</definition>
        <argsstring></argsstring>
        <name>last_mc_response</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="22" column="12" bodyfile="Core/Src/motor_controller.c" bodystart="22" bodyend="-1"/>
        <referencedby refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" compoundref="motor__controller_8c" startline="175" endline="213">MC_SetAndVerify_Param</referencedby>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1a01068b62ae077af823a3ff2339589a5a" prot="public" static="no" mutable="no">
        <type><ref refid="portmacro_8h_1aa69c48c6e902ce54f70886e6573c92a9" kindref="member">TickType_t</ref></type>
        <definition>TickType_t last_driver_input_time</definition>
        <argsstring></argsstring>
        <name>last_driver_input_time</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="24" column="12" bodyfile="Core/Src/motor_controller.c" bodystart="24" bodyend="-1"/>
        <referencedby refid="driving__loop_8h_1a80cc48f06202edc29bcad26a956bcc98" compoundref="driving__loop_8c" startline="254" endline="397">StartDrivingLoop</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1ab2f9a165135f6377e587c0a1e196c18e" prot="public" static="no" mutable="no">
        <type>int16_t</type>
        <definition>int16_t mc_speed_rpm</definition>
        <argsstring></argsstring>
        <name>mc_speed_rpm</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="27" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="27" bodyend="-1"/>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1a399e00d21730a80f94ac96c6b3d9d729" prot="public" static="no" mutable="no">
        <type>int16_t</type>
        <definition>int16_t mc_current</definition>
        <argsstring></argsstring>
        <name>mc_current</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="28" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="28" bodyend="-1"/>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1adfaaabb45aef6c2b8bf7fb35a5d3d37a" prot="public" static="no" mutable="no">
        <type>int16_t</type>
        <definition>int16_t mc_torque_cmd</definition>
        <argsstring></argsstring>
        <name>mc_torque_cmd</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="29" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="29" bodyend="-1"/>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1addd0636fe19f64a68688fb4c64eb8d9a" prot="public" static="no" mutable="no">
        <type>int16_t</type>
        <definition>int16_t mc_motor_temp</definition>
        <argsstring></argsstring>
        <name>mc_motor_temp</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="30" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="30" bodyend="-1"/>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1a1edd8dace1c45eaa85bb105f903248de" prot="public" static="no" mutable="no">
        <type>int16_t</type>
        <definition>int16_t mc_igbt_temp</definition>
        <argsstring></argsstring>
        <name>mc_igbt_temp</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="31" column="9" bodyfile="Core/Src/motor_controller.c" bodystart="31" bodyend="-1"/>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="variable" id="motor__controller_8c_1afb41a96439ba6d63dcc64f257c43a1d2" prot="public" static="no" mutable="no">
        <type><ref refid="structmotor__controller__settings" kindref="compound">motor_controller_settings</ref></type>
        <definition>motor_controller_settings mc_default_settings</definition>
        <argsstring></argsstring>
        <name>mc_default_settings</name>
        <initializer>= {
    .can_id_tx              = 0x201,
    .can_id_rx              = 0x181,
    .mc_CAN_timeout         = 2,
    .<ref refid="motor__controller_8h_1a3f03fa29b56b9f1f2cf0a36f989f9521a2b83ac91fbacf438199c4515ae3dcb88" kindref="member">proportional_gain</ref>      = 10,   
    .<ref refid="motor__controller_8h_1a3f03fa29b56b9f1f2cf0a36f989f9521a39318ae4bc4582c26c32b7748f64c8d4" kindref="member">integral_time_constant</ref> = 400,  
    .<ref refid="motor__controller_8h_1a3f03fa29b56b9f1f2cf0a36f989f9521aa1022b52e56d3a918c7a62177a88bb9e" kindref="member">integral_memory_max</ref>    = 60,    

    
    .max_speed              = 12357,   
    .max_current            = 13107,   
    .cont_current           = 7864,    
    .max_torque             = 32767,   
    .<ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645afe594d99cc90d2fff45e0107f9e52f0f" kindref="member">max_motor_temp</ref>         = 32767,   
	.<ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a201a49da019d5cf651ff2ec75ef27b10" kindref="member">warning_motor_temp</ref>		= 32767,	

	.mc_bus 				= <ref refid="uvfr__utils_8h_1a68cc2bdb140f7959b6090b771f3358a9" kindref="member">CAN_BUS_1</ref>
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="38" column="27" bodyfile="Core/Src/motor_controller.c" bodystart="38" bodyend="55"/>
        <referencedby refid="uvfr__settings_8h_1add1ebdaa7f93f2a43ca6afc6e05fdd44" compoundref="uvfr__settings_8c" startline="250" endline="275">setupDefaultSettings</referencedby>
        <referencedby refid="uvfr__settings_8c_1a5f5ab3b99bc259455a2ec79144422450" compoundref="uvfr__settings_8c" startline="1155" endline="1236">uvResetFlashToDefault</referencedby>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="motor__controller_8c_1ae71f2a8631fd64b7d7ce321470d4fab0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint16_t</type>
        <definition>uint16_t sendTorqueToMotorController</definition>
        <argsstring>(float T_filtered)</argsstring>
        <name>sendTorqueToMotorController</name>
        <param>
          <type>float</type>
          <declname>T_filtered</declname>
        </param>
        <briefdescription>
<para>Sends a filtered torque command to the motor controller over CAN. </para>
        </briefdescription>
        <detaileddescription>
<para>This function scales the input torque (in Nm) to the Bamocar&apos;s expected format, clamps it within the valid operating range, and transmits it as a direct torque command using the N_set register. The final 16-bit value is sent via CAN using the configured transmit ID.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>T_filtered</parametername>
</parameternamelist>
<parameterdescription>
<para>The final torque value in Nm after filtering (typically 0–230 Nm). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if successful, 1 if transmission failed. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="69" column="10" bodyfile="Core/Src/motor_controller.c" bodystart="69" bodyend="103"/>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
        <references refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" compoundref="uvfr__utils_8h" startline="283">uv_CAN_msg::flags</references>
        <references refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" compoundref="motor__controller_8c" startline="16">mc_settings</references>
        <references refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" compoundref="uvfr__utils_8h" startline="288">uv_CAN_msg::msg_id</references>
        <references refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268aa53daf1b53f678af8159cba9238c5e6f" compoundref="motor__controller_8h" startline="28">N_set</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" compoundref="uvfr__utils_8h" startline="174">UV_OK</references>
        <references refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" compoundref="can_8c" startline="864" endline="910">uvSendCanMSG</references>
        <referencedby refid="driving__loop_8h_1a80cc48f06202edc29bcad26a956bcc98" compoundref="driving__loop_8c" startline="254" endline="397">StartDrivingLoop</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void MC_Request_Data</definition>
        <argsstring>(uint8_t RegID)</argsstring>
        <name>MC_Request_Data</name>
        <param>
          <type>uint8_t</type>
          <declname>RegID</declname>
        </param>
        <briefdescription>
<para>Sends a CAN request to retrieve a specific register from the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>The request message is formatted as: [0x3D, RegID, 0], which should trigger an immediate reply. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="110" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="110" bodyend="125"/>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
        <references refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" compoundref="uvfr__utils_8h" startline="283">uv_CAN_msg::flags</references>
        <references refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" compoundref="motor__controller_8c" startline="16">mc_settings</references>
        <references refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" compoundref="uvfr__utils_8h" startline="288">uv_CAN_msg::msg_id</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" compoundref="uvfr__utils_8h" startline="174">UV_OK</references>
        <references refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" compoundref="can_8c" startline="864" endline="910">uvSendCanMSG</references>
        <referencedby refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" compoundref="motor__controller_8c" startline="175" endline="213">MC_SetAndVerify_Param</referencedby>
        <referencedby refid="motor__controller_8h_1ad5f29647a349035990d49fe100bb740b" compoundref="motor__controller_8c" startline="548" endline="570">MC_Shutdown</referencedby>
        <referencedby refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" compoundref="motor__controller_8c" startline="458" endline="536">MC_Startup</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="can_8h_1aef3770e45bbacbf527fd93dd80eea9b9" kindref="member">uv_status</ref></type>
        <definition>uv_status MC_Set_Param</definition>
        <argsstring>(uint8_t RegID, uint16_t d)</argsstring>
        <name>MC_Set_Param</name>
        <param>
          <type>uint8_t</type>
          <declname>RegID</declname>
        </param>
        <param>
          <type>uint16_t</type>
          <declname>d</declname>
        </param>
        <briefdescription>
<para>Sends a parameter write command to the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>Constructs a 3-byte CAN message to set the value of a specific register on the motor controller. The message format is: [RegID, LSB(data), MSB(data), 0x00]</para>
<para>This function does not verify the result—use <ref refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" kindref="member">MC_SetAndVerify_Param()</ref> for value confirmation.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>RegID</parametername>
</parameternamelist>
<parameterdescription>
<para>The register address to be written. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>d</parametername>
</parameternamelist>
<parameterdescription>
<para>The 16-bit value to write to the register. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>UV_OK on success, UV_ERROR if the CAN transmission fails. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="141" column="11" bodyfile="Core/Src/motor_controller.c" bodystart="141" bodyend="159"/>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
        <references refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" compoundref="uvfr__utils_8h" startline="283">uv_CAN_msg::flags</references>
        <references refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" compoundref="motor__controller_8c" startline="16">mc_settings</references>
        <references refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" compoundref="uvfr__utils_8h" startline="288">uv_CAN_msg::msg_id</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" compoundref="uvfr__utils_8h" startline="176">UV_ERROR</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" compoundref="uvfr__utils_8h" startline="174">UV_OK</references>
        <references refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" compoundref="can_8c" startline="864" endline="910">uvSendCanMSG</references>
        <referencedby refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" compoundref="motor__controller_8c" startline="175" endline="213">MC_SetAndVerify_Param</referencedby>
        <referencedby refid="motor__controller_8h_1ad5f29647a349035990d49fe100bb740b" compoundref="motor__controller_8c" startline="548" endline="570">MC_Shutdown</referencedby>
        <referencedby refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" compoundref="motor__controller_8c" startline="458" endline="536">MC_Startup</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="can_8h_1aef3770e45bbacbf527fd93dd80eea9b9" kindref="member">uv_status</ref></type>
        <definition>uv_status MC_SetAndVerify_Param</definition>
        <argsstring>(uint8_t reg_id, uint16_t set_val)</argsstring>
        <name>MC_SetAndVerify_Param</name>
        <param>
          <type>uint8_t</type>
          <declname>reg_id</declname>
        </param>
        <param>
          <type>uint16_t</type>
          <declname>set_val</declname>
        </param>
        <briefdescription>
<para>Writes a value to a motor controller register and verifies the write. </para>
        </briefdescription>
        <detaileddescription>
<para>Sends a parameter set command to the specified register, then requests the value back and compares the response to ensure the write succeeded. Uses little-endian 16-bit parsing for verification.</para>
<para>This is a safer alternative to <ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param()</ref> when reliability is critical.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>reg_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The target register address to write. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>set_val</parametername>
</parameternamelist>
<parameterdescription>
<para>The 16-bit value to write to the register. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>UV_OK if the write and verification succeeded, otherwise UV_ERROR. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="175" column="11" bodyfile="Core/Src/motor_controller.c" bodystart="175" bodyend="213"/>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" compoundref="motor__controller_8c" startline="22">last_mc_response</references>
        <references refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" compoundref="motor__controller_8c" startline="110" endline="125">MC_Request_Data</references>
        <references refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" compoundref="motor__controller_8c" startline="141" endline="159">MC_Set_Param</references>
        <references refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" compoundref="projdefs_8h" startline="41">pdMS_TO_TICKS</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" compoundref="uvfr__utils_8h" startline="176">UV_ERROR</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" compoundref="uvfr__utils_8h" startline="174">UV_OK</references>
        <references refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3">vTaskDelay</references>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1a98ef1edcc51198faf53767e8d92ce4c9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void Parse_Bamocar_Response</definition>
        <argsstring>(uv_CAN_msg *msg)</argsstring>
        <name>Parse_Bamocar_Response</name>
        <param>
          <type><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref> *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
<para>Parses a 32-bit value from a CAN message in little-endian format. </para>
        </briefdescription>
        <detaileddescription>
<para>This example assumes that the data bytes are stored as: data[0] = LSB, data[3] = MSB. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="221" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="221" bodyend="232"/>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void MotorControllerErrorHandler_16bitLE</definition>
        <argsstring>(uint8_t *data, uint8_t length)</argsstring>
        <name>MotorControllerErrorHandler_16bitLE</name>
        <param>
          <type>uint8_t *</type>
          <declname>data</declname>
        </param>
        <param>
          <type>uint8_t</type>
          <declname>length</declname>
        </param>
        <briefdescription>
<para>Parses and handles a 16-bit error/warning field from the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>This function expects a 2-byte little-endian error field: data[0] = LSB, data[1] = MSB</para>
<para>It checks the resulting bitfield for critical error flags and calls uvPanic() for any fault conditions that require an immediate stop.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>Pointer to the error data array (must be at least 2 bytes). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>length</parametername>
</parameternamelist>
<parameterdescription>
<para>Length of the data array (must be &gt;= 2). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="247" column="13" bodyfile="Core/Src/motor_controller.c" bodystart="247" bodyend="306"/>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa0dbc9540bf7a4c67b6a2810985bfb55d" compoundref="motor__controller_8h" startline="114">AC_current_offset_fault</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa150953c78b7fcc8ae97a50a5b5765264" compoundref="motor__controller_8h" startline="116">bleed_resistor_overload</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa425430d2585733363b6043ed70ebd7ab" compoundref="motor__controller_8h" startline="102">CAN_timeout_error</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa29aa452fe3c693b96c17c09849ee1633" compoundref="motor__controller_8h" startline="110">critical_AC_current</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa0dd2c6834f96df064d7b152074a9f81f" compoundref="motor__controller_8h" startline="112">ecode_timeout_error</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa87ada8cd125ba521b447d565c12bb30e" compoundref="motor__controller_8h" startline="99">eprom_read_error</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa2a16f371b0570edeeb17214a398e4bfc" compoundref="motor__controller_8h" startline="103">feedback_signal_error</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffae9da794167969482cb67bfad83a04d71" compoundref="motor__controller_8h" startline="100">hardware_fault</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa54a5ca5981535fd231b00a1040622950" compoundref="motor__controller_8h" startline="106">IGBT_temp_max_limit</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa18df3363e2a0048a813dcef5a41785ce" compoundref="motor__controller_8h" startline="115">internal_hardware_voltage_problem</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa229533ef674ddd4475b22e47eb506b49" compoundref="motor__controller_8h" startline="109">mains_voltage_max_limit</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa13726d0d6fc8dd12135f4ea92d1dcc92" compoundref="motor__controller_8h" startline="104">mains_voltage_min_limit</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa2267f6ae60d8b9024ba418dd1f6d4b15" compoundref="motor__controller_8h" startline="105">motor_temp_max_limit</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa696b36face7279e19e2905b0fa9ecb68" compoundref="motor__controller_8h" startline="111">race_away_detected</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffadae8b5f4fb6cd6712202d055529499ef" compoundref="motor__controller_8h" startline="101">rotate_field_enable_not_present_run</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa357611869a1ec791b38a36ec2dfe09b9" compoundref="motor__controller_8h" startline="113">watchdog_reset</references>
        <referencedby refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1aaff68bb563bf4ad56841a5a5020cbadc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ProcessMotorControllerResponse</definition>
        <argsstring>(uv_CAN_msg *msg)</argsstring>
        <name>ProcessMotorControllerResponse</name>
        <param>
          <type><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref> *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
<para>Processes a CAN response from the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>This function decodes a received CAN message by examining the register ID in the first byte (data[0]) and handling the response accordingly.</para>
<para>It performs little-endian parsing to extract values for speed, current, torque, temperatures, and error flags. Critical errors will trigger uvPanic() via the error handler.</para>
<para>The full message is also stored in a global buffer (last_mc_response) for later access and verification routines.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>msg</parametername>
</parameternamelist>
<parameterdescription>
<para>Pointer to the received CAN message from the motor controller. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="324" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="324" bodyend="392"/>
        <references refid="motor__controller_8h_1aefe525453e2d5fb5ff19de9f98247c7ca08745ee38252c5952330efe1591df091" compoundref="motor__controller_8h" startline="46">CURRENT_ACTUAL</references>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a349799caa493b390c9527db251fd128c" compoundref="motor__controller_8h" startline="74">igbt_temperature</references>
        <references refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" compoundref="motor__controller_8c" startline="22">last_mc_response</references>
        <references refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda0065463d68046f7a361ad1b060548b27" compoundref="motor__controller_8h" startline="38">LOGIMAP_ERRORS</references>
        <references refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda887c38d92ef273b6fae58dcb51931765" compoundref="motor__controller_8h" startline="39">LOGIMAP_IO</references>
        <references refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268ac53068c686a03da9dbdc2e20ea07a8d0" compoundref="motor__controller_8h" startline="33">M_out</references>
        <references refid="motor__controller_8c_1a399e00d21730a80f94ac96c6b3d9d729" compoundref="motor__controller_8c" startline="28">mc_current</references>
        <references refid="motor__controller_8c_1a1edd8dace1c45eaa85bb105f903248de" compoundref="motor__controller_8c" startline="31">mc_igbt_temp</references>
        <references refid="motor__controller_8c_1addd0636fe19f64a68688fb4c64eb8d9a" compoundref="motor__controller_8c" startline="30">mc_motor_temp</references>
        <references refid="motor__controller_8c_1ab2f9a165135f6377e587c0a1e196c18e" compoundref="motor__controller_8c" startline="27">mc_speed_rpm</references>
        <references refid="motor__controller_8c_1adfaaabb45aef6c2b8bf7fb35a5d3d37a" compoundref="motor__controller_8c" startline="29">mc_torque_cmd</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa595211bb6640ca05c1c3344b47e2890f" compoundref="motor__controller_8h" startline="95">motor_controller_errors_warnings</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645aeff9dce22875056570afa6b71fd23842" compoundref="motor__controller_8h" startline="78">motor_temperature</references>
        <references refid="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" compoundref="motor__controller_8c" startline="247" endline="306">MotorControllerErrorHandler_16bitLE</references>
        <references refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268a74ac68aa19b65409fa9b18b8f2be3bf4" compoundref="motor__controller_8h" startline="27">N_actual</references>
        <references refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda75b5d9cefe36e570d9e0c306fb0e22fc" compoundref="motor__controller_8h" startline="40">POS_ACTUAL</references>
        <referencedby refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" compoundref="motor__controller_8c" startline="458" endline="536">MC_Startup</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void MC_EnableCyclicSpeedTransmission</definition>
        <argsstring>(uint8_t interval_ms)</argsstring>
        <name>MC_EnableCyclicSpeedTransmission</name>
        <param>
          <type>uint8_t</type>
          <declname>interval_ms</declname>
        </param>
        <briefdescription>
<para>Enables or disables cyclic transmission of selected motor controller parameters. </para>
        </briefdescription>
        <detaileddescription>
<para>Sends a series of CAN messages to configure the Bamocar controller to periodically transmit values such as speed, current, torque, temperatures, and error flags.</para>
<para>The message format is: [0x3D, RegID, interval_ms] Where interval_ms is the repeat interval in milliseconds (1–254). Passing 0xFF disables transmission for that register.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>interval_ms</parametername>
</parameternamelist>
<parameterdescription>
<para>Transmission interval in milliseconds (1–254). Use 0xFF to disable. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="407" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="407" bodyend="436"/>
        <references refid="motor__controller_8h_1aefe525453e2d5fb5ff19de9f98247c7ca08745ee38252c5952330efe1591df091" compoundref="motor__controller_8h" startline="46">CURRENT_ACTUAL</references>
        <references refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" compoundref="uvfr__utils_8h" startline="289">uv_CAN_msg::data</references>
        <references refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" compoundref="uvfr__utils_8h" startline="287">uv_CAN_msg::dlc</references>
        <references refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" compoundref="uvfr__utils_8h" startline="283">uv_CAN_msg::flags</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a349799caa493b390c9527db251fd128c" compoundref="motor__controller_8h" startline="74">igbt_temperature</references>
        <references refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda0065463d68046f7a361ad1b060548b27" compoundref="motor__controller_8h" startline="38">LOGIMAP_ERRORS</references>
        <references refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268ac53068c686a03da9dbdc2e20ea07a8d0" compoundref="motor__controller_8h" startline="33">M_out</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645afe594d99cc90d2fff45e0107f9e52f0f" compoundref="motor__controller_8h" startline="76">max_motor_temp</references>
        <references refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" compoundref="motor__controller_8c" startline="16">mc_settings</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645aeff9dce22875056570afa6b71fd23842" compoundref="motor__controller_8h" startline="78">motor_temperature</references>
        <references refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" compoundref="uvfr__utils_8h" startline="288">uv_CAN_msg::msg_id</references>
        <references refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268a74ac68aa19b65409fa9b18b8f2be3bf4" compoundref="motor__controller_8h" startline="27">N_actual</references>
        <references refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" compoundref="projdefs_8h" startline="41">pdMS_TO_TICKS</references>
        <references refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" compoundref="can_8c" startline="864" endline="910">uvSendCanMSG</references>
        <references refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3">vTaskDelay</references>
        <references refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a201a49da019d5cf651ff2ec75ef27b10" compoundref="motor__controller_8h" startline="77">warning_motor_temp</references>
        <referencedby refid="motor__controller_8h_1ad5f29647a349035990d49fe100bb740b" compoundref="motor__controller_8c" startline="548" endline="570">MC_Shutdown</referencedby>
        <referencedby refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" compoundref="motor__controller_8c" startline="458" endline="536">MC_Startup</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1aed1407e1e0fd59dc7c5e5d6db671f0ab" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void MC_Startup</definition>
        <argsstring>(void *args)</argsstring>
        <name>MC_Startup</name>
        <param>
          <type>void *</type>
          <declname>args</declname>
        </param>
        <briefdescription>
<para>Initializes the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>This function performs all necessary startup steps to prepare the Bamocar motor controller for operation. It is typically called during system initialization from <ref refid="uvfr__utils_8c" kindref="compound">uvfr_utils.c</ref>.</para>
<para>The routine performs the following actions:<itemizedlist>
<listitem><para>Toggles a GPIO pin for debug indication</para>
</listitem><listitem><para>Registers a CAN RX handler for controller responses</para>
</listitem><listitem><para>Enables cyclic transmission of critical feedback parameters</para>
</listitem><listitem><para>Sends initialization commands (based on Bamocar Example 11)</para>
</listitem><listitem><para>Requests metadata (serial number, firmware version)</para>
</listitem><listitem><para>Optionally sets and verifies controller parameters</para>
</listitem><listitem><para>Sends status to the system init queue</para>
</listitem><listitem><para>Suspends itself after completion</para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>args</parametername>
</parameternamelist>
<parameterdescription>
<para>Pointer to <ref refid="structuv__init__task__args" kindref="compound">uv_init_task_args</ref>, used to send back init status. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="458" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="458" bodyend="536"/>
        <references refid="structuv__init__task__response_1adfcb943d08344e528ad3d49c5c428918" compoundref="uvfr__utils_8h" startline="369">uv_init_task_response::device</references>
        <references refid="motor__controller_8h_1a829d1af845327949015b4e83bb6fc43d" compoundref="motor__controller_8h" startline="177">FIRMWARE_VERSION_REGISTER</references>
        <references refid="structuv__init__task__args_1adec47e7a54822cacfb8fcfc35a22157f" compoundref="uvfr__utils_8h" startline="343">uv_init_task_args::init_info_queue</references>
        <references refid="group__uvfr__can__api_1gafadde3418edf4017889c4c6ec160a2f6" compoundref="can_8c" startline="652" endline="767">insertCANMessageHandler</references>
        <references refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" compoundref="motor__controller_8c" startline="407" endline="436">MC_EnableCyclicSpeedTransmission</references>
        <references refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" compoundref="motor__controller_8c" startline="110" endline="125">MC_Request_Data</references>
        <references refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" compoundref="motor__controller_8c" startline="141" endline="159">MC_Set_Param</references>
        <references refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" compoundref="motor__controller_8c" startline="16">mc_settings</references>
        <references refid="uvfr__utils_8h_1ad70cbc8929c4ad7a5901cd9eef5ca9b0a9c632ecb370b78547a390d1b5cf59671" compoundref="uvfr__utils_8h" startline="212">MOTOR_CONTROLLER</references>
        <references refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" compoundref="projdefs_8h" startline="41">pdMS_TO_TICKS</references>
        <references refid="motor__controller_8c_1aaff68bb563bf4ad56841a5a5020cbadc" compoundref="motor__controller_8c" startline="324" endline="392">ProcessMotorControllerResponse</references>
        <references refid="motor__controller_8h_1aab8c03dc3480e25a7a75b60edbf51cb3" compoundref="motor__controller_8h" startline="176">SERIAL_NUMBER_REGISTER</references>
        <references refid="structuv__init__task__response_1a56b3df74c10cdc59e8e1b9d4c1f36af7" compoundref="uvfr__utils_8h" startline="368">uv_init_task_response::status</references>
        <references refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" compoundref="uvfr__utils_8h" startline="174">UV_OK</references>
        <references refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3">vTaskDelay</references>
        <references refid="task_8h_1a84d4e660b04630be2939d91b3c2412f8">vTaskSuspend</references>
        <references refid="queue_8h_1af7eb49d3249351176992950d9185abe9" compoundref="queue_8h" startline="479">xQueueSend</references>
        <referencedby refid="uvfr__utils_8h_1a6d40598f9d8daa89ca159a2e87f4fd01" compoundref="uvfr__utils_8c" startline="50" endline="311">uvInit</referencedby>
      </memberdef>
      <memberdef kind="function" id="motor__controller_8c_1ad5f29647a349035990d49fe100bb740b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void MC_Shutdown</definition>
        <argsstring>(void)</argsstring>
        <name>MC_Shutdown</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Safely shuts down the motor controller. </para>
        </briefdescription>
        <detaileddescription>
<para>This function stops all periodic CAN feedback, zeroes the torque or speed command (depending on control mode), disables the motor controller, and optionally requests the error/warning register for post-shutdown diagnostics.</para>
<para>It ensures the controller is left in a known, safe state after driving stops. Use this before powering down or transitioning to an inactive state. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="Core/Src/motor_controller.c" line="548" column="6" bodyfile="Core/Src/motor_controller.c" bodystart="548" bodyend="570"/>
        <references refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" compoundref="motor__controller_8c" startline="407" endline="436">MC_EnableCyclicSpeedTransmission</references>
        <references refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" compoundref="motor__controller_8c" startline="110" endline="125">MC_Request_Data</references>
        <references refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" compoundref="motor__controller_8c" startline="141" endline="159">MC_Set_Param</references>
        <references refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa595211bb6640ca05c1c3344b47e2890f" compoundref="motor__controller_8h" startline="95">motor_controller_errors_warnings</references>
        <references refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" compoundref="projdefs_8h" startline="41">pdMS_TO_TICKS</references>
        <references refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3">vTaskDelay</references>
        <referencedby refid="driving__loop_8c_1ac9c776513f26edd5cf75280eea26275b" compoundref="driving__loop_8c" startline="432" endline="513">performSafetyChecks</referencedby>
        <referencedby refid="uvfr__vehicle__commands_8h_1a8073be27b31b156bee66e3b3038144c9" compoundref="uvfr__vehicle__commands_8c" startline="23" endline="32">uvSecureVehicle</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*<sp/>motor_controller.c<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="motor__controller_8h" kindref="compound">motor_controller.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="can_8h" kindref="compound">can.h</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>uvSendCanMSG,<sp/>uv_CAN_msg,<sp/>etc.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="uvfr__utils_8h" kindref="compound">uvfr_utils.h</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>uvPanic,<sp/>etc.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="uvfr__settings_8h" kindref="compound">uvfr_settings.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="cmsis__os_8h" kindref="compound">cmsis_os.h</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>vTaskSuspend</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/><ref refid="structuv__vehicle__settings" kindref="compound">uv_vehicle_settings</ref>*<sp/><ref refid="motor__controller_8c_1a03566822d1b8893362970a459bd67daf" kindref="member">current_vehicle_settings</ref>;</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/><ref refid="struct_queue_definition" kindref="compound">QueueHandle_t</ref><sp/><ref refid="motor__controller_8c_1aeb37f26e053d2887099e01f7fcfb62d5" kindref="member">CAN_Rx_Queue</ref>;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Redirect<sp/>all<sp/>mc_settings.x<sp/>to<sp/>actual<sp/>config<sp/>struct</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16" refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>mc_settings<sp/>(current_vehicle_settings-&gt;mc_settings)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">//register<sp/>for<sp/>motor<sp/>controller<sp/>errors<sp/>and<sp/>warnings<sp/>so<sp/>we<sp/>can<sp/>make<sp/>them<sp/>cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">//#define<sp/>motor_controller_errors_warnings<sp/>0x82</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">//global<sp/>variable<sp/>for<sp/>the<sp/>last<sp/>mc<sp/>responce</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" refkind="member"><highlight class="normal"><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref><sp/><ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">//global<sp/>variable<sp/>for<sp/>timeout</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="motor__controller_8h_1a01068b62ae077af823a3ff2339589a5a" refkind="member"><highlight class="normal"><ref refid="portmacro_8h_1aa69c48c6e902ce54f70886e6573c92a9" kindref="member">TickType_t</ref><sp/><ref refid="motor__controller_8c_1a01068b62ae077af823a3ff2339589a5a" kindref="member">last_driver_input_time</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">//cyclic<sp/>parameters</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27" refid="motor__controller_8h_1ab2f9a165135f6377e587c0a1e196c18e" refkind="member"><highlight class="normal">int16_t<sp/><ref refid="motor__controller_8c_1ab2f9a165135f6377e587c0a1e196c18e" kindref="member">mc_speed_rpm</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="28" refid="motor__controller_8h_1a399e00d21730a80f94ac96c6b3d9d729" refkind="member"><highlight class="normal">int16_t<sp/><ref refid="motor__controller_8c_1a399e00d21730a80f94ac96c6b3d9d729" kindref="member">mc_current</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="29" refid="motor__controller_8h_1adfaaabb45aef6c2b8bf7fb35a5d3d37a" refkind="member"><highlight class="normal">int16_t<sp/><ref refid="motor__controller_8c_1adfaaabb45aef6c2b8bf7fb35a5d3d37a" kindref="member">mc_torque_cmd</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="30" refid="motor__controller_8h_1addd0636fe19f64a68688fb4c64eb8d9a" refkind="member"><highlight class="normal">int16_t<sp/><ref refid="motor__controller_8c_1addd0636fe19f64a68688fb4c64eb8d9a" kindref="member">mc_motor_temp</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="31" refid="motor__controller_8h_1a1edd8dace1c45eaa85bb105f903248de" refkind="member"><highlight class="normal">int16_t<sp/><ref refid="motor__controller_8c_1a1edd8dace1c45eaa85bb105f903248de" kindref="member">mc_igbt_temp</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Global<sp/>default<sp/>settings<sp/>variable<sp/>defined<sp/>here.</highlight></codeline>
<codeline lineno="36"><highlight class="comment"><sp/>*<sp/>This<sp/>uses<sp/>the<sp/>motor_controller_settings<sp/>definition<sp/>from<sp/>uvfr_settings.h.</highlight></codeline>
<codeline lineno="37"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38" refid="motor__controller_8h_1afb41a96439ba6d63dcc64f257c43a1d2" refkind="member"><highlight class="normal"><ref refid="structmotor__controller__settings" kindref="compound">motor_controller_settings</ref><sp/><ref refid="motor__controller_8c_1afb41a96439ba6d63dcc64f257c43a1d2" kindref="member">mc_default_settings</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>.can_id_tx<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0x201,</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>.can_id_rx<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0x181,</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>.mc_CAN_timeout<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>.proportional_gain<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>10,<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>uint8_t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>.integral_time_constant<sp/>=<sp/>400,<sp/><sp/></highlight><highlight class="comment">//<sp/>uint32_t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/>.integral_memory_max<sp/><sp/><sp/><sp/>=<sp/>60,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>uint8_t<sp/>(represents<sp/>60%)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Scaled<sp/>values<sp/>(normalized<sp/>to<sp/>32767)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_speed<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>12357,<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(2457.5<sp/>RPM<sp/>/<sp/>6500<sp/>RPM)<sp/>*<sp/>32767</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_current<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>13107,<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(100<sp/>A<sp/>/<sp/>250<sp/>A)<sp/>*<sp/>32767</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>.cont_current<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>7864,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(60<sp/>A<sp/>/<sp/>250<sp/>A)<sp/>*<sp/>32767</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_torque<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>32767,<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Full<sp/>scale<sp/>=<sp/>230<sp/>Nm<sp/>=<sp/>32767</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_motor_temp<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>32767,<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>120<sp/>°C<sp/>→<sp/>full<sp/>scale<sp/>(as<sp/>per<sp/>0xA3<sp/>field)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>.warning_motor_temp<sp/><sp/><sp/><sp/><sp/>=<sp/>32767,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//120<sp/>°C<sp/>→<sp/>full<sp/>scale<sp/>(as<sp/>per<sp/>0xA2<sp/>field)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>.mc_bus<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="uvfr__utils_8h_1a68cc2bdb140f7959b6090b771f3358a9" kindref="member">CAN_BUS_1</ref></highlight></codeline>
<codeline lineno="55"><highlight class="normal">};</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="69" refid="motor__controller_8h_1ae71f2a8631fd64b7d7ce321470d4fab0" refkind="member"><highlight class="normal">uint16_t<sp/><ref refid="motor__controller_8c_1ae71f2a8631fd64b7d7ce321470d4fab0" kindref="member">sendTorqueToMotorController</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>T_filtered)</highlight></codeline>
<codeline lineno="70"><highlight class="normal">{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(T_filtered<sp/>&lt;<sp/>0.0f)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T_filtered<sp/>=<sp/>0.0f;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(T_filtered<sp/>&gt;<sp/>256.0f)</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T_filtered<sp/>=<sp/>256.0f;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//uint16_t<sp/>torque_cmd<sp/>=<sp/>(uint16_t)<sp/>T_filtered;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//scale<sp/>to<sp/>bamocar<sp/>requirements<sp/>of<sp/>32760</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>T_MAX<sp/>=<sp/>230.0f;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>torque_cmd<sp/>=<sp/>(uint16_t)((T_filtered<sp/>/<sp/>T_MAX)<sp/>*<sp/>32760.0f);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//if<sp/>T_filtered<sp/>is<sp/>115<sp/>nm<sp/>--&gt;<sp/>1680<sp/>for<sp/>bamocar</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//(115<sp/>/<sp/>230)<sp/>*<sp/>32760<sp/>=<sp/>16380<sp/>≈<sp/>0x3FFC</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref><sp/>torque_msg;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(&amp;torque_msg,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(torque_msg));</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" kindref="member">msg_id</ref><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;can_id_tx;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/><sp/><sp/><sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>N_set<sp/>command<sp/>(from<sp/>your<sp/>enum<sp/>motor_controller_speed_parameters)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]<sp/>=<sp/><ref refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268aa53daf1b53f678af8159cba9238c5e6f" kindref="member">N_set</ref>;<sp/></highlight><highlight class="comment">//speed<sp/>comand</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//torque_msg.data[0]<sp/>=<sp/>M_Set;<sp/>//torque<sp/>command</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Little-endian:<sp/>LSB<sp/>first<sp/>then<sp/>MSB</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]<sp/>=<sp/>(uint8_t)(torque_cmd<sp/>&amp;<sp/>0xFF);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>=<sp/>(uint8_t)((torque_cmd<sp/>&gt;&gt;<sp/>8)<sp/>&amp;<sp/>0xFF);</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>torque_msg.<ref refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" kindref="member">flags</ref><sp/><sp/><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;mc_bus;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" kindref="member">uvSendCanMSG</ref>(&amp;torque_msg)<sp/>!=<sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>send<sp/>torque<sp/>command&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="103"><highlight class="normal">}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="110" refid="motor__controller_8h_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(uint8_t<sp/>RegID)</highlight></codeline>
<codeline lineno="111"><highlight class="normal">{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref><sp/>request_msg;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(&amp;request_msg,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(request_msg));</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" kindref="member">msg_id</ref><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;can_id_tx;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/><sp/><sp/><sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]<sp/>=<sp/>0x3D;<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Request<sp/>command<sp/>identifier</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]<sp/>=<sp/>RegID;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>register<sp/>to<sp/>be<sp/>requested</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>request_msg.<ref refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" kindref="member">flags</ref><sp/><sp/><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;mc_bus;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" kindref="member">uvSendCanMSG</ref>(&amp;request_msg)<sp/>!=<sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;CAN<sp/>Request<sp/>Transmission<sp/>Failed&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal">}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="141" refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" refkind="member"><highlight class="normal"><ref refid="can_8h_1aef3770e45bbacbf527fd93dd80eea9b9" kindref="member">uv_status</ref><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(uint8_t<sp/>RegID,uint16_t<sp/>d){</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref><sp/>tx_msg;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" kindref="member">msg_id</ref><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;can_id_tx;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>=<sp/>3;<sp/></highlight><highlight class="comment">//DLC<sp/>MUST<sp/>BE<sp/>3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]<sp/>=<sp/>RegID;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]<sp/>=<sp/>d<sp/>&amp;<sp/>0xFF;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>=<sp/>(d<sp/>&gt;&gt;<sp/>8)<sp/>&amp;<sp/>0xFF;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[3]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>tx_msg.<ref refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" kindref="member">flags</ref><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;mc_bus;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" kindref="member">uvSendCanMSG</ref>(&amp;tx_msg)<sp/>!=<sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>){</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;MC_Param<sp/>set<sp/>fail&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" kindref="member">UV_ERROR</ref>;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>;</highlight></codeline>
<codeline lineno="159"><highlight class="normal">}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="175" refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" refkind="member"><highlight class="normal"><ref refid="can_8h_1aef3770e45bbacbf527fd93dd80eea9b9" kindref="member">uv_status</ref><sp/><ref refid="motor__controller_8c_1af42bb7e058463e8db7e230378f98741c" kindref="member">MC_SetAndVerify_Param</ref>(uint8_t<sp/>reg_id,<sp/>uint16_t<sp/>set_val)</highlight></codeline>
<codeline lineno="176"><highlight class="normal">{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//send<sp/>parameter<sp/>to<sp/>be<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(reg_id,<sp/>set_val)<sp/>!=<sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Set<sp/>failed&quot;</highlight><highlight class="normal">,<sp/>reg_id);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" kindref="member">UV_ERROR</ref>;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//delay<sp/>to<sp/>give<sp/>time<sp/>to<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(20));</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Request<sp/>the<sp/>parameter<sp/>back</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(reg_id);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Delay<sp/>for<sp/>the<sp/>response<sp/>to<sp/>arrive<sp/>via<sp/>CAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(20));</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Manually<sp/>call<sp/>response<sp/>parser<sp/>on<sp/>the<sp/>updated<sp/>CAN<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//ProcessMotorControllerResponse(&amp;last_mc_response);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>the<sp/>returned<sp/>register</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]<sp/>!=<sp/>reg_id)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Mismatched<sp/>REGID<sp/>in<sp/>response&quot;</highlight><highlight class="normal">,<sp/><ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" kindref="member">UV_ERROR</ref>;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Parse<sp/>16-bit<sp/>LE<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>returned_val<sp/>=<sp/>(<ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/><ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1];</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(returned_val<sp/>!=<sp/>set_val)<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>err_buf[64];</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(err_buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(err_buf),</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Mismatch<sp/>for<sp/>Reg<sp/>0x%02X:<sp/>set<sp/>0x%04X,<sp/>got<sp/>0x%04X&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reg_id,<sp/>set_val,<sp/>returned_val);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//uvPanic(err_buf,<sp/>0);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0" kindref="member">UV_ERROR</ref>;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>;</highlight></codeline>
<codeline lineno="213"><highlight class="normal">}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="221" refid="motor__controller_8h_1a98ef1edcc51198faf53767e8d92ce4c9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1a98ef1edcc51198faf53767e8d92ce4c9" kindref="member">Parse_Bamocar_Response</ref>(<ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref>*<sp/>msg)</highlight></codeline>
<codeline lineno="222"><highlight class="normal">{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!msg<sp/>||<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&lt;<sp/>4)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>motor<sp/>controller<sp/>response&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>val<sp/>=<sp/>(uint32_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[3]<sp/>&lt;&lt;<sp/>24)<sp/>|</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>16)<sp/>|</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]<sp/>&lt;&lt;<sp/>8)<sp/><sp/>|</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]);</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;Parsed<sp/>32-bit<sp/>LE<sp/>value:<sp/>0x%08X\n&quot;,<sp/>val);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal">}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="247" refid="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" kindref="member">MotorControllerErrorHandler_16bitLE</ref>(uint8_t<sp/>*data,<sp/>uint8_t<sp/>length)</highlight></codeline>
<codeline lineno="248"><highlight class="normal">{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(length<sp/>&lt;<sp/>2)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>errors<sp/>=<sp/>(uint16_t)((data[1]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>data[0]);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa87ada8cd125ba521b447d565c12bb30e" kindref="member">eprom_read_error</ref>)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;EPROM<sp/>Read<sp/>Error&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffae9da794167969482cb67bfad83a04d71" kindref="member">hardware_fault</ref>)<sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Hardware<sp/>Fault&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffadae8b5f4fb6cd6712202d055529499ef" kindref="member">rotate_field_enable_not_present_run</ref>)<sp/>{</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Rotating<sp/>Field<sp/>Enable<sp/>Not<sp/>Present<sp/>(Run<sp/>Active)&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa425430d2585733363b6043ed70ebd7ab" kindref="member">CAN_timeout_error</ref>)<sp/>{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;CAN<sp/>Timeout<sp/>Error&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa2a16f371b0570edeeb17214a398e4bfc" kindref="member">feedback_signal_error</ref>)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Feedback<sp/>Signal<sp/>Error&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa13726d0d6fc8dd12135f4ea92d1dcc92" kindref="member">mains_voltage_min_limit</ref>)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Mains<sp/>Voltage<sp/>Below<sp/>Minimum<sp/>Limit&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa2267f6ae60d8b9024ba418dd1f6d4b15" kindref="member">motor_temp_max_limit</ref>)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Motor<sp/>Temperature<sp/>Exceeded<sp/>Maximum<sp/>Limit&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa54a5ca5981535fd231b00a1040622950" kindref="member">IGBT_temp_max_limit</ref>)<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;IGBT<sp/>Temperature<sp/>Exceeded<sp/>Maximum<sp/>Limit&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa229533ef674ddd4475b22e47eb506b49" kindref="member">mains_voltage_max_limit</ref>)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Mains<sp/>Voltage<sp/>Exceeded<sp/>Maximum<sp/>Limit&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa29aa452fe3c693b96c17c09849ee1633" kindref="member">critical_AC_current</ref>)<sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Critical<sp/>AC<sp/>Current<sp/>Detected&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa696b36face7279e19e2905b0fa9ecb68" kindref="member">race_away_detected</ref>)<sp/>{</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Race<sp/>Away<sp/>Detected&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa0dd2c6834f96df064d7b152074a9f81f" kindref="member">ecode_timeout_error</ref>)<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Ecode<sp/>Timeout<sp/>Error&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa357611869a1ec791b38a36ec2dfe09b9" kindref="member">watchdog_reset</ref>)<sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Watchdog<sp/>Reset<sp/>Occurred&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa0dbc9540bf7a4c67b6a2810985bfb55d" kindref="member">AC_current_offset_fault</ref>)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;AC<sp/>Current<sp/>Offset<sp/>Fault&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa18df3363e2a0048a813dcef5a41785ce" kindref="member">internal_hardware_voltage_problem</ref>)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Internal<sp/>Hardware<sp/>Voltage<sp/>Problem&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errors<sp/>&amp;<sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa150953c78b7fcc8ae97a50a5b5765264" kindref="member">bleed_resistor_overload</ref>)<sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uvPanic(</highlight><highlight class="stringliteral">&quot;Bleed<sp/>Resistor<sp/>Overload&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>You<sp/>can<sp/>add<sp/>additional<sp/>error<sp/>checks<sp/>as<sp/>needed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//motor_controller_settings*<sp/>settings<sp/>=<sp/>(motor_controller_settings*)<sp/>params-&gt;specific_args;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal">}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="324" refid="motor__controller_8h_1aaff68bb563bf4ad56841a5a5020cbadc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1aaff68bb563bf4ad56841a5a5020cbadc" kindref="member">ProcessMotorControllerResponse</ref>(<ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref>*<sp/>msg){</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//every<sp/>incoming<sp/>mc<sp/>message<sp/>gets<sp/>stored<sp/>for<sp/>use<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;<ref refid="motor__controller_8c_1a51ae01990816c3ee2c679d67fa511f3a" kindref="member">last_mc_response</ref>,<sp/>msg,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref>));</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!msg<sp/>||<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&lt;<sp/>2)</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>reg_id<sp/>=<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0];</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(reg_id)<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268a74ac68aa19b65409fa9b18b8f2be3bf4" kindref="member">N_actual</ref>:<sp/><sp/></highlight><highlight class="comment">//<sp/>SPEED_ACTUAL<sp/>(0x30)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>speed<sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1ab2f9a165135f6377e587c0a1e196c18e" kindref="member">mc_speed_rpm</ref><sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);<sp/></highlight><highlight class="comment">//cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1aefe525453e2d5fb5ff19de9f98247c7ca08745ee38252c5952330efe1591df091" kindref="member">CURRENT_ACTUAL</ref>:<sp/><sp/></highlight><highlight class="comment">//<sp/>0x31:<sp/>16-bit,<sp/>little-endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>current_raw<sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a399e00d21730a80f94ac96c6b3d9d729" kindref="member">mc_current</ref><sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);<sp/></highlight><highlight class="comment">//cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda0065463d68046f7a361ad1b060548b27" kindref="member">LOGIMAP_ERRORS</ref>:<sp/><sp/></highlight><highlight class="comment">//<sp/>0x82:<sp/>error<sp/>bitfield,<sp/>little-endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" kindref="member">MotorControllerErrorHandler_16bitLE</ref>(&amp;msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1],<sp/>2);</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda887c38d92ef273b6fae58dcb51931765" kindref="member">LOGIMAP_IO</ref>:<sp/><sp/></highlight><highlight class="comment">//<sp/>0x83:<sp/>I/O<sp/>status,<sp/>16-bit,<sp/>little-endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>io_flags<sp/>=<sp/>(uint16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda75b5d9cefe36e570d9e0c306fb0e22fc" kindref="member">POS_ACTUAL</ref>:<sp/><sp/></highlight><highlight class="comment">//<sp/>0x86:<sp/>32-bit<sp/>value,<sp/>little-endian</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>5)<sp/>{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int32_t<sp/>pos<sp/>=<sp/>(int32_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[4]<sp/>&lt;&lt;<sp/>24)<sp/>|</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[3]<sp/>&lt;&lt;<sp/>16)<sp/>|</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/><sp/>|</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa595211bb6640ca05c1c3344b47e2890f" kindref="member">motor_controller_errors_warnings</ref>:</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>error/warning<sp/>responses<sp/>using<sp/>this<sp/>register,<sp/>assume<sp/>a<sp/>16-bit<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(msg-&gt;<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1aa2fe2c9102e9f2ab65ab4a9d5557f497" kindref="member">MotorControllerErrorHandler_16bitLE</ref>(&amp;msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1],<sp/>2);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268ac53068c686a03da9dbdc2e20ea07a8d0" kindref="member">M_out</ref>:<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0xA0:<sp/>actual<sp/>active<sp/>current<sp/>scaled</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1adfaaabb45aef6c2b8bf7fb35a5d3d37a" kindref="member">mc_torque_cmd</ref><sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);<sp/></highlight><highlight class="comment">//cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645aeff9dce22875056570afa6b71fd23842" kindref="member">motor_temperature</ref>:<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0x49:<sp/>motor<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1addd0636fe19f64a68688fb4c64eb8d9a" kindref="member">mc_motor_temp</ref><sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);<sp/></highlight><highlight class="comment">//cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a349799caa493b390c9527db251fd128c" kindref="member">igbt_temperature</ref>:<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0x4A:<sp/>igbt<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a1edd8dace1c45eaa85bb105f903248de" kindref="member">mc_igbt_temp</ref><sp/>=<sp/>(int16_t)((msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>&lt;&lt;<sp/>8)<sp/>|<sp/>msg-&gt;<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]);<sp/></highlight><highlight class="comment">//cyclic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>other<sp/>responses<sp/>as<sp/>needed<sp/>or<sp/>call<sp/>a<sp/>default<sp/>parser.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal">}</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="407" refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" kindref="member">MC_EnableCyclicSpeedTransmission</ref>(uint8_t<sp/>interval_ms)</highlight></codeline>
<codeline lineno="408"><highlight class="normal">{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(interval_ms<sp/>&lt;<sp/>1<sp/>||<sp/>interval_ms<sp/>&gt;<sp/>254)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>regs[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268a74ac68aa19b65409fa9b18b8f2be3bf4" kindref="member">N_actual</ref>,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>0x30<sp/>—<sp/>Actual<sp/>Speed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1aefe525453e2d5fb5ff19de9f98247c7ca08745ee38252c5952330efe1591df091" kindref="member">CURRENT_ACTUAL</ref>,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>0x69<sp/>—<sp/>Actual<sp/>Current</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1a8cab19f0549eb777404ec1c7a3b56268ac53068c686a03da9dbdc2e20ea07a8d0" kindref="member">M_out</ref>,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>0xA0<sp/>—<sp/>Actual<sp/>Active<sp/>Current<sp/>Scaled</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645aeff9dce22875056570afa6b71fd23842" kindref="member">motor_temperature</ref>,<sp/><sp/></highlight><highlight class="comment">//<sp/>0x49<sp/>—<sp/>Current<sp/>Motor<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a349799caa493b390c9527db251fd128c" kindref="member">igbt_temperature</ref>,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>0x4A<sp/>—<sp/>IGBT<sp/>temperature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645afe594d99cc90d2fff45e0107f9e52f0f" kindref="member">max_motor_temp</ref>,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0xa3<sp/><sp/>-<sp/>max<sp/>motor<sp/>temp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1af56dfdd222f09bea78ac88fdf4ecf645a201a49da019d5cf651ff2ec75ef27b10" kindref="member">warning_motor_temp</ref>,<sp/></highlight><highlight class="comment">//0xa2<sp/>-<sp/>warning<sp/>motor<sp/>temp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8h_1a08f38539bd153ea7b7b1be8df1d6f6eda0065463d68046f7a361ad1b060548b27" kindref="member">LOGIMAP_ERRORS</ref>,<sp/></highlight><highlight class="comment">//<sp/>0x8F<sp/>—<sp/>ERROR<sp/>BIT<sp/>map</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(regs);<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structuv___c_a_n__msg" kindref="compound">uv_CAN_msg</ref><sp/>tx;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(&amp;tx,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tx));</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1aae369fbabe3cc5b71a89bb641c24aace" kindref="member">msg_id</ref><sp/><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;can_id_tx;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1aa74af3745c8b56910d7c309245541d37" kindref="member">dlc</ref><sp/><sp/><sp/><sp/><sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[0]<sp/>=<sp/>0x3D;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Command:<sp/>Enable<sp/>cyclic<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[1]<sp/>=<sp/>regs[i];<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Target<sp/>register</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1aec63cc112176da7895d0cfc8b32e6935" kindref="member">data</ref>[2]<sp/>=<sp/>interval_ms;<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Repeating<sp/>time<sp/>(1–254<sp/>ms)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tx.<ref refid="structuv___c_a_n__msg_1a3a3fdc7fed06a631fefa58ea44052d8d" kindref="member">flags</ref><sp/><sp/><sp/>=<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;mc_bus;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="group__uvfr__can__api_1ga62414944c3b631f57fdd08e467bcf5a4" kindref="member">uvSendCanMSG</ref>(&amp;tx);</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(5));<sp/><sp/></highlight><highlight class="comment">//<sp/>delay<sp/>between<sp/>messages</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal">}</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="458" refid="motor__controller_8h_1aed1407e1e0fd59dc7c5e5d6db671f0ab" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1aed1407e1e0fd59dc7c5e5d6db671f0ab" kindref="member">MC_Startup</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>args)</highlight></codeline>
<codeline lineno="459"><highlight class="normal">{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//toggle<sp/>pin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>HAL_GPIO_TogglePin(GPIOD,<sp/>GPIO_PIN_14);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Register<sp/>CAN<sp/>RX<sp/>handler<sp/>first<sp/>and<sp/>routes<sp/>eveyrthing<sp/>though<sp/>processmotorcontrollerresponse</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//subsequently<sp/>the<sp/>motor<sp/>controller<sp/>error<sp/>handler</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="group__uvfr__can__api_1gafadde3418edf4017889c4c6ec160a2f6" kindref="member">insertCANMessageHandler</ref>(<ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;can_id_rx,<sp/><ref refid="motor__controller_8c_1aaff68bb563bf4ad56841a5a5020cbadc" kindref="member">ProcessMotorControllerResponse</ref>,<sp/><ref refid="motor__controller_8c_1a439694589c8c785c64cf6717387e8ed6" kindref="member">mc_settings</ref>-&gt;mc_bus);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//start<sp/>cyclic<sp/>transmission</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" kindref="member">MC_EnableCyclicSpeedTransmission</ref>(100);<sp/></highlight><highlight class="comment">//<sp/>every<sp/>100ms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>===<sp/>Bamocar<sp/>Init<sp/>Routine<sp/>(partial<sp/>from<sp/>Example<sp/>11)<sp/>===</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Request<sp/>BTB<sp/>(0xE2)<sp/>—<sp/>optional</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(0xE2);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Disable<sp/>motor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0x51<sp/>is<sp/>mode<sp/>state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x51,<sp/>0x0004);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Request<sp/>enable<sp/>hardware</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(0xE8);</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>4.<sp/>Enable<sp/>controller</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x51,<sp/>0x0000);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>5.<sp/>Set<sp/>acceleration<sp/>ramp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x35,<sp/>0x01F4);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>6.<sp/>Set<sp/>deceleration<sp/>ramp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0xED,<sp/>0x03E8);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//pointer<sp/>to<sp/>mc<sp/>init<sp/>task</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structuv__init__task__args" kindref="compound">uv_init_task_args</ref>*<sp/>MC_init_args<sp/>=<sp/>(<ref refid="structuv__init__task__args" kindref="compound">uv_init_task_args</ref>*)args;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_queue_definition" kindref="compound">QueueHandle_t</ref><sp/>queue<sp/>=<sp/>MC_init_args-&gt;<ref refid="structuv__init__task__args_1adec47e7a54822cacfb8fcfc35a22157f" kindref="member">init_info_queue</ref>;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structuv__init__task__response" kindref="compound">uv_init_task_response</ref><sp/>rx;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//ID<sp/>of<sp/>responding<sp/>device</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rx.<ref refid="structuv__init__task__response_1adfcb943d08344e528ad3d49c5c428918" kindref="member">device</ref><sp/>=<sp/><ref refid="uvfr__utils_8h_1ad70cbc8929c4ad7a5901cd9eef5ca9b0a9c632ecb370b78547a390d1b5cf59671" kindref="member">MOTOR_CONTROLLER</ref>;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rx.<ref refid="structuv__init__task__response_1a56b3df74c10cdc59e8e1b9d4c1f36af7" kindref="member">status</ref><sp/>=<sp/><ref refid="uvfr__utils_8h_1a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9" kindref="member">UV_OK</ref>;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Request<sp/>serial<sp/>number<sp/>and<sp/>firmware<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(<ref refid="motor__controller_8h_1aab8c03dc3480e25a7a75b60edbf51cb3" kindref="member">SERIAL_NUMBER_REGISTER</ref>);</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(10);<sp/></highlight><highlight class="comment">//delay</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Request<sp/>device<sp/>serial<sp/>number<sp/>servo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_Request_Data(0x62);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//vTaskDelay(10);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(<ref refid="motor__controller_8h_1a829d1af845327949015b4e83bb6fc43d" kindref="member">FIRMWARE_VERSION_REGISTER</ref>);</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(10);<sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//clear<sp/>error<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x8E,<sp/>0x444d);</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//sendTorqueToMotorController(0);<sp/>//set<sp/>initial<sp/>speed<sp/>to<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>and<sp/>verify<sp/>tests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_SetAndVerify_Param(0x31,<sp/>0x0CCD);<sp/><sp/>//<sp/>10%<sp/>speed<sp/>N_Set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_SetAndVerify_Param(0x6A,<sp/>15);<sp/><sp/><sp/>//<sp/>Kp</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_SetAndVerify_Param(0x6B,<sp/>501);<sp/><sp/>//<sp/>Ki</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Request<sp/>error<sp/>data<sp/>(if<sp/>desired,<sp/>e.g.,<sp/>using<sp/>the<sp/>error/warning<sp/>register).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_Request_Data((uint8_t)motor_controller_errors_warnings);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//MC_Request_Data(0x82)<sp/>//check<sp/>errors<sp/>should<sp/>see<sp/>82<sp/>##<sp/>##</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Signal<sp/>success<sp/>via<sp/>an<sp/>RTOS<sp/>queue<sp/>here...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="queue_8h_1af7eb49d3249351176992950d9185abe9" kindref="member">xQueueSend</ref>(queue,&amp;rx,0);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Suspend<sp/>this<sp/>task<sp/>so<sp/>it<sp/>does<sp/>not<sp/>run<sp/>repeatedly.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1a84d4e660b04630be2939d91b3c2412f8" kindref="member">vTaskSuspend</ref>(NULL);</highlight></codeline>
<codeline lineno="536"><highlight class="normal">}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="548" refid="motor__controller_8h_1ad5f29647a349035990d49fe100bb740b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="motor__controller_8c_1ad5f29647a349035990d49fe100bb740b" kindref="member">MC_Shutdown</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="549"><highlight class="normal">{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Stop<sp/>all<sp/>cyclic<sp/>transmission</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1aeaf0ac96c53381d0e43d5d7944923d86" kindref="member">MC_EnableCyclicSpeedTransmission</ref>(0xFF);<sp/><sp/></highlight><highlight class="comment">//<sp/>0xFF<sp/>disables<sp/>periodic<sp/>streaming</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Set<sp/>speed<sp/>or<sp/>torque<sp/>to<sp/>zero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>one<sp/>of<sp/>these<sp/>depending<sp/>on<sp/>your<sp/>control<sp/>mode:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>If<sp/>using<sp/>speed<sp/>mode:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x31,<sp/>0x0000);<sp/><sp/></highlight><highlight class="comment">//<sp/>N_set<sp/>=<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>If<sp/>using<sp/>torque<sp/>mode<sp/>(comment<sp/>out<sp/>one<sp/>or<sp/>the<sp/>other):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>uint16_t<sp/>sendTorqueToMotorController(0.0f);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Disable<sp/>controller</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1a37f4a694fab82b650c96c13fe4894143" kindref="member">MC_Set_Param</ref>(0x51,<sp/>0x0004);<sp/><sp/></highlight><highlight class="comment">//<sp/>Disable<sp/>command</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>4.<sp/>Optional:<sp/>Request<sp/>error/warning<sp/>register<sp/>after<sp/>shutdown</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="motor__controller_8c_1af6b3a4911f1bdac54d84b4dcc7b7ec4a" kindref="member">MC_Request_Data</ref>(<ref refid="motor__controller_8h_1a5e2fbf1b4105e76b330bcb6547533dffa595211bb6640ca05c1c3344b47e2890f" kindref="member">motor_controller_errors_warnings</ref>);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="task_8h_1aa154068cecd7f31446a7a84af44ab1a3" kindref="member">vTaskDelay</ref>(<ref refid="projdefs_8h_1a353d0f62b82a402cb3db63706c81ec3f" kindref="member">pdMS_TO_TICKS</ref>(10));</highlight></codeline>
<codeline lineno="570"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="Core/Src/motor_controller.c"/>
  </compounddef>
</doxygen>
