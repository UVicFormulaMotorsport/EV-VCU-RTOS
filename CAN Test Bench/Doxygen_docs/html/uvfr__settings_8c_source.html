<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EVRTOSProject: Core/Src/uvfr_settings.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EVRTOSProject
   &#160;<span id="projectnumber">V1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('uvfr__settings_8c_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">uvfr_settings.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="uvfr__settings_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * uvfr_settings.c</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: Oct 10, 2024</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: byo10</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a7350f4a84cab7a08d99c9e88b248a180">    7</a></span>&#160;<span class="preprocessor">#define SRC_UVFR_SETTINGS_C_</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="uvfr__utils_8h.html">uvfr_utils.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;stdlib.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a9320db4d0509341600bb7584ca595609">   13</a></span>&#160;<span class="preprocessor">#define VCU_TO_LAPTOP_ID 0x420</span></div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#aaa6ee3d8e77c95b379e21d4b827ad783">   14</a></span>&#160;<span class="preprocessor">#define LAPTOP_TO_VCU_ID 0x520</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">extern</span> PRIVILEGED_DATA uint8_t <a class="code" href="uvfr__settings_8c.html#a7c9185b38cc68d3a0c2c205746d25494">_s_uvdata</a>; <span class="comment">//Start and end of user flash symbols</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">extern</span> PRIVILEGED_DATA uint8_t <a class="code" href="uvfr__settings_8c.html#a32dcb66c3240af325158ccd12dcb3c68">_e_uvdata</a>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//global variables for all to enjoy</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">   20</a></span>&#160;<a class="code" href="structuv__vehicle__settings.html">uv_vehicle_settings</a>* <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> = NULL;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structuv__os__settings.html">uv_os_settings</a> <a class="code" href="group__state__engine.html#gad9e02be6d2d0bc1ab5cd9fd8cae34230">default_os_settings</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a> <a class="code" href="uvfr__settings_8c.html#a1c7fecf890841f27a4ca39fc66e8cc1b">mc_default_settings</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structdriving__loop__args.html">driving_loop_args</a> <a class="code" href="uvfr__settings_8c.html#a44daa1a9c68be860616e7bc627d9b8f4">default_dl_settings</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structdaq__loop__args.html">daq_loop_args</a> <a class="code" href="uvfr__settings_8c.html#ad795c6981571499e4a90ef72698b6ea1">default_daq_settings</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structuv__imd__settings.html">uv_imd_settings</a> <a class="code" href="uvfr__settings_8c.html#a1071bc1cceac3198de98d9c0753044d6">default_imd_settings</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">extern</span> <a class="code" href="structbms__settings__t.html">bms_settings_t</a> <a class="code" href="uvfr__settings_8c.html#a28e4314b233b9140e73e4fd0bab7e354">default_bms_settings</a>;</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a07c6d6c6f641c6fb60600b9bd7efbf7e">   28</a></span>&#160;<a class="code" href="structuv19__pdu__settings.html">uv19_pdu_settings</a> <a class="code" href="uvfr__settings_8c.html#a07c6d6c6f641c6fb60600b9bd7efbf7e">default_pdu_settings</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">extern</span> <a class="code" href="structdaq__datapoint.html">daq_datapoint</a> <a class="code" href="uvfr__settings_8c.html#af5ab2cd7ec858145d49d4e585e4bef94">default_datapoints</a>[];</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="structtx__all__settings__args.html">   35</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtx__all__settings__args.html">tx_all_settings_args</a>{</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="structtx__all__settings__args.html#a8e42222b51c2f152869fc760560442b0">   36</a></span>&#160;    uint8_t* <a class="code" href="structtx__all__settings__args.html#a8e42222b51c2f152869fc760560442b0">sblock_origin</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}<a class="code" href="uvfr__settings_8c.html#a0641c122dc09626011ee339625d1ea63">tx_all_settings_args</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="structtx__journal__args.html">   43</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtx__journal__args.html">tx_journal_args</a>{</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="structtx__journal__args.html#a47ca8e1495cb07e794ea926dedff2da7">   44</a></span>&#160;    uint32_t <a class="code" href="structtx__journal__args.html#a47ca8e1495cb07e794ea926dedff2da7">start_time</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="structtx__journal__args.html#a170540474cdd1a431f8e257d5a70c4ac">   45</a></span>&#160;    uint32_t <a class="code" href="structtx__journal__args.html#a170540474cdd1a431f8e257d5a70c4ac">end_time</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}<a class="code" href="uvfr__settings_8c.html#a9a7490c87797ddce618071ea477c8009">tx_journal_args</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="unionhelper__task__args.html">   51</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="unionhelper__task__args.html">helper_task_args</a>{</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="unionhelper__task__args.html#a083dff2889a9c9006875745783ed5f45">   52</a></span>&#160;    <a class="code" href="structtx__all__settings__args.html">tx_all_settings_args</a> <a class="code" href="unionhelper__task__args.html#a083dff2889a9c9006875745783ed5f45">setting_tx_args</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="unionhelper__task__args.html#a530fb24214eb4c3733920bf4446eb571">   53</a></span>&#160;    <a class="code" href="structtx__journal__args.html">tx_journal_args</a> <a class="code" href="unionhelper__task__args.html#a530fb24214eb4c3733920bf4446eb571">journal_tx_args</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}<a class="code" href="uvfr__settings_8c.html#a06b8e5486501c8fe34e2a1c669e4a01c">helper_task_args</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structsetting__helper__task.html">   59</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structsetting__helper__task.html">setting_helper_task</a>{</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structsetting__helper__task.html#a867ac831a9ae5bbfb2ee7b32d63e8916">   60</a></span>&#160;    TaskHandle_t <a class="code" href="structsetting__helper__task.html#a867ac831a9ae5bbfb2ee7b32d63e8916">meta_task_handle</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="structsetting__helper__task.html#a7446a818ec9497a6b93a7995bf8b66d3">   62</a></span>&#160;    uint32_t <a class="code" href="structsetting__helper__task.html#a7446a818ec9497a6b93a7995bf8b66d3">status</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="structsetting__helper__task.html#a2db368e63a9cc11c26caa2a0eacfca45">   65</a></span>&#160;    <a class="code" href="unionhelper__task__args.html">helper_task_args</a> <a class="code" href="structsetting__helper__task.html#a2db368e63a9cc11c26caa2a0eacfca45">args</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}<a class="code" href="uvfr__settings_8c.html#aff5e0078d7c880f42cc79e084141a6bd">setting_helper_task</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a550e75d7673e407aad1a5240ff83db23">   72</a></span>&#160;<a class="code" href="structveh__gen__info.html">veh_gen_info</a> <a class="code" href="uvfr__settings_8c.html#a550e75d7673e407aad1a5240ff83db23">default_vehicle</a> = {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    .<a class="code" href="structveh__gen__info.html#a4561037fdc0d97cbdac2c5a92a7dd241">wheel_size</a> = 0xEEEEEEEE,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    .drive_ratio = 0xDDDDDDDD,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    .test1 = 0xCCCC,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    .test2 = 0xBBBB,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    .test3 = 0xAAAA,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    .test4 = 0x99,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    .test5 = 0x88,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    .test6 = 0x77777777</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;};</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//Status of laptop connection</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#ad566fc47eb8eb3464e5b48f088ddbb83">   84</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="uvfr__settings_8c.html#ad566fc47eb8eb3464e5b48f088ddbb83">is_laptop_connected</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">   85</a></span>&#160;TickType_t <a class="code" href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">last_contact_with_laptop</a> = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">//Queue for messages coming to the setting setter program</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">   88</a></span>&#160;<span class="keyword">static</span> QueueHandle_t <a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a> = NULL;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a6726b669a3c5795c3326238ab974f382">   90</a></span>&#160;<span class="keyword">static</span> TaskHandle_t <a class="code" href="uvfr__settings_8c.html#a6726b669a3c5795c3326238ab974f382">ptask_handle</a> = NULL;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a19de39f55cc05851f5fa6a40070681e3">   92</a></span>&#160;<span class="keyword">static</span> TaskHandle_t <a class="code" href="uvfr__settings_8c.html#a19de39f55cc05851f5fa6a40070681e3">child_task_handle</a> = NULL;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#af0cbf7f4ea57695f3b1d2d3c83844000">   93</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="uvfr__settings_8c.html#af0cbf7f4ea57695f3b1d2d3c83844000">child_task_active</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">  100</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a> <a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a> = {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    .<a class="code" href="structuv___c_a_n__msg.html#a3a3fdc7fed06a631fefa58ea44052d8d">flags</a> = 0x00,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    .dlc = 1,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    .data = {0x10,0,0,0,0,0,0,0},</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    .msg_id = <a class="code" href="uvfr__settings_8c.html#a9320db4d0509341600bb7584ca595609">VCU_TO_LAPTOP_ID</a></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">  111</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a> <a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a> = {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    .<a class="code" href="structuv___c_a_n__msg.html#a3a3fdc7fed06a631fefa58ea44052d8d">flags</a> = 0x00,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    .dlc = 1,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    .data = {0x11,0,0,0,0,0,0,0},</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    .msg_id = <a class="code" href="uvfr__settings_8c.html#a9320db4d0509341600bb7584ca595609">VCU_TO_LAPTOP_ID</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;};</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a0be2604cded239f54f4f4ab61460a85c">uvValidateFlashSettings</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#ac9480e8bfbccfda4b4c7316bdb55ba87">uvResetFlashToDefault</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a2f0cb7e05c1bef0501d585df7c2c6013">uvSettingsProgrammerTask</a>(<span class="keywordtype">void</span>* args);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">  128</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>(uint8_t* from, uint8_t* to, uint16_t length) PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span>(from == NULL || to == NULL || length == 0){</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">return</span>; <span class="comment">//No null errors on my watch buddy boy</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;length; i++){</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        *(to + i) = *(from + i);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#ad2bb778b8a8907a17c87de89f0eea3c0">  141</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#ad2bb778b8a8907a17c87de89f0eea3c0">uvTransmitVehicleStatus</a>(){</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a66126a25eee9ffcb3c5fa49314fc998b">  145</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a66126a25eee9ffcb3c5fa49314fc998b">uvAwaitLaptopAckMsg</a>(){</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea6aa86f67f1dcd70789b27731c3ac4e7a">UV_ABORTED</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#afa15631878f6d936a1143656f88f3620">  152</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#afa15631878f6d936a1143656f88f3620">handleIncomingLaptopMsg</a>(<a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a>* msg) PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    uint8_t cmd_byte = msg-&gt;data[0];</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">static</span> <a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a> blank_msg = {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            .<a class="code" href="structuv___c_a_n__msg.html#aae369fbabe3cc5b71a89bb641c24aace">msg_id</a> = 0x420,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            .flags = 0x00,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            .dlc = 8</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    };</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">last_contact_with_laptop</a> = xTaskGetTickCount();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">switch</span>(cmd_byte){</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694acc6ddcaa36bd57e5aec12749cb5ce29c">HANDSHAKE</a>:</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="uvfr__settings_8c.html#ad566fc47eb8eb3464e5b48f088ddbb83">is_laptop_connected</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">last_contact_with_laptop</a> = xTaskGetTickCount();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aa74af3745c8b56910d7c309245541d37">dlc</a> = 8;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[0] = 0x01;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="group__utility__macros.html#ga0fa9d4460bcee65d79e048b43dc879fd">serializeSmallE32</a>(blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>,<a class="code" href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">last_contact_with_laptop</a>,1);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[5] = <a class="code" href="uvfr__global__config_8h.html#a0b584a8bce5bc95619d58d126328d24d">FIRMWARE_MAJOR_RELEASE</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[6] = <a class="code" href="uvfr__global__config_8h.html#a2ada82deacaaa65d39fd8431202312e8">FIRMWARE_MINOR_RELEASE</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[7] = <a class="code" href="uvfr__global__config_8h.html#a056c3375923e87e7b3df830ea10295da">FIRMWARE_PATCH_NUM</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;blank_msg);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694aab474c9db56509a37ee4ee2930849b38">ENTER_PROGRAMMING_MODE</a>:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__state__engine.html#ga2f58cf65b3566bc390600f877f8bed35">vehicle_state</a> == <a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4a9ec1eef180c6208b25b08f0526dc5eb8">UV_READY</a>){</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="comment">//Relevant Ack. frame sent upon succesful startup of programmer task</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="group__state__engine__api.html#gaa3ad3e8df75177c00265881c16563212">changeVehicleState</a>(<a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286">PROGRAMMING</a>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="comment">//should not be programming if in either of these states</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ad67522ff5c2a93d043e4d26bd905ce34">REQUEST_VCU_STATUS</a>:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">//TODO Respond with VCU status</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#ad2bb778b8a8907a17c87de89f0eea3c0">uvTransmitVehicleStatus</a>()!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="comment">//Handle this error.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ad99a8ce3d129dcc56d82ee11b0610f18">GENERIC_ACK</a>:</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">//Could come at any time, however here we are</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a7091f0610d47127e952576fcf2d72eac">SET_SPECIFIC_PARAM</a> ... <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694aefd2ddc079bf62b63b3e5226b9a83ac3">END_OF_SPECIFIC_PARAMS</a>:</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ab8a24171d3940ec1ea3160842c3e4b4b">CLEAR_FAULTS</a>:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a9b0e526098fd6c30dc93538edba59405">REQUEST_ALL_SETTINGS</a>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a205322c736d66df92b6d968b53648acb">REQUEST_ALL_JOURNAL_ENTRIES</a>:</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a4313d65a75fd41f3e527b330e7370a5e">REQUEST_JOURNAL_ENTRIES_BY_TIME</a>:</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ac53400ee472ace47006a18aaaa4a86a0">REQUEST_SPECIFIC_SETTING</a>:</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a8ad6825ef0a84f2615148dc63202be1f">SAVE_AND_APPLY_NEW_SETTINGS</a>:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a485f41f6d806239622abbac7aef60557">DISCARD_NEW_SETTINGS</a>:</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694abe34f5f2d055215f2ff2e2d85401199a">DISCARD_NEW_SETTINGS_AND_EXIT</a>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a302a39661f2460e559645419a2ac8258">FORCE_RESTORE_FACTORY_DEFAULT</a>:</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment">//We need to be in programming mode for these.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="group__state__engine.html#ga2f58cf65b3566bc390600f877f8bed35">vehicle_state</a> == <a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286">PROGRAMMING</a>){</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a> != NULL){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">if</span>(xQueueSend(<a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a>,msg,0) != pdTRUE){</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <span class="comment">//error</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                    uvPanic(<span class="stringliteral">&quot;&quot;</span>,0);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">//send negative ACK</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">//otherwise we will ignore</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">//cmd_byte we do not recognise. We assme the laptop is geeked, and move on</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">  232</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">setupDefaultSettings</a>(){</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> != NULL){</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        uvFree(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">//real trap shit</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> = uvMalloc(<span class="keyword">sizeof</span>(<a class="code" href="structuv__vehicle__settings.html">uv_vehicle_settings</a>));</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> == NULL){</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6a386c439058f4464e4b82acd1315258">veh_info</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a550e75d7673e407aad1a5240ff83db23">default_vehicle</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#adbfed76ceedc0479ff023fea9ba7a84c">os_settings</a> = &amp;<a class="code" href="group__state__engine.html#gad9e02be6d2d0bc1ab5cd9fd8cae34230">default_os_settings</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#ad0b0375d2c1674abc6f972eec47e9cb7">mc_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a1c7fecf890841f27a4ca39fc66e8cc1b">mc_default_settings</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a7a5207ef389290242764f49c6c48a5ad">driving_loop_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a44daa1a9c68be860616e7bc627d9b8f4">default_dl_settings</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#af8dbf93ac51eb9fdc8911644d096486d">imd_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a1071bc1cceac3198de98d9c0753044d6">default_imd_settings</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6cdca5b5474080f1dff4d19ef96435e1">bms_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a28e4314b233b9140e73e4fd0bab7e354">default_bms_settings</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6caecf0c9fd669e421c4005600d81b71">daq_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#ad795c6981571499e4a90ef72698b6ea1">default_daq_settings</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a191aefb9e6f4516a91157e5d6d68205b">daq_param_list</a> = <a class="code" href="uvfr__settings_8c.html#af5ab2cd7ec858145d49d4e585e4bef94">default_datapoints</a>; <span class="comment">//Does not need to be a ptr, since this is an array</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a01bbfda07b06d31224993ddf9745d285">pdu_settings</a> = &amp;<a class="code" href="uvfr__settings_8c.html#a07c6d6c6f641c6fb60600b9bd7efbf7e">default_pdu_settings</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#ae0c9377c4f8df54ad4b59d4ac4ab39fe">flags</a> |= 0x0001; <span class="comment">//This is default settings</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a4648237563030182a8309d8c75e12205">  260</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a4648237563030182a8309d8c75e12205">nukeSettings</a>(<a class="code" href="structuv__vehicle__settings.html">uv_vehicle_settings</a>** settings_to_delete){</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    uvFree(*settings_to_delete);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    *settings_to_delete = NULL;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#ae9ab130db00266635709bb7fb72c1844">  274</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#ae9ab130db00266635709bb7fb72c1844">uvLoadSettingsFromFlash</a>(){</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> != NULL){</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        uvFree(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">//real trap shit</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> = uvMalloc(<span class="keyword">sizeof</span>(<a class="code" href="structuv__vehicle__settings.html">uv_vehicle_settings</a>));</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> == NULL){</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6a386c439058f4464e4b82acd1315258">veh_info</a> = (<a class="code" href="structveh__gen__info.html">veh_gen_info</a>*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + 256*<a class="code" href="uvfr__settings_8h.html#aa896deeb35bafb45b994e9c1d0c6500a">GENERAL_VEH_INFO_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#abcf807ab03bef940a111bb64cfffecfa">GENERAL_VEH_INFO_OFFSET</a>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#adbfed76ceedc0479ff023fea9ba7a84c">os_settings</a> = (<a class="code" href="structuv__os__settings.html">uv_os_settings</a>*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + <a class="code" href="uvfr__settings_8h.html#ae727eadb1cf71a3feeb12b7bb2eb83d5">OS_SETTINGS_MGROUP</a>*256 + <a class="code" href="uvfr__settings_8h.html#a012d0d54f18a0eeee83d89f5786db5d5">OS_SETTINGS_OFFSET</a>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#ad0b0375d2c1674abc6f972eec47e9cb7">mc_settings</a> = (<a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a>*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + <a class="code" href="uvfr__settings_8h.html#aad0db57c7f8c7937be54192d7b74bdcf">MOTOR_MGROUP</a>*256 + <a class="code" href="uvfr__settings_8h.html#aa990a9c990001dc29a5ee5fdde3773e4">MOTOR_OFFSET</a>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a7a5207ef389290242764f49c6c48a5ad">driving_loop_settings</a> = (<a class="code" href="structdriving__loop__args.html">driving_loop_args</a>*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + <a class="code" href="uvfr__settings_8h.html#aaad501c2b79f55f1bbbae030b6a18dcd">DRIVING_MGROUP</a> + <a class="code" href="uvfr__settings_8h.html#a16f051ea34ee4f4965e4d11f3745d742">DRIVING_OFFSET</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#af8dbf93ac51eb9fdc8911644d096486d">imd_settings</a> = <a class="code" href="uvfr__settings_8h.html#ae99330d4904337e9a603ad2df6758b95">IMD_ADDR</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6cdca5b5474080f1dff4d19ef96435e1">bms_settings</a> = <a class="code" href="uvfr__settings_8h.html#ab638ad0845e4b5e7007e314c83bc43d5">BMS_ADDR</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a6caecf0c9fd669e421c4005600d81b71">daq_settings</a> = <a class="code" href="uvfr__settings_8h.html#aae3049baf8d0bf80753c7b0da5ec8260">DAQ_HEAD_ADDR</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a191aefb9e6f4516a91157e5d6d68205b">daq_param_list</a> = <a class="code" href="uvfr__settings_8h.html#ae385496a129924fb290839da5bfa90a2">DAQ_PARAMS1_ADDR</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a>-&gt;<a class="code" href="structuv__vehicle__settings.html#a01bbfda07b06d31224993ddf9745d285">pdu_settings</a> = (<span class="keywordtype">void</span>*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + <a class="code" href="uvfr__settings_8h.html#aa77056695d9689ca6642d5b7176e33c9">PDU_MGROUP</a>*256 + <a class="code" href="uvfr__settings_8h.html#a8336472ba83c36033d7d4511a2e3b53e">PDU_OFFSET</a>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a086bfc48f5a63b15586c6a2a8a1d29a8">  305</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a086bfc48f5a63b15586c6a2a8a1d29a8">uvConfigSettingTask</a>(<span class="keywordtype">void</span>* args){</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="structuv__task__info.html">uv_task_info</a>* setting_task = <a class="code" href="group__state__engine__api.html#ga99bfc92472cdc99e9005e9d3c792909a">uvCreateTask</a>();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span>(setting_task == NULL){</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#ad24b438130bb3098ee5e855222dff21d">task_name</a> = <span class="stringliteral">&quot;Set_settings&quot;</span>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#afcd240d2b6b01b4acea600ef4dfe8fbc">task_function</a> = <a class="code" href="uvfr__settings_8c.html#a2f0cb7e05c1bef0501d585df7c2c6013">uvSettingsProgrammerTask</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#aff45751f7189980589d55379d1d5a355">task_priority</a> = <a class="code" href="group__state__engine__api.html#gga6166ed80f8e3bd62f1e7e6122c8817f6a052e6887345173e8b7556738c28fa920">ABOVE_NORMAL</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#a353ec6bf2c42ab0920f3d1e671e568a3">stack_size</a> = 512;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#ab24dea3bde4de2d839bf15e65c2df0d6">active_states</a> = <a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286">PROGRAMMING</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#aafd4e2d916f50b54b99fd02d63831e43">suspension_states</a> = 0x00;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#a6986d7216c7f889164931b37ab752c29">deletion_states</a> = 0xFFFF &amp; ~<a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286">PROGRAMMING</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#ad157811debce6672bb6d00da7e90b6ca">task_period</a> = 20;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    setting_task-&gt;<a class="code" href="structuv__task__info.html#ae255dff9b38fc8c0754085060e8ae699">task_args</a> = NULL;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#adc9522bb052011b07febe1235d1a4792">  334</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#adc9522bb052011b07febe1235d1a4792">uvSettingsInit</a>() PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="group__uvfr__can__api.html#ga81adc4a577110ce8fe1158b0dc302cc2">insertCANMessageHandler</a>(0x520,<a class="code" href="uvfr__settings_8c.html#afa15631878f6d936a1143656f88f3620">handleIncomingLaptopMsg</a>); <span class="comment">//Allows us to talk with laptop</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> = uvMalloc(<span class="keyword">sizeof</span>(<a class="code" href="structuv__vehicle__settings.html">uv_vehicle_settings</a>));</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a> == NULL){</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">//HMMM</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="uvfr__utils_8h.html#a92b5ac44171d49acd084c274385a043a">__uvInitPanic</a>(); <span class="comment">// deeply unfortunate</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">//uvConfigSettingTask(current_vehicle_settings);</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">//First we check the validity of the settings in flash.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">bool</span> use_factory_default = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">bool</span> force_flash_rewrite = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">//Check for existing valid flash settings</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> retval = <a class="code" href="uvfr__settings_8c.html#a0be2604cded239f54f4f4ab61460a85c">uvValidateFlashSettings</a>();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span>(retval == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){ <span class="comment">//If the thing responds with OK, then we attempt to load flash settings</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#ae9ab130db00266635709bb7fb72c1844">uvLoadSettingsFromFlash</a>() == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">//Attempt to load flash settings. If that somehow fails, revert to factory defaults</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            use_factory_default = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#ae9ab130db00266635709bb7fb72c1844">uvLoadSettingsFromFlash</a>()== <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="comment">//Could not actually load from flash. BAD!</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="comment">//In this case we would like to revert to factory defaults!</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            use_factory_default = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">//In this case, we need to check to see if we need to send out a msg for the VCU</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">if</span>((uint32_t)(*(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + 4))){</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>)!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        use_factory_default = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        force_flash_rewrite = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span>(use_factory_default == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">setupDefaultSettings</a>() == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="comment">//great success.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">setupDefaultSettings</a>() != <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="comment">//FAILURE TO EVEN LOAD THE DEFAULTS, THIS CAR IS UNDRIVEABLE</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <a class="code" href="uvfr__utils_8h.html#a92b5ac44171d49acd084c274385a043a">__uvInitPanic</a>();</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">if</span>(force_flash_rewrite == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordtype">void</span>* tmp_sblock = uvMalloc(<a class="code" href="uvfr__settings_8h.html#ae3422980a714e1a061dc8c4685a1d613">SETTING_BRANCH_SIZE</a>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#ac9480e8bfbccfda4b4c7316bdb55ba87">uvResetFlashToDefault</a>(tmp_sblock)==<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="comment">//Things to do upon success (this thing is somewhat self explanitory</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        uvFree(tmp_sblock);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">setupDefaultSettings</a>();<span class="comment">// Temporary and forces default settings</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#adfd1bb6988b37f38e799bb1f996ac005">  411</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#adfd1bb6988b37f38e799bb1f996ac005">uvUpdateTmpSettings</a>(uint8_t* tmp_settings, uint8_t memgroup, uint8_t m_offset, uint8_t size, uint8_t* data){</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span>(!tmp_settings){</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span>(memgroup &gt; 12){</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment">//out of range</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span>(((m_offset + size)%128)&lt;size){</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">//Check for certain illegal combinations of things below:</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">//This first case is to see if it is editing the reserved area of the sblock.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span>((memgroup == 0)&amp;&amp;(m_offset &lt; 32)){</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    uint32_t offset = memgroup*256 + m_offset;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;size; i++){</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        *(tmp_settings + offset + i) = *(data + i); <span class="comment">//ensure correct number comes through. //CONFIRMED THIS WORKS IF LAPTOP SENDS LITTLE ENDIAN</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">//NOTE: I Have not finished implementing the checksums here.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#aec8886c47c65892251b444760cb30116">  448</a></span>&#160;uint32_t <a class="code" href="uvfr__settings_8c.html#aec8886c47c65892251b444760cb30116">uvComputeChunkChecksum</a>(uint32_t* chunk){</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    uint32_t tmp;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    uint32_t buf[9];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    buf[8] = 0;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 8; i++){</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        buf[i] = chunk[i];</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt; 256; i++){</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        buf[i/32] ^= (<a class="code" href="uvfr__settings_8h.html#a3a57af5c3275b2f53fa64274b11e8d52">CRC_POLY</a> &lt;&lt; i%32);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a90cba009630be4dc991f7de6cbede4d8">  463</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a90cba009630be4dc991f7de6cbede4d8">uvComputeMemRegionChecksum</a>(<span class="keywordtype">void</span>* sblock, uint32_t* csums ,<span class="keywordtype">char</span> mregion){</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;32 ; i++){</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        *(csums + i*<span class="keyword">sizeof</span>(uint32_t)) = <a class="code" href="uvfr__settings_8c.html#aec8886c47c65892251b444760cb30116">uvComputeChunkChecksum</a>(sblock + i*8*4);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;}</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#aee72930bcdad229cbe8a8adb73e4a3b3">  472</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#aee72930bcdad229cbe8a8adb73e4a3b3">uvComputeSettingsChecksums</a>(<span class="keywordtype">void</span>* sblock, uint32_t* csums){</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">//Compute the checksums of the sblock</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">//8 to 1 reducgtion</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> retval = <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 12; i++){</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        retval = <a class="code" href="uvfr__settings_8c.html#a90cba009630be4dc991f7de6cbede4d8">uvComputeMemRegionChecksum</a>(sblock, csums, i);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span>(retval != <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a84fc0703372fd83581befabb9fba3858">  495</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a84fc0703372fd83581befabb9fba3858">uvValidateChecksums</a>(<span class="keywordtype">void</span>* sblock){</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    uint32_t* csums = uvMalloc(512);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span>(csums == NULL){</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="comment">//BIG UHH OHH</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="uvfr__settings_8c.html#aee72930bcdad229cbe8a8adb73e4a3b3">uvComputeSettingsChecksums</a>(sblock, csums);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a2284c8b3e2b6e434f6a1d322396efdb2">  511</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a2284c8b3e2b6e434f6a1d322396efdb2">uvSBlockCorruptionHandler</a>() PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">//We need to forcibly revert to factory default. Unsure about ability to write to flash.</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordtype">void</span>* addr = <a class="code" href="uvfr__settings_8h.html#a1af6d32a5f9f7c214731b3cdde2ae48d">FLASH_SBLOCK_START</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">bool</span> successful_write = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    taskENTER_CRITICAL();</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;3; i++){</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span>(HAL_FLASH_Unlock() == HAL_OK){</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    __HAL_FLASH_CLEAR_FLAG(FLASH_FLAG_EOP | FLASH_FLAG_OPERR | FLASH_FLAG_WRPERR | FLASH_FLAG_PGAERR | FLASH_FLAG_PGSERR | FLASH_FLAG_PGPERR);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">//Set the start of the Sblock to 0, therefore causing uvValidate</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">if</span>(HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD,(uint32_t)addr,0x00000000)!= HAL_OK){</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">//If this does not work, then more drastic measures may be needed.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">//Manually erase entire sector in hardware.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="comment">//Note that this will also destroy any persistent data, but we have genuinely much bigger fish to fry at this point, like the literal vehicle settings are corrupted WTF do you want from me, man?</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">while</span>((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="comment">//Wait till no longer busy</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        FLASH-&gt;CR |= (FLASH_CR_SNB_0 | FLASH_CR_SNB_1 | FLASH_CR_SNB_3); <span class="comment">// Sector 11</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        FLASH-&gt;CR |= FLASH_CR_SER; <span class="comment">//Queue up a flash erase operation</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        FLASH-&gt;CR |= FLASH_CR_STRT; <span class="comment">//Tells the hardware to begin flash clear procces</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">while</span>((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="comment">//Wait till no longer busy</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    HAL_FLASH_Lock();<span class="comment">//Always remember to lock the flash.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    taskEXIT_CRITICAL();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;};</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a36192e27458271ff052029579febb5a1">  555</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a36192e27458271ff052029579febb5a1">uvOverwriteCsr</a>(<span class="keywordtype">void</span>* sblock, uint32_t* csr){</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a65bd5632c9f844eac3ead2787cb1375c">  563</a></span>&#160;<span class="preprocessor">#define FLASH_OK 0</span></div>
<div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a0acc0e528de17ca0616ca14d82e92ba5">  564</a></span>&#160;<span class="preprocessor">#define INVALID_SBLOCK 1</span></div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a7922bc9d90bb507f9885103792e4343f">  565</a></span>&#160;<span class="preprocessor">#define FLASH_NOT_UNLOCKED 2</span></div>
<div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a0202712190ca1bce6a198dd196f48c4b">  566</a></span>&#160;<span class="preprocessor">#define DID_NOT_FINISH_PROGRAMMING 3</span></div>
<div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#ae9b3336d2f9087deea03d9adac5d06fd">  567</a></span>&#160;<span class="preprocessor">#define DATA_MISMATCH 4</span></div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a4fc65d72946e3e169f15ed0015fa3d3c">  568</a></span>&#160;<span class="preprocessor">#define PRE_CHECKSUM 5</span></div>
<div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a1e63b2fed237e9d016b304884c01457b">  569</a></span>&#160;<span class="preprocessor">#define POST_CHECKSUM 6</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">  574</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a>(<span class="keywordtype">void</span>* sblock, uint32_t* ecode) PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span>(sblock == NULL){</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        *ecode = <a class="code" href="uvfr__settings_8c.html#a0acc0e528de17ca0616ca14d82e92ba5">INVALID_SBLOCK</a>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">void</span>* tmp = sblock;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">//  if(uvValidateChecksums(tmp) != UV_OK){</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">//      return UV_ABORTED;</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    *((uint32_t*)(tmp + 0)) = <a class="code" href="uvfr__settings_8h.html#a54061e5993a5517320d425f44408cc86">MAGIC_NUMBER</a>; <span class="comment">//Identifies that this is in fact a valid S_Block</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    *((uint32_t*)(tmp + 4)) = 0x00000001; <span class="comment">//Little reminder for future VCU that the settings were recently changed</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    *((uint16_t*)(tmp + 8)) = 0x1000;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    *((uint16_t*)(tmp + 10)) = <a class="code" href="uvfr__global__config_8h.html#a0b584a8bce5bc95619d58d126328d24d">FIRMWARE_MAJOR_RELEASE</a>; <span class="comment">//Identify the firmware version this is</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    *((uint16_t*)(tmp + 12)) = <a class="code" href="uvfr__global__config_8h.html#a2ada82deacaaa65d39fd8431202312e8">FIRMWARE_MINOR_RELEASE</a>; <span class="comment">//Identify the firmware version</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    *((uint16_t*)(tmp + 14)) = <a class="code" href="uvfr__global__config_8h.html#a056c3375923e87e7b3df830ea10295da">FIRMWARE_PATCH_NUM</a>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">//We save the sizes of the core setting structs, so that if someone adds or removes settings from the struct,</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">//The program will notice and load factory defaults into flash</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    *((uint8_t*)(tmp + 16)) = <span class="keyword">sizeof</span>(<a class="code" href="structveh__gen__info.html">veh_gen_info</a>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    *((uint8_t*)(tmp + 17)) = <span class="keyword">sizeof</span>(<a class="code" href="structuv__os__settings.html">uv_os_settings</a>);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    *((uint8_t*)(tmp + 18)) = <span class="keyword">sizeof</span>(<a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a>);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    *((uint8_t*)(tmp + 19)) = (uint8_t)<span class="keyword">sizeof</span>(<a class="code" href="driving__loop_8h.html#aa421e50f529a1770ef0b2a00a44a0601">driving_loop_args</a>); <span class="comment">//IDGAF if we got truncation error here, fuck you</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    *((uint8_t*)(tmp + 20)) = <span class="keyword">sizeof</span>(<a class="code" href="structuv__imd__settings.html">uv_imd_settings</a>);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    *((uint8_t*)(tmp + 21)) = <span class="keyword">sizeof</span>(<a class="code" href="structbms__settings__t.html">bms_settings_t</a>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    *((uint8_t*)(tmp + 22)) = <span class="keyword">sizeof</span>(<a class="code" href="structdaq__loop__args.html">daq_loop_args</a>);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    *((uint8_t*)(tmp + 23)) = <span class="keyword">sizeof</span>(<a class="code" href="structdaq__datapoint.html">daq_datapoint</a>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    *((uint8_t*)(tmp + 24)) = <span class="keyword">sizeof</span>(<a class="code" href="structuv19__pdu__settings.html">uv19_pdu_settings</a>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">void</span>* addr = <a class="code" href="uvfr__settings_8h.html#a1af6d32a5f9f7c214731b3cdde2ae48d">FLASH_SBLOCK_START</a>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">if</span>(HAL_FLASH_Unlock() != HAL_OK){</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        *ecode = <a class="code" href="uvfr__settings_8c.html#a7922bc9d90bb507f9885103792e4343f">FLASH_NOT_UNLOCKED</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    taskENTER_CRITICAL(); <span class="comment">//I would very much prefer if nothing fucks with this</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">while</span>((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">//Wait till no longer busy</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    FLASH-&gt;CR |= (FLASH_CR_SNB_0 | FLASH_CR_SNB_1 | FLASH_CR_SNB_3); <span class="comment">// Sector 11</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    FLASH-&gt;CR |= FLASH_CR_SER; <span class="comment">//Queue up a flash erase operation</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    FLASH-&gt;CR |= FLASH_CR_STRT; <span class="comment">//Tells the hardware to begin flash clear procces</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">while</span>((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">//Wait till no longer busy</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">while</span>(addr &lt; <a class="code" href="uvfr__settings_8h.html#aa81180ef8eb37ec6e7d99d706610680d">TOP_OF_FLASH_SBLOCK</a>){ <span class="comment">//TODO Is this the right address?</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        __HAL_FLASH_CLEAR_FLAG(FLASH_FLAG_EOP | FLASH_FLAG_OPERR | FLASH_FLAG_WRPERR | FLASH_FLAG_PGAERR | FLASH_FLAG_PGSERR | FLASH_FLAG_PGPERR);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span>(HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD,(uint32_t)addr,(uint32_t)(*(uint32_t*)tmp))!= HAL_OK){</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="comment">//ERROR ERROR AHHHH FUCK</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="comment">//uvPanic(&quot;FLASH_WRITE_ERROR&quot;);</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            *ecode = <a class="code" href="uvfr__settings_8c.html#a0202712190ca1bce6a198dd196f48c4b">DID_NOT_FINISH_PROGRAMMING</a>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            HAL_FLASH_Lock();</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        addr += 4;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        tmp += 4;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">//If we reach this point then the BSY bit of FLASH_SR register is not set</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">//Clear these error flags</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">//  FLASH-&gt;SR |= (FLASH_SR_PGSERR | FLASH_SR_PGPERR | FLASH_SR_PGAERR | FLASH_SR_WRPERR);</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">//  FLASH-&gt;CR |= (FLASH_CR_PSIZE_0 | FLASH_CR_PSIZE_1); //64 byte alignment</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">//  FLASH-&gt;CR |= FLASH_CR_PG; // Program enable</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">//  while(addr &lt; TOP_OF_FLASH_SBLOCK){</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">//      while((FLASH-&gt;SR &amp; FLASH_SR_BSY)==1){</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">//          //Dont be busy</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">//      }</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">//      *((uint64_t*)addr) = *((uint64_t*)tmp);</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">//      addr += 8;</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">//      tmp += 8;</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">//      if(FLASH-&gt;SR &amp; (FLASH_SR_PGSERR | FLASH_SR_PGPERR | FLASH_SR_PGAERR | FLASH_SR_WRPERR)){</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">//          //An error bit has been set.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">//          *ecode = DID_NOT_FINISH_PROGRAMMING; //UHH OH</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">//      }</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">//  while((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">//          //Wait till no longer busy</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">//  FLASH-&gt;CR &amp;= (~FLASH_CR_PG); //Disable the programming</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">//  while((FLASH-&gt;SR) &amp; FLASH_SR_BSY){</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">//          //Wait till no longer busy</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    FLASH-&gt;CR |= FLASH_CR_LOCK; <span class="comment">//LOCK FLASH</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    taskEXIT_CRITICAL();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">//  HAL_FLASH_Lock();</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">//Check to make sure the two match</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    tmp = sblock;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    addr = <a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">while</span>(addr &lt; <a class="code" href="uvfr__settings_8h.html#aa81180ef8eb37ec6e7d99d706610680d">TOP_OF_FLASH_SBLOCK</a>){</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">if</span>(*((uint32_t*)tmp) != *((uint32_t*)addr)){</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            *ecode = <a class="code" href="uvfr__settings_8c.html#ae9b3336d2f9087deea03d9adac5d06fd">DATA_MISMATCH</a>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>; <span class="comment">//Mismatch</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        tmp += 4;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        addr += 4;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">//  if(uvValidateChecksums(START_OF_USER_FLASH)!= UV_OK){</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">//      return UV_ERROR;</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">//  }</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;}</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a30c09e445d8f0fbfbdfd1bfa0fcfdc67">  716</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a30c09e445d8f0fbfbdfd1bfa0fcfdc67">uvSetSettingResponseReminder</a>(uint32_t reminder){</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span>(HAL_FLASH_Unlock() != HAL_OK){</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">if</span>(HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD,(uint32_t)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + 4),(uint32_t)&amp;reminder)!=HAL_OK){</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            HAL_FLASH_Lock();</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        HAL_FLASH_Lock();</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;}</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a8e128ab49bfb636a4597802418066784">  735</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a8e128ab49bfb636a4597802418066784">uvForceDefaultReversionUponDeviceReset</a>(){</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    uint32_t word = 0;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordflow">if</span>(HAL_FLASH_Unlock() != HAL_OK){</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">if</span>(HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD,(uint32_t)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a>),(uint32_t)&amp;word)!=HAL_OK){</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        HAL_FLASH_Lock();</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    HAL_FLASH_Lock();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a53df36781d38254cb6bbe6717e6ebae0">  756</a></span>&#160;<span class="keywordtype">void</span>* <a class="code" href="uvfr__settings_8c.html#a53df36781d38254cb6bbe6717e6ebae0">uvCreateTmpSettingsCopy</a>(){</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    uint64_t* sblock = uvMalloc(<a class="code" href="uvfr__settings_8h.html#ae3422980a714e1a061dc8c4685a1d613">SETTING_BRANCH_SIZE</a>);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">if</span>(sblock == NULL){</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    uint64_t* tmp = (uint64_t*)(<a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a>);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="uvfr__settings_8h.html#ae3422980a714e1a061dc8c4685a1d613">SETTING_BRANCH_SIZE</a>; i += 8){</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        *(sblock + i) = *(tmp + i);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)sblock;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;}</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#abdad8cd245f0f77d58548f011775a572">  778</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#abdad8cd245f0f77d58548f011775a572">uvSendSpecificParam</a>(uint8_t* origin, uint8_t mgroup, uint8_t m_offset, uint8_t size){</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a> blank_msg;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    blank_msg.<a class="code" href="structuv___c_a_n__msg.html#a3a3fdc7fed06a631fefa58ea44052d8d">flags</a> = 0x00;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aae369fbabe3cc5b71a89bb641c24aace">msg_id</a> = 0x420;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[0] = 0b00100000 | mgroup;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[1] = m_offset;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aa74af3745c8b56910d7c309245541d37">dlc</a> = 2 + size;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    uint8_t* ptr = <a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a> + 256*mgroup + m_offset;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;4 ;i++){</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        blank_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[2+i] = *(ptr+i);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;blank_msg) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a0be2604cded239f54f4f4ab61460a85c">  810</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a0be2604cded239f54f4f4ab61460a85c">uvValidateFlashSettings</a>(){</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordtype">void</span>* tmp = <a class="code" href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">if</span>(*((uint32_t*)tmp) != <a class="code" href="uvfr__settings_8h.html#a54061e5993a5517320d425f44408cc86">MAGIC_NUMBER</a>){</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;<span class="comment">// Nice blank slate</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">//NEXT we check the firmware number, and that nobody screwed around with the struct contents</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">//if any of these dont match, then the firmware does not match the settings block</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 16)) != <span class="keyword">sizeof</span>(<a class="code" href="structveh__gen__info.html">veh_gen_info</a>)){</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">if</span>( *((uint8_t*)(tmp + 17)) != <span class="keyword">sizeof</span>(<a class="code" href="structuv__os__settings.html">uv_os_settings</a>)){</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 18)) != <span class="keyword">sizeof</span>(<a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a>)){</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 19)) != (uint8_t)(<span class="keyword">sizeof</span>(<a class="code" href="structdriving__loop__args.html">driving_loop_args</a>))){</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 20)) != <span class="keyword">sizeof</span>(<a class="code" href="structuv__imd__settings.html">uv_imd_settings</a>)){</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 21)) != <span class="keyword">sizeof</span>(<a class="code" href="structbms__settings__t.html">bms_settings_t</a>)){</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 22)) != <span class="keyword">sizeof</span>(<a class="code" href="structdaq__loop__args.html">daq_loop_args</a>)){</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 23)) != <span class="keyword">sizeof</span>(<a class="code" href="structdaq__datapoint.html">daq_datapoint</a>)){</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">if</span>(*((uint8_t*)(tmp + 24)) != <span class="keyword">sizeof</span>(<a class="code" href="structuv19__pdu__settings.html">uv19_pdu_settings</a>)){</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;}</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a2f0cb7e05c1bef0501d585df7c2c6013">  864</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a2f0cb7e05c1bef0501d585df7c2c6013">uvSettingsProgrammerTask</a>(<span class="keywordtype">void</span>* args) PRIVILEGED_FUNCTION{</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="structuv__task__info.html">uv_task_info</a>* params = (<a class="code" href="structuv__task__info.html">uv_task_info</a>*) args;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    uint8_t mgroup = 0;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    uint8_t m_offset = 0;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    uint8_t d_type = 0;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    uint8_t d_size = 0;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    uint8_t cmd_byte = 0;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    uint8_t* origin = NULL;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a> tmp_msg; <span class="comment">//messages get written into here when</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordtype">void</span>* new_tmp_settings = <a class="code" href="uvfr__settings_8c.html#a53df36781d38254cb6bbe6717e6ebae0">uvCreateTmpSettingsCopy</a>();</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span>(new_tmp_settings == NULL){</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment">//Did not create temp settings &gt;:(</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>); <span class="comment">//Let laptop know of our failures</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a6726b669a3c5795c3326238ab974f382">ptask_handle</a> = params-&gt;<a class="code" href="structuv__task__info.html#a5347f41c4b15b2d6b039c339613fde43">task_handle</a>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">//uvSendCanMSG(&amp;vcu_ack_msg);</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a> = xQueueCreate(8, <span class="keyword">sizeof</span>(<a class="code" href="structuv___c_a_n__msg.html">uv_CAN_msg</a>));</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a> == NULL){</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        uvPanic(<span class="stringliteral">&quot;Settings Queue Not Created&quot;</span>,0);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">//Cached temporary variables for incoming programming messages</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>); <span class="comment">//successfully entered the task</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">for</span>(;;){</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span>(xQueueReceive(<a class="code" href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a>,&amp;tmp_msg,100)!=pdTRUE){</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="comment">//laptop connection lost. Yowza. Discard whatever you&#39;re doin.</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">//          if((xTaskGetTickCount() - last_contact_with_laptop) &gt; 200){</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">//              //more than 200ms have passed since last communication.</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">//              changeVehicleState(UV_READY); // leave the task</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">//          }</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="comment">/* WARNING: This is a goto. I know goto is prety heinous.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">             *</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="keywordflow">goto</span> __END_OF_SETTING_TASK_LOOP__;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        cmd_byte = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[0];</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">switch</span>(cmd_byte){</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a7091f0610d47127e952576fcf2d72eac">SET_SPECIFIC_PARAM</a> ... <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694aefd2ddc079bf62b63b3e5226b9a83ac3">END_OF_SPECIFIC_PARAMS</a>:</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                mgroup = (cmd_byte &amp;(0b00011111));</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                m_offset = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[1];</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                d_type = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[2];</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                d_size = <a class="code" href="uvfr__utils_8h.html#a657e7e858d8847396634fd9912747f8b">data_size</a>[d_type];</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#adfd1bb6988b37f38e799bb1f996ac005">uvUpdateTmpSettings</a>(new_tmp_settings, mgroup, m_offset, d_size, (tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a> + 3)) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                    <span class="comment">//Send back an ACK</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                    <span class="comment">//reply that it failed</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a9b0e526098fd6c30dc93538edba59405">REQUEST_ALL_SETTINGS</a>:</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                <span class="comment">//Well I guess now we gotta transmit the whole shabang</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                <span class="comment">//Time for probably the most fucked task I&#39;ve done in a hot minute</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a205322c736d66df92b6d968b53648acb">REQUEST_ALL_JOURNAL_ENTRIES</a>:</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                <span class="comment">//This is not yet implemented.</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a4313d65a75fd41f3e527b330e7370a5e">REQUEST_JOURNAL_ENTRIES_BY_TIME</a>:</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                <span class="comment">//This is not yet implemented</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ac53400ee472ace47006a18aaaa4a86a0">REQUEST_SPECIFIC_SETTING</a>:</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <span class="comment">//We wish to know the value of a specific setting</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                mgroup = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[2];</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                m_offset = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[3];</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                d_type = tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[4];</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                d_size = <a class="code" href="uvfr__utils_8h.html#a657e7e858d8847396634fd9912747f8b">data_size</a>[d_type];</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                origin = (tmp_msg.<a class="code" href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">data</a>[1])? <a class="code" href="uvfr__settings_8h.html#a1af6d32a5f9f7c214731b3cdde2ae48d">FLASH_SBLOCK_START</a> : new_tmp_settings;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#abdad8cd245f0f77d58548f011775a572">uvSendSpecificParam</a>(origin,mgroup,m_offset,d_size) != <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                    <span class="comment">//HANDLE THIS ERROR HERE</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a8ad6825ef0a84f2615148dc63202be1f">SAVE_AND_APPLY_NEW_SETTINGS</a>:</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="comment">//Save and apply. Hoo boy.</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                uint32_t ecode = 0;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a>(new_tmp_settings, &amp;ecode) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                    <span class="comment">//Try once</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>); <span class="comment">//report success</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a>(new_tmp_settings, &amp;ecode) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                    <span class="comment">//Try again</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                    <span class="comment">//This is a tricky one. High probability of data corruption.</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                    <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a0acc0e528de17ca0616ca14d82e92ba5">INVALID_SBLOCK</a>){</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                        <span class="comment">//Womp womp, the SBLOCK you provided is not ok</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a7922bc9d90bb507f9885103792e4343f">FLASH_NOT_UNLOCKED</a>){</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                        <span class="comment">//Failure to unlock flash. Why?</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a0202712190ca1bce6a198dd196f48c4b">DID_NOT_FINISH_PROGRAMMING</a>){</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                        <span class="comment">//Partially programmed. Indicates data has been corrupted.</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                        <span class="comment">//FORCE RESET, CANNOT CONTINUE</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#ae9b3336d2f9087deea03d9adac5d06fd">DATA_MISMATCH</a>){</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                        <span class="comment">//Data in flash does not match what has been programmed</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        <span class="comment">//FORCE RESET, CANNOT CONTINUE</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a4fc65d72946e3e169f15ed0015fa3d3c">PRE_CHECKSUM</a>){</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                        <span class="comment">//Checksum failure of sblock prior to save attempt</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a1e63b2fed237e9d016b304884c01457b">POST_CHECKSUM</a>){</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                        <span class="comment">//Checksum failure of flash, post save - CORRUPTION</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode != 0){</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                            <span class="comment">/* This section of code is one of the worst places to be in the vehicle.</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">                             *</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">                             */</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                    }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a485f41f6d806239622abbac7aef60557">DISCARD_NEW_SETTINGS</a>:</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                <span class="keywordflow">if</span>(uvFree(new_tmp_settings) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                    new_tmp_settings = <a class="code" href="uvfr__settings_8c.html#a53df36781d38254cb6bbe6717e6ebae0">uvCreateTmpSettingsCopy</a>();</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    <span class="keywordflow">if</span>(new_tmp_settings != NULL){</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                        <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                        <span class="comment">//This means that we have succeeded, as we have deleted the old settings,</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                        <span class="comment">//and new settings have taken their place</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                        <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                        uvPanic(<span class="stringliteral">&quot;uhh oh&quot;</span>,0);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                    }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                    <span class="comment">//Not OK</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                    <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a>);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                    uvPanic(<span class="stringliteral">&quot;uhh oh&quot;</span>,0);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694abe34f5f2d055215f2ff2e2d85401199a">DISCARD_NEW_SETTINGS_AND_EXIT</a>:</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                <span class="comment">//uvFree(new_tmp_settings); //No need to free, this happens in the destructor</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                <a class="code" href="group__state__engine__api.html#gaa3ad3e8df75177c00265881c16563212">changeVehicleState</a>(<a class="code" href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4a9ec1eef180c6208b25b08f0526dc5eb8">UV_READY</a>);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                <a class="code" href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a>(&amp;<a class="code" href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a>);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a302a39661f2460e559645419a2ac8258">FORCE_RESTORE_FACTORY_DEFAULT</a>:</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#ac9480e8bfbccfda4b4c7316bdb55ba87">uvResetFlashToDefault</a>(new_tmp_settings) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    <span class="comment">//Success</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    <span class="comment">//failure</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <span class="comment">//unrecognized command spotted</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        __END_OF_SETTING_TASK_LOOP__:</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">if</span>(params-&gt;<a class="code" href="structuv__task__info.html#af532b5031cd6a168a3ec45ab9ead4f23">cmd_data</a> == <a class="code" href="group__state__engine__api.html#ggaf11e8677926913f2dd803fabbed3455ca0e75e398c2bbcb663eaeb98684ca69d6">UV_KILL_CMD</a>){</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <span class="comment">//TODO add destructors here</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="keywordflow">if</span>(new_tmp_settings != NULL){</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                uvFree(new_tmp_settings);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <a class="code" href="group__state__engine__backend.html#ga5f35b34432afed7f18f91fb8607f096f">killSelf</a>(params); <span class="comment">//Me too programming and diagnostics task, me too</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="keywordflow">while</span>(1){ <span class="comment">//hang</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    }</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a5f5ab3b99bc259455a2ec79144422450"> 1057</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#ac9480e8bfbccfda4b4c7316bdb55ba87">uvResetFlashToDefault</a>(<span class="keywordtype">void</span>* new_sblock){</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">//void* new_sblock = uvMalloc(SETTING_BRANCH_SIZE);</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span>(new_sblock == NULL){</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>; <span class="comment">//definately not ideal</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;<a class="code" href="uvfr__settings_8h.html#ae3422980a714e1a061dc8c4685a1d613">SETTING_BRANCH_SIZE</a>; i += 4){</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        *((uint32_t*)(new_sblock + i)) = 0xFFFFFFFF;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    } <span class="comment">//Become Zeros</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160; </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    *((uint32_t*)(new_sblock)) = <a class="code" href="uvfr__settings_8h.html#a54061e5993a5517320d425f44408cc86">MAGIC_NUMBER</a>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">//uint32_t pdiff = ((uint32_t)new_sblock) - ((uint32_t)START_OF_USER_FLASH);</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a550e75d7673e407aad1a5240ff83db23">default_vehicle</a>),new_sblock + <a class="code" href="uvfr__settings_8h.html#abcf807ab03bef940a111bb64cfffecfa">GENERAL_VEH_INFO_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structveh__gen__info.html">veh_gen_info</a>));</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">//OS</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="group__state__engine.html#gad9e02be6d2d0bc1ab5cd9fd8cae34230">default_os_settings</a>),(new_sblock + <a class="code" href="uvfr__settings_8h.html#a012d0d54f18a0eeee83d89f5786db5d5">OS_SETTINGS_OFFSET</a> ),<span class="keyword">sizeof</span>(<a class="code" href="structuv__os__settings.html">uv_os_settings</a>));</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">//Motor controller</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a1c7fecf890841f27a4ca39fc66e8cc1b">mc_default_settings</a>),(new_sblock+256*<a class="code" href="uvfr__settings_8h.html#aad0db57c7f8c7937be54192d7b74bdcf">MOTOR_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#aa990a9c990001dc29a5ee5fdde3773e4">MOTOR_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a>));</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">//Driving Loop</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a44daa1a9c68be860616e7bc627d9b8f4">default_dl_settings</a>),(new_sblock+256*<a class="code" href="uvfr__settings_8h.html#aaad501c2b79f55f1bbbae030b6a18dcd">DRIVING_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#a16f051ea34ee4f4965e4d11f3745d742">DRIVING_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structdriving__loop__args.html">driving_loop_args</a>));</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">//BMS</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a28e4314b233b9140e73e4fd0bab7e354">default_bms_settings</a>),(new_sblock+256*<a class="code" href="uvfr__settings_8h.html#a25a35d43902b9bec03daae2ef17883b1">BMS_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#a95973d7f17e9a5994743b16520f6a136">BMS_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structbms__settings__t.html">bms_settings_t</a>));</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="comment">//IMD</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a1071bc1cceac3198de98d9c0753044d6">default_imd_settings</a>),(new_sblock+256*<a class="code" href="uvfr__settings_8h.html#ae5fe9f0cb3fad913bd688758c9b24d79">IMD_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#a790b81866b0c7880d2d8fcb39880885a">IMD_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structuv__imd__settings.html">uv_imd_settings</a>));</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">//PDU</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(&amp;<a class="code" href="uvfr__settings_8c.html#a07c6d6c6f641c6fb60600b9bd7efbf7e">default_pdu_settings</a>),new_sblock + 256*<a class="code" href="uvfr__settings_8h.html#aa77056695d9689ca6642d5b7176e33c9">PDU_MGROUP</a> + <a class="code" href="uvfr__settings_8h.html#a8336472ba83c36033d7d4511a2e3b53e">PDU_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structuv19__pdu__settings.html">uv19_pdu_settings</a>));</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">//DAQ Head + Meta settings</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)&amp;<a class="code" href="uvfr__settings_8c.html#ad795c6981571499e4a90ef72698b6ea1">default_daq_settings</a>,(new_sblock+256*<a class="code" href="uvfr__settings_8h.html#a14f988f2e948d8f522f0ef04a29762d6">DAQ_HEAD_MGROUP</a>+<a class="code" href="uvfr__settings_8h.html#afc36afa04b73fc9a1ea92b22e6cb564f">DAQ_HEAD_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structdaq__loop__args.html">daq_loop_args</a>));</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">//Settings Being Logged</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a>((uint8_t*)(<a class="code" href="uvfr__settings_8c.html#af5ab2cd7ec858145d49d4e585e4bef94">default_datapoints</a>),(new_sblock + 256*<a class="code" href="uvfr__settings_8h.html#a084bd6444fb9817cc88531b879ba571b">DAQ_PARAMS1_MGROUP</a> + <a class="code" href="uvfr__settings_8h.html#a10d6e75bc6bdeb4dec495cbfe05682fd">DAQ_PARAMS1_OFFSET</a>),<span class="keyword">sizeof</span>(<a class="code" href="structuv__imd__settings.html">uv_imd_settings</a>)*<a class="code" href="uvfr__settings_8c.html#ad795c6981571499e4a90ef72698b6ea1">default_daq_settings</a>.<a class="code" href="structdaq__loop__args.html#acb7bf20ade7a6544c747aebc165b7faf">total_params_logged</a>);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">//  settingCopy(0,0,0);</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">//  settingCopy(0,0,0);</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160; </div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    uint32_t ecode = 0;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a>(new_sblock, &amp;ecode) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            <span class="comment">//Try once</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="comment">//uvSendCanMSG(&amp;vcu_ack_msg); //report success</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a>(new_sblock, &amp;ecode) == <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">//Try again</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment"></span>        <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="comment">//Once we reach this point we know that some error has in fact occurred.</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a0acc0e528de17ca0616ca14d82e92ba5">INVALID_SBLOCK</a>){</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a7922bc9d90bb507f9885103792e4343f">FLASH_NOT_UNLOCKED</a>){</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a0202712190ca1bce6a198dd196f48c4b">DID_NOT_FINISH_PROGRAMMING</a>){</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#ae9b3336d2f9087deea03d9adac5d06fd">DATA_MISMATCH</a>){</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a4fc65d72946e3e169f15ed0015fa3d3c">PRE_CHECKSUM</a>){</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode == <a class="code" href="uvfr__settings_8c.html#a1e63b2fed237e9d016b304884c01457b">POST_CHECKSUM</a>){</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ecode != 0){</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="comment">/* This section of code is one of the worst places to be in the vehicle.</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="comment">//If we reach this point, then both attempts at uvSaveSettingsToFlash have failed</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">//This is not a good situation to be in, since data corruption may have occurred.</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;}</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb"> 1143</a></span>&#160;<a class="code" href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a> <a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(uint8_t* origin,uint8_t memgroup,uint8_t m_offset, uint16_t size){</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    uint16_t newsize = size + size%4;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="comment">//We always send the 32 bit word, because the VCU does not track what the individual types of struct members are.</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="comment">//Doing so would be stupid complicated, so not gonna bother.</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;newsize; i+=4){</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="comment">//Send the actual msg</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#abdad8cd245f0f77d58548f011775a572">uvSendSpecificParam</a>(origin,memgroup,m_offset + i,4)!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a>;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="comment">//Find a way to await an ack message</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;}</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a4610dbfba4a1c427386d906bfc656b77"> 1163</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a4610dbfba4a1c427386d906bfc656b77">sendAllSettingsWorker</a>(<span class="keywordtype">void</span>* args){</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="structsetting__helper__task.html">setting_helper_task</a>* params = (<a class="code" href="structsetting__helper__task.html">setting_helper_task</a>*) args;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="uvfr__settings_8c.html#a19de39f55cc05851f5fa6a40070681e3">child_task_handle</a> = params-&gt;<a class="code" href="structsetting__helper__task.html#a867ac831a9ae5bbfb2ee7b32d63e8916">meta_task_handle</a>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    uint8_t* origin = params-&gt;<a class="code" href="structsetting__helper__task.html#a2db368e63a9cc11c26caa2a0eacfca45">args</a>.<a class="code" href="unionhelper__task__args.html#a083dff2889a9c9006875745783ed5f45">setting_tx_args</a>.<a class="code" href="structtx__all__settings__args.html#a8e42222b51c2f152869fc760560442b0">sblock_origin</a>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span>(!origin){</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        origin = <a class="code" href="uvfr__settings_8h.html#a1af6d32a5f9f7c214731b3cdde2ae48d">FLASH_SBLOCK_START</a>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    params-&gt;<a class="code" href="structsetting__helper__task.html#a7446a818ec9497a6b93a7995bf8b66d3">status</a> = <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="uvfr__settings_8c.html#af0cbf7f4ea57695f3b1d2d3c83844000">child_task_active</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160; </div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">//Get through all this stuff first</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#aa896deeb35bafb45b994e9c1d0c6500a">GENERAL_VEH_INFO_MGROUP</a>, <a class="code" href="uvfr__settings_8h.html#abcf807ab03bef940a111bb64cfffecfa">GENERAL_VEH_INFO_OFFSET</a>, <span class="keyword">sizeof</span>(<a class="code" href="structveh__gen__info.html">veh_gen_info</a>))!= <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#ae727eadb1cf71a3feeb12b7bb2eb83d5">OS_SETTINGS_MGROUP</a>, <a class="code" href="uvfr__settings_8h.html#a012d0d54f18a0eeee83d89f5786db5d5">OS_SETTINGS_OFFSET</a>, <span class="keyword">sizeof</span>(<a class="code" href="structuv__os__settings.html">uv_os_settings</a>))!= <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#aad0db57c7f8c7937be54192d7b74bdcf">MOTOR_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#aa990a9c990001dc29a5ee5fdde3773e4">MOTOR_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structmotor__controller__settings.html">motor_controller_settings</a>))!= <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#aaad501c2b79f55f1bbbae030b6a18dcd">DRIVING_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#a16f051ea34ee4f4965e4d11f3745d742">DRIVING_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structdriving__loop__args.html">driving_loop_args</a>))!= <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#ae5fe9f0cb3fad913bd688758c9b24d79">IMD_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#a790b81866b0c7880d2d8fcb39880885a">IMD_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structuv__imd__settings.html">uv_imd_settings</a>))!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#a25a35d43902b9bec03daae2ef17883b1">BMS_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#a95973d7f17e9a5994743b16520f6a136">BMS_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structbms__settings__t.html">bms_settings_t</a>))!= <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#a14f988f2e948d8f522f0ef04a29762d6">DAQ_HEAD_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#afc36afa04b73fc9a1ea92b22e6cb564f">DAQ_HEAD_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structdaq__loop__args.html">daq_loop_args</a>))!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,<a class="code" href="uvfr__settings_8h.html#aa77056695d9689ca6642d5b7176e33c9">PDU_MGROUP</a>,<a class="code" href="uvfr__settings_8h.html#a8336472ba83c36033d7d4511a2e3b53e">PDU_OFFSET</a>,<span class="keyword">sizeof</span>(<a class="code" href="structuv19__pdu__settings.html">uv19_pdu_settings</a>)) != <a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">//Next is whatever in god&#39;s green earth the DAQ_datapoints are up to (Me when the edge case hits just right)</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    uint16_t remaining_bytes = (((<a class="code" href="structdaq__loop__args.html">daq_loop_args</a>*)(origin + 256*<a class="code" href="uvfr__settings_8h.html#a14f988f2e948d8f522f0ef04a29762d6">DAQ_HEAD_MGROUP</a> + <a class="code" href="uvfr__settings_8h.html#afc36afa04b73fc9a1ea92b22e6cb564f">DAQ_HEAD_OFFSET</a>))-&gt;total_params_logged)*<span class="keyword">sizeof</span>(<a class="code" href="daq_8h.html#ad3bc3bc1c9ab04b22cc999a6f7c82c40">daq_datapoint</a>);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    uint8_t t_mgroup = <a class="code" href="uvfr__settings_8h.html#a084bd6444fb9817cc88531b879ba571b">DAQ_PARAMS1_MGROUP</a>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">while</span>(remaining_bytes &gt; 256){</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,t_mgroup,<a class="code" href="uvfr__settings_8h.html#a10d6e75bc6bdeb4dec495cbfe05682fd">DAQ_PARAMS1_OFFSET</a>,256)!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        remaining_bytes -= 256;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        t_mgroup++;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    }</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a>(origin,t_mgroup,<a class="code" href="uvfr__settings_8h.html#a10d6e75bc6bdeb4dec495cbfe05682fd">DAQ_PARAMS1_OFFSET</a>,remaining_bytes)!=<a class="code" href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a>){</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="comment">//Handle this error</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    }</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="uvfr__settings_8c.html#af0cbf7f4ea57695f3b1d2d3c83844000">child_task_active</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    vTaskSuspend(NULL);</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;}</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="uvfr__settings_8c.html#a632dfb21b35fd170c003515ef4bdc291"> 1226</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="uvfr__settings_8c.html#a632dfb21b35fd170c003515ef4bdc291">sendJournalWorker</a>(<span class="keywordtype">void</span>* args){</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;}</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructsetting__helper__task_html_a7446a818ec9497a6b93a7995bf8b66d3"><div class="ttname"><a href="structsetting__helper__task.html#a7446a818ec9497a6b93a7995bf8b66d3">setting_helper_task::status</a></div><div class="ttdeci">uint32_t status</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00062">uvfr_settings.c:62</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a086bfc48f5a63b15586c6a2a8a1d29a8"><div class="ttname"><a href="uvfr__settings_8c.html#a086bfc48f5a63b15586c6a2a8a1d29a8">uvConfigSettingTask</a></div><div class="ttdeci">uv_status uvConfigSettingTask(void *args)</div><div class="ttdoc">Function to setup the parameters of the setting setter task.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00305">uvfr_settings.c:305</a></div></div>
<div class="ttc" id="astructuv__task__info_html_af532b5031cd6a168a3ec45ab9ead4f23"><div class="ttname"><a href="structuv__task__info.html#af532b5031cd6a168a3ec45ab9ead4f23">uv_task_info::cmd_data</a></div><div class="ttdeci">uv_task_cmd cmd_data</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00241">uvfr_state_engine.h:241</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_aa3e729b05a7d2931a9a1e55f52bca3c7"><div class="ttname"><a href="uvfr__settings_8c.html#aa3e729b05a7d2931a9a1e55f52bca3c7">settings_queue</a></div><div class="ttdeci">static QueueHandle_t settings_queue</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00088">uvfr_settings.c:88</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_adbfed76ceedc0479ff023fea9ba7a84c"><div class="ttname"><a href="structuv__vehicle__settings.html#adbfed76ceedc0479ff023fea9ba7a84c">uv_vehicle_settings::os_settings</a></div><div class="ttdeci">struct uv_os_settings * os_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00138">uvfr_settings.h:138</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a6cdca5b5474080f1dff4d19ef96435e1"><div class="ttname"><a href="structuv__vehicle__settings.html#a6cdca5b5474080f1dff4d19ef96435e1">uv_vehicle_settings::bms_settings</a></div><div class="ttdeci">bms_settings_t * bms_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00144">uvfr_settings.h:144</a></div></div>
<div class="ttc" id="auvfr__global__config_8h_html_a0b584a8bce5bc95619d58d126328d24d"><div class="ttname"><a href="uvfr__global__config_8h.html#a0b584a8bce5bc95619d58d126328d24d">FIRMWARE_MAJOR_RELEASE</a></div><div class="ttdeci">#define FIRMWARE_MAJOR_RELEASE</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__global__config_8h_source.html#l00018">uvfr_global_config.h:18</a></div></div>
<div class="ttc" id="astructuv__task__info_html_afcd240d2b6b01b4acea600ef4dfe8fbc"><div class="ttname"><a href="structuv__task__info.html#afcd240d2b6b01b4acea600ef4dfe8fbc">uv_task_info::task_function</a></div><div class="ttdeci">TaskFunction_t task_function</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00227">uvfr_state_engine.h:227</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a7a5207ef389290242764f49c6c48a5ad"><div class="ttname"><a href="structuv__vehicle__settings.html#a7a5207ef389290242764f49c6c48a5ad">uv_vehicle_settings::driving_loop_settings</a></div><div class="ttdeci">driving_loop_args * driving_loop_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00141">uvfr_settings.h:141</a></div></div>
<div class="ttc" id="astructuv__imd__settings_html"><div class="ttname"><a href="structuv__imd__settings.html">uv_imd_settings</a></div><div class="ttdef"><b>Definition:</b> <a href="imd_8h_source.html#l00029">imd.h:29</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_ggaf11e8677926913f2dd803fabbed3455ca0e75e398c2bbcb663eaeb98684ca69d6"><div class="ttname"><a href="group__state__engine__api.html#ggaf11e8677926913f2dd803fabbed3455ca0e75e398c2bbcb663eaeb98684ca69d6">UV_KILL_CMD</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00098">uvfr_state_engine.h:98</a></div></div>
<div class="ttc" id="astructtx__all__settings__args_html_a8e42222b51c2f152869fc760560442b0"><div class="ttname"><a href="structtx__all__settings__args.html#a8e42222b51c2f152869fc760560442b0">tx_all_settings_args::sblock_origin</a></div><div class="ttdeci">uint8_t * sblock_origin</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00036">uvfr_settings.c:36</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ad795c6981571499e4a90ef72698b6ea1"><div class="ttname"><a href="uvfr__settings_8c.html#ad795c6981571499e4a90ef72698b6ea1">default_daq_settings</a></div><div class="ttdeci">struct daq_loop_args default_daq_settings</div><div class="ttdef"><b>Definition:</b> <a href="daq_8c_source.html#l00030">daq.c:30</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694aab474c9db56509a37ee4ee2930849b38"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694aab474c9db56509a37ee4ee2930849b38">ENTER_PROGRAMMING_MODE</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00116">uvfr_settings.h:116</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_gaa3ad3e8df75177c00265881c16563212"><div class="ttname"><a href="group__state__engine__api.html#gaa3ad3e8df75177c00265881c16563212">changeVehicleState</a></div><div class="ttdeci">uv_status changeVehicleState(uint16_t state)</div><div class="ttdoc">Function for changing the state of the vehicle, as well as the list of active + inactive tasks.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8c_source.html#l00101">uvfr_state_engine.c:101</a></div></div>
<div class="ttc" id="astructuv__task__info_html_ab24dea3bde4de2d839bf15e65c2df0d6"><div class="ttname"><a href="structuv__task__info.html#ab24dea3bde4de2d839bf15e65c2df0d6">uv_task_info::active_states</a></div><div class="ttdeci">uint16_t active_states</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00251">uvfr_state_engine.h:251</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a4313d65a75fd41f3e527b330e7370a5e"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a4313d65a75fd41f3e527b330e7370a5e">REQUEST_JOURNAL_ENTRIES_BY_TIME</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00126">uvfr_settings.h:126</a></div></div>
<div class="ttc" id="auvfr__utils_8h_html_a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9"><div class="ttname"><a href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea93b7493f003cb72e7b6138f2794b58e9">UV_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00167">uvfr_utils.h:167</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a084bd6444fb9817cc88531b879ba571b"><div class="ttname"><a href="uvfr__settings_8h.html#a084bd6444fb9817cc88531b879ba571b">DAQ_PARAMS1_MGROUP</a></div><div class="ttdeci">#define DAQ_PARAMS1_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00074">uvfr_settings.h:74</a></div></div>
<div class="ttc" id="astructtx__journal__args_html"><div class="ttname"><a href="structtx__journal__args.html">tx_journal_args</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00043">uvfr_settings.c:43</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aae3049baf8d0bf80753c7b0da5ec8260"><div class="ttname"><a href="uvfr__settings_8h.html#aae3049baf8d0bf80753c7b0da5ec8260">DAQ_HEAD_ADDR</a></div><div class="ttdeci">#define DAQ_HEAD_ADDR</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00072">uvfr_settings.h:72</a></div></div>
<div class="ttc" id="auvfr__global__config_8h_html_a056c3375923e87e7b3df830ea10295da"><div class="ttname"><a href="uvfr__global__config_8h.html#a056c3375923e87e7b3df830ea10295da">FIRMWARE_PATCH_NUM</a></div><div class="ttdeci">#define FIRMWARE_PATCH_NUM</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__global__config_8h_source.html#l00020">uvfr_global_config.h:20</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aa896deeb35bafb45b994e9c1d0c6500a"><div class="ttname"><a href="uvfr__settings_8h.html#aa896deeb35bafb45b994e9c1d0c6500a">GENERAL_VEH_INFO_MGROUP</a></div><div class="ttdeci">#define GENERAL_VEH_INFO_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00043">uvfr_settings.h:43</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a4610dbfba4a1c427386d906bfc656b77"><div class="ttname"><a href="uvfr__settings_8c.html#a4610dbfba4a1c427386d906bfc656b77">sendAllSettingsWorker</a></div><div class="ttdeci">void sendAllSettingsWorker(void *args)</div><div class="ttdoc">Sub-task that sends all settings from the VCU to the.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l01163">uvfr_settings.c:1163</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_ga99bfc92472cdc99e9005e9d3c792909a"><div class="ttname"><a href="group__state__engine__api.html#ga99bfc92472cdc99e9005e9d3c792909a">uvCreateTask</a></div><div class="ttdeci">struct uv_task_info * uvCreateTask()</div><div class="ttdoc">This function gets called when you want to create a task, and register it with the task register....</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8c_source.html#l00272">uvfr_state_engine.c:272</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aa77056695d9689ca6642d5b7176e33c9"><div class="ttname"><a href="uvfr__settings_8h.html#aa77056695d9689ca6642d5b7176e33c9">PDU_MGROUP</a></div><div class="ttdeci">#define PDU_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00066">uvfr_settings.h:66</a></div></div>
<div class="ttc" id="adriving__loop_8h_html_aa421e50f529a1770ef0b2a00a44a0601"><div class="ttname"><a href="driving__loop_8h.html#aa421e50f529a1770ef0b2a00a44a0601">driving_loop_args</a></div><div class="ttdeci">struct driving_loop_args driving_loop_args</div></div>
<div class="ttc" id="auvfr__settings_8c_html_a53df36781d38254cb6bbe6717e6ebae0"><div class="ttname"><a href="uvfr__settings_8c.html#a53df36781d38254cb6bbe6717e6ebae0">uvCreateTmpSettingsCopy</a></div><div class="ttdeci">void * uvCreateTmpSettingsCopy()</div><div class="ttdoc">Function that creates a temporary copy of the existing settings.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00756">uvfr_settings.c:756</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a14f988f2e948d8f522f0ef04a29762d6"><div class="ttname"><a href="uvfr__settings_8h.html#a14f988f2e948d8f522f0ef04a29762d6">DAQ_HEAD_MGROUP</a></div><div class="ttdeci">#define DAQ_HEAD_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00070">uvfr_settings.h:70</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694acc6ddcaa36bd57e5aec12749cb5ce29c"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694acc6ddcaa36bd57e5aec12749cb5ce29c">HANDSHAKE</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00115">uvfr_settings.h:115</a></div></div>
<div class="ttc" id="astructveh__gen__info_html"><div class="ttname"><a href="structveh__gen__info.html">veh_gen_info</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00099">uvfr_settings.h:99</a></div></div>
<div class="ttc" id="auvfr__utils_8h_html_a71c52c44be11d0980910401cb9b5fb9ea6aa86f67f1dcd70789b27731c3ac4e7a"><div class="ttname"><a href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea6aa86f67f1dcd70789b27731c3ac4e7a">UV_ABORTED</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00170">uvfr_utils.h:170</a></div></div>
<div class="ttc" id="aunionhelper__task__args_html"><div class="ttname"><a href="unionhelper__task__args.html">helper_task_args</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00051">uvfr_settings.c:51</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a7572b56a19346ee479bd66789c616bfb"><div class="ttname"><a href="uvfr__settings_8c.html#a7572b56a19346ee479bd66789c616bfb">uvSendSettingGroup</a></div><div class="ttdeci">uv_status uvSendSettingGroup(uint8_t *origin, uint8_t memgroup, uint8_t m_offset, uint16_t size)</div><div class="ttdoc">Helper function for sending all settings.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l01143">uvfr_settings.c:1143</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a71b4d19fc9194c90d6b546a1b8138902"><div class="ttname"><a href="uvfr__settings_8c.html#a71b4d19fc9194c90d6b546a1b8138902">uvSaveSettingsToFlash</a></div><div class="ttdeci">uv_status uvSaveSettingsToFlash(void *sblock, uint32_t *ecode) PRIVILEGED_FUNCTION</div><div class="ttdoc">Function to save a finished settings block to flash memory.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00574">uvfr_settings.c:574</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a485f41f6d806239622abbac7aef60557"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a485f41f6d806239622abbac7aef60557">DISCARD_NEW_SETTINGS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00129">uvfr_settings.h:129</a></div></div>
<div class="ttc" id="astructuv__task__info_html"><div class="ttname"><a href="structuv__task__info.html">uv_task_info</a></div><div class="ttdoc">This struct is designed to hold neccessary information about an RTOS task that will be managed by uvf...</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00220">uvfr_state_engine.h:220</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a2284c8b3e2b6e434f6a1d322396efdb2"><div class="ttname"><a href="uvfr__settings_8c.html#a2284c8b3e2b6e434f6a1d322396efdb2">uvSBlockCorruptionHandler</a></div><div class="ttdeci">void uvSBlockCorruptionHandler()</div><div class="ttdoc">Function to call when the Sblock Flash has become corrupted somehow.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00511">uvfr_settings.c:511</a></div></div>
<div class="ttc" id="astructuv___c_a_n__msg_html_a3a3fdc7fed06a631fefa58ea44052d8d"><div class="ttname"><a href="structuv___c_a_n__msg.html#a3a3fdc7fed06a631fefa58ea44052d8d">uv_CAN_msg::flags</a></div><div class="ttdeci">uint8_t flags</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00271">uvfr_utils.h:271</a></div></div>
<div class="ttc" id="auvfr__utils_8h_html"><div class="ttname"><a href="uvfr__utils_8h.html">uvfr_utils.h</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_ae385496a129924fb290839da5bfa90a2"><div class="ttname"><a href="uvfr__settings_8h.html#ae385496a129924fb290839da5bfa90a2">DAQ_PARAMS1_ADDR</a></div><div class="ttdeci">#define DAQ_PARAMS1_ADDR</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00076">uvfr_settings.h:76</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a7922bc9d90bb507f9885103792e4343f"><div class="ttname"><a href="uvfr__settings_8c.html#a7922bc9d90bb507f9885103792e4343f">FLASH_NOT_UNLOCKED</a></div><div class="ttdeci">#define FLASH_NOT_UNLOCKED</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00565">uvfr_settings.c:565</a></div></div>
<div class="ttc" id="agroup__uvfr__can__api_html_ga62414944c3b631f57fdd08e467bcf5a4"><div class="ttname"><a href="group__uvfr__can__api.html#ga62414944c3b631f57fdd08e467bcf5a4">uvSendCanMSG</a></div><div class="ttdeci">uv_status uvSendCanMSG(uv_CAN_msg *msg)</div><div class="ttdoc">Function to send CAN message.</div><div class="ttdef"><b>Definition:</b> <a href="can_8c_source.html#l00513">can.c:513</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a36192e27458271ff052029579febb5a1"><div class="ttname"><a href="uvfr__settings_8c.html#a36192e27458271ff052029579febb5a1">uvOverwriteCsr</a></div><div class="ttdeci">uv_status uvOverwriteCsr(void *sblock, uint32_t *csr)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00555">uvfr_settings.c:555</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286"><div class="ttname"><a href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4abed5371c079ef927fb67d8bb8e8aa286">PROGRAMMING</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00084">uvfr_state_engine.h:84</a></div></div>
<div class="ttc" id="astructtx__all__settings__args_html"><div class="ttname"><a href="structtx__all__settings__args.html">tx_all_settings_args</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00035">uvfr_settings.c:35</a></div></div>
<div class="ttc" id="astructdriving__loop__args_html"><div class="ttname"><a href="structdriving__loop__args.html">driving_loop_args</a></div><div class="ttdef"><b>Definition:</b> <a href="driving__loop_8h_source.html#l00108">driving_loop.h:108</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_afa15631878f6d936a1143656f88f3620"><div class="ttname"><a href="uvfr__settings_8c.html#afa15631878f6d936a1143656f88f3620">handleIncomingLaptopMsg</a></div><div class="ttdeci">void handleIncomingLaptopMsg(uv_CAN_msg *msg) PRIVILEGED_FUNCTION</div><div class="ttdoc">Callback function for event where CAN message is received from laptop.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00152">uvfr_settings.c:152</a></div></div>
<div class="ttc" id="aunionhelper__task__args_html_a530fb24214eb4c3733920bf4446eb571"><div class="ttname"><a href="unionhelper__task__args.html#a530fb24214eb4c3733920bf4446eb571">helper_task_args::journal_tx_args</a></div><div class="ttdeci">tx_journal_args journal_tx_args</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00053">uvfr_settings.c:53</a></div></div>
<div class="ttc" id="agroup__state__engine__backend_html_ga5f35b34432afed7f18f91fb8607f096f"><div class="ttname"><a href="group__state__engine__backend.html#ga5f35b34432afed7f18f91fb8607f096f">killSelf</a></div><div class="ttdeci">void killSelf(struct uv_task_info *t)</div><div class="ttdoc">This function is called by a task to nuke itself. Is a wrapper function that is used to do all the di...</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8c_source.html#l00717">uvfr_state_engine.c:717</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a0641c122dc09626011ee339625d1ea63"><div class="ttname"><a href="uvfr__settings_8c.html#a0641c122dc09626011ee339625d1ea63">tx_all_settings_args</a></div><div class="ttdeci">struct tx_all_settings_args tx_all_settings_args</div></div>
<div class="ttc" id="auvfr__settings_8h_html_ab638ad0845e4b5e7007e314c83bc43d5"><div class="ttname"><a href="uvfr__settings_8h.html#ab638ad0845e4b5e7007e314c83bc43d5">BMS_ADDR</a></div><div class="ttdeci">#define BMS_ADDR</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00060">uvfr_settings.h:60</a></div></div>
<div class="ttc" id="adaq_8h_html_ad3bc3bc1c9ab04b22cc999a6f7c82c40"><div class="ttname"><a href="daq_8h.html#ad3bc3bc1c9ab04b22cc999a6f7c82c40">daq_datapoint</a></div><div class="ttdeci">struct daq_datapoint daq_datapoint</div></div>
<div class="ttc" id="astructuv__task__info_html_a5347f41c4b15b2d6b039c339613fde43"><div class="ttname"><a href="structuv__task__info.html#a5347f41c4b15b2d6b039c339613fde43">uv_task_info::task_handle</a></div><div class="ttdeci">TaskHandle_t task_handle</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00239">uvfr_state_engine.h:239</a></div></div>
<div class="ttc" id="astructsetting__helper__task_html_a2db368e63a9cc11c26caa2a0eacfca45"><div class="ttname"><a href="structsetting__helper__task.html#a2db368e63a9cc11c26caa2a0eacfca45">setting_helper_task::args</a></div><div class="ttdeci">helper_task_args args</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00065">uvfr_settings.c:65</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a28e4314b233b9140e73e4fd0bab7e354"><div class="ttname"><a href="uvfr__settings_8c.html#a28e4314b233b9140e73e4fd0bab7e354">default_bms_settings</a></div><div class="ttdeci">bms_settings_t default_bms_settings</div><div class="ttdef"><b>Definition:</b> <a href="bms_8c_source.html#l00012">bms.c:12</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a1c7fecf890841f27a4ca39fc66e8cc1b"><div class="ttname"><a href="uvfr__settings_8c.html#a1c7fecf890841f27a4ca39fc66e8cc1b">mc_default_settings</a></div><div class="ttdeci">struct motor_controller_settings mc_default_settings</div><div class="ttdef"><b>Definition:</b> <a href="motor__controller_8c_source.html#l00014">motor_controller.c:14</a></div></div>
<div class="ttc" id="astructmotor__controller__settings_html"><div class="ttname"><a href="structmotor__controller__settings.html">motor_controller_settings</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00161">uvfr_settings.h:161</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694aefd2ddc079bf62b63b3e5226b9a83ac3"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694aefd2ddc079bf62b63b3e5226b9a83ac3">END_OF_SPECIFIC_PARAMS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00123">uvfr_settings.h:123</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a44daa1a9c68be860616e7bc627d9b8f4"><div class="ttname"><a href="uvfr__settings_8c.html#a44daa1a9c68be860616e7bc627d9b8f4">default_dl_settings</a></div><div class="ttdeci">struct driving_loop_args default_dl_settings</div><div class="ttdef"><b>Definition:</b> <a href="driving__loop_8c_source.html#l00027">driving_loop.c:27</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a9320db4d0509341600bb7584ca595609"><div class="ttname"><a href="uvfr__settings_8c.html#a9320db4d0509341600bb7584ca595609">VCU_TO_LAPTOP_ID</a></div><div class="ttdeci">#define VCU_TO_LAPTOP_ID</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00013">uvfr_settings.c:13</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a10d6e75bc6bdeb4dec495cbfe05682fd"><div class="ttname"><a href="uvfr__settings_8h.html#a10d6e75bc6bdeb4dec495cbfe05682fd">DAQ_PARAMS1_OFFSET</a></div><div class="ttdeci">#define DAQ_PARAMS1_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00075">uvfr_settings.h:75</a></div></div>
<div class="ttc" id="astructsetting__helper__task_html"><div class="ttname"><a href="structsetting__helper__task.html">setting_helper_task</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00059">uvfr_settings.c:59</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a4648237563030182a8309d8c75e12205"><div class="ttname"><a href="uvfr__settings_8c.html#a4648237563030182a8309d8c75e12205">nukeSettings</a></div><div class="ttdeci">void nukeSettings(uv_vehicle_settings **settings_to_delete)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00260">uvfr_settings.c:260</a></div></div>
<div class="ttc" id="agroup__uvfr__can__api_html_ga81adc4a577110ce8fe1158b0dc302cc2"><div class="ttname"><a href="group__uvfr__can__api.html#ga81adc4a577110ce8fe1158b0dc302cc2">insertCANMessageHandler</a></div><div class="ttdeci">void insertCANMessageHandler(uint32_t id, void *handlerfunc)</div><div class="ttdoc">Function to insert an id and function into the lookup table of callback functions.</div><div class="ttdef"><b>Definition:</b> <a href="can_8c_source.html#l00395">can.c:395</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a32dcb66c3240af325158ccd12dcb3c68"><div class="ttname"><a href="uvfr__settings_8c.html#a32dcb66c3240af325158ccd12dcb3c68">_e_uvdata</a></div><div class="ttdeci">PRIVILEGED_DATA uint8_t _e_uvdata</div></div>
<div class="ttc" id="astructuv__task__info_html_a6986d7216c7f889164931b37ab752c29"><div class="ttname"><a href="structuv__task__info.html#a6986d7216c7f889164931b37ab752c29">uv_task_info::deletion_states</a></div><div class="ttdeci">uint16_t deletion_states</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00252">uvfr_state_engine.h:252</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_ae3422980a714e1a061dc8c4685a1d613"><div class="ttname"><a href="uvfr__settings_8h.html#ae3422980a714e1a061dc8c4685a1d613">SETTING_BRANCH_SIZE</a></div><div class="ttdeci">#define SETTING_BRANCH_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00090">uvfr_settings.h:90</a></div></div>
<div class="ttc" id="astructuv19__pdu__settings_html"><div class="ttname"><a href="structuv19__pdu__settings.html">uv19_pdu_settings</a></div><div class="ttdef"><b>Definition:</b> <a href="pdu_8h_source.html#l00014">pdu.h:14</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a9b0e526098fd6c30dc93538edba59405"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a9b0e526098fd6c30dc93538edba59405">REQUEST_ALL_SETTINGS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00124">uvfr_settings.h:124</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a1071bc1cceac3198de98d9c0753044d6"><div class="ttname"><a href="uvfr__settings_8c.html#a1071bc1cceac3198de98d9c0753044d6">default_imd_settings</a></div><div class="ttdeci">struct uv_imd_settings default_imd_settings</div><div class="ttdef"><b>Definition:</b> <a href="imd_8c_source.html#l00065">imd.c:65</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a25a35d43902b9bec03daae2ef17883b1"><div class="ttname"><a href="uvfr__settings_8h.html#a25a35d43902b9bec03daae2ef17883b1">BMS_MGROUP</a></div><div class="ttdeci">#define BMS_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00058">uvfr_settings.h:58</a></div></div>
<div class="ttc" id="astructuv__os__settings_html"><div class="ttname"><a href="structuv__os__settings.html">uv_os_settings</a></div><div class="ttdoc">Settings that dictate state engine behavior.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00177">uvfr_state_engine.h:177</a></div></div>
<div class="ttc" id="astructuv__task__info_html_aafd4e2d916f50b54b99fd02d63831e43"><div class="ttname"><a href="structuv__task__info.html#aafd4e2d916f50b54b99fd02d63831e43">uv_task_info::suspension_states</a></div><div class="ttdeci">uint16_t suspension_states</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00253">uvfr_state_engine.h:253</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ad566fc47eb8eb3464e5b48f088ddbb83"><div class="ttname"><a href="uvfr__settings_8c.html#ad566fc47eb8eb3464e5b48f088ddbb83">is_laptop_connected</a></div><div class="ttdeci">static bool is_laptop_connected</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00084">uvfr_settings.c:84</a></div></div>
<div class="ttc" id="astructdaq__datapoint_html"><div class="ttname"><a href="structdaq__datapoint.html">daq_datapoint</a></div><div class="ttdef"><b>Definition:</b> <a href="daq_8h_source.html#l00073">daq.h:73</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a03566822d1b8893362970a459bd67daf"><div class="ttname"><a href="uvfr__settings_8c.html#a03566822d1b8893362970a459bd67daf">current_vehicle_settings</a></div><div class="ttdeci">uv_vehicle_settings * current_vehicle_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00020">uvfr_settings.c:20</a></div></div>
<div class="ttc" id="auvfr__global__config_8h_html_a2ada82deacaaa65d39fd8431202312e8"><div class="ttname"><a href="uvfr__global__config_8h.html#a2ada82deacaaa65d39fd8431202312e8">FIRMWARE_MINOR_RELEASE</a></div><div class="ttdeci">#define FIRMWARE_MINOR_RELEASE</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__global__config_8h_source.html#l00019">uvfr_global_config.h:19</a></div></div>
<div class="ttc" id="astructuv___c_a_n__msg_html_aec63cc112176da7895d0cfc8b32e6935"><div class="ttname"><a href="structuv___c_a_n__msg.html#aec63cc112176da7895d0cfc8b32e6935">uv_CAN_msg::data</a></div><div class="ttdeci">uint8_t data[8]</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00277">uvfr_utils.h:277</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a95973d7f17e9a5994743b16520f6a136"><div class="ttname"><a href="uvfr__settings_8h.html#a95973d7f17e9a5994743b16520f6a136">BMS_OFFSET</a></div><div class="ttdeci">#define BMS_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00059">uvfr_settings.h:59</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a30c09e445d8f0fbfbdfd1bfa0fcfdc67"><div class="ttname"><a href="uvfr__settings_8c.html#a30c09e445d8f0fbfbdfd1bfa0fcfdc67">uvSetSettingResponseReminder</a></div><div class="ttdeci">uv_status uvSetSettingResponseReminder(uint32_t reminder)</div><div class="ttdoc">This reminds the VCU to shoot off it's own message later when it reboots.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00716">uvfr_settings.c:716</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a66126a25eee9ffcb3c5fa49314fc998b"><div class="ttname"><a href="uvfr__settings_8c.html#a66126a25eee9ffcb3c5fa49314fc998b">uvAwaitLaptopAckMsg</a></div><div class="ttdeci">uv_status uvAwaitLaptopAckMsg()</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00145">uvfr_settings.c:145</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a8336472ba83c36033d7d4511a2e3b53e"><div class="ttname"><a href="uvfr__settings_8h.html#a8336472ba83c36033d7d4511a2e3b53e">PDU_OFFSET</a></div><div class="ttdeci">#define PDU_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00067">uvfr_settings.h:67</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a302a39661f2460e559645419a2ac8258"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a302a39661f2460e559645419a2ac8258">FORCE_RESTORE_FACTORY_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00131">uvfr_settings.h:131</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a2f0cb7e05c1bef0501d585df7c2c6013"><div class="ttname"><a href="uvfr__settings_8c.html#a2f0cb7e05c1bef0501d585df7c2c6013">uvSettingsProgrammerTask</a></div><div class="ttdeci">void uvSettingsProgrammerTask(void *args)</div><div class="ttdoc">This is a task that executes the functionality necessary for vehicle diagnostics.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00864">uvfr_settings.c:864</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_af5ab2cd7ec858145d49d4e585e4bef94"><div class="ttname"><a href="uvfr__settings_8c.html#af5ab2cd7ec858145d49d4e585e4bef94">default_datapoints</a></div><div class="ttdeci">daq_datapoint default_datapoints[]</div><div class="ttdef"><b>Definition:</b> <a href="daq_8c_source.html#l00038">daq.c:38</a></div></div>
<div class="ttc" id="acan_8h_html_aef3770e45bbacbf527fd93dd80eea9b9"><div class="ttname"><a href="can_8h.html#aef3770e45bbacbf527fd93dd80eea9b9">uv_status</a></div><div class="ttdeci">enum uv_status_t uv_status</div><div class="ttdef"><b>Definition:</b> <a href="can_8h_source.html#l00044">can.h:44</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aa990a9c990001dc29a5ee5fdde3773e4"><div class="ttname"><a href="uvfr__settings_8h.html#aa990a9c990001dc29a5ee5fdde3773e4">MOTOR_OFFSET</a></div><div class="ttdeci">#define MOTOR_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00051">uvfr_settings.h:51</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_af8dbf93ac51eb9fdc8911644d096486d"><div class="ttname"><a href="structuv__vehicle__settings.html#af8dbf93ac51eb9fdc8911644d096486d">uv_vehicle_settings::imd_settings</a></div><div class="ttdeci">struct uv_imd_settings * imd_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00143">uvfr_settings.h:143</a></div></div>
<div class="ttc" id="auvfr__utils_8h_html_a657e7e858d8847396634fd9912747f8b"><div class="ttname"><a href="uvfr__utils_8h.html#a657e7e858d8847396634fd9912747f8b">data_size</a></div><div class="ttdeci">const uint8_t data_size[]</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8c_source.html#l00017">uvfr_utils.c:17</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a84fc0703372fd83581befabb9fba3858"><div class="ttname"><a href="uvfr__settings_8c.html#a84fc0703372fd83581befabb9fba3858">uvValidateChecksums</a></div><div class="ttdeci">uv_status uvValidateChecksums(void *sblock)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00495">uvfr_settings.c:495</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_adc9522bb052011b07febe1235d1a4792"><div class="ttname"><a href="uvfr__settings_8c.html#adc9522bb052011b07febe1235d1a4792">uvSettingsInit</a></div><div class="ttdeci">uv_status uvSettingsInit()</div><div class="ttdoc">this function does one thing, and one thing only, it checks if we have custom settings,...</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00334">uvfr_settings.c:334</a></div></div>
<div class="ttc" id="agroup__utility__macros_html_ga0fa9d4460bcee65d79e048b43dc879fd"><div class="ttname"><a href="group__utility__macros.html#ga0fa9d4460bcee65d79e048b43dc879fd">serializeSmallE32</a></div><div class="ttdeci">#define serializeSmallE32(x, d, i)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00085">uvfr_utils.h:85</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_abcf807ab03bef940a111bb64cfffecfa"><div class="ttname"><a href="uvfr__settings_8h.html#abcf807ab03bef940a111bb64cfffecfa">GENERAL_VEH_INFO_OFFSET</a></div><div class="ttdeci">#define GENERAL_VEH_INFO_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00044">uvfr_settings.h:44</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_ae99330d4904337e9a603ad2df6758b95"><div class="ttname"><a href="uvfr__settings_8h.html#ae99330d4904337e9a603ad2df6758b95">IMD_ADDR</a></div><div class="ttdeci">#define IMD_ADDR</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00064">uvfr_settings.h:64</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a1e63b2fed237e9d016b304884c01457b"><div class="ttname"><a href="uvfr__settings_8c.html#a1e63b2fed237e9d016b304884c01457b">POST_CHECKSUM</a></div><div class="ttdeci">#define POST_CHECKSUM</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00569">uvfr_settings.c:569</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_adfd1bb6988b37f38e799bb1f996ac005"><div class="ttname"><a href="uvfr__settings_8c.html#adfd1bb6988b37f38e799bb1f996ac005">uvUpdateTmpSettings</a></div><div class="ttdeci">uv_status uvUpdateTmpSettings(uint8_t *tmp_settings, uint8_t memgroup, uint8_t m_offset, uint8_t size, uint8_t *data)</div><div class="ttdoc">Updates a setting in a temporary SBlock by memory group and offset.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00411">uvfr_settings.c:411</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_af3e753b2f0a1841e5e54714979b93491"><div class="ttname"><a href="uvfr__settings_8c.html#af3e753b2f0a1841e5e54714979b93491">vcu_ack_msg</a></div><div class="ttdeci">const uv_CAN_msg vcu_ack_msg</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00100">uvfr_settings.c:100</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a7c9185b38cc68d3a0c2c205746d25494"><div class="ttname"><a href="uvfr__settings_8c.html#a7c9185b38cc68d3a0c2c205746d25494">_s_uvdata</a></div><div class="ttdeci">PRIVILEGED_DATA uint8_t _s_uvdata</div></div>
<div class="ttc" id="auvfr__utils_8h_html_a92b5ac44171d49acd084c274385a043a"><div class="ttname"><a href="uvfr__utils_8h.html#a92b5ac44171d49acd084c274385a043a">__uvInitPanic</a></div><div class="ttdeci">void __uvInitPanic()</div><div class="ttdoc">Low Level Panic, that does not require the full UVFR utils functionality to be operational.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8c_source.html#l00296">uvfr_utils.c:296</a></div></div>
<div class="ttc" id="astructdaq__loop__args_html_acb7bf20ade7a6544c747aebc165b7faf"><div class="ttname"><a href="structdaq__loop__args.html#acb7bf20ade7a6544c747aebc165b7faf">daq_loop_args::total_params_logged</a></div><div class="ttdeci">uint16_t total_params_logged</div><div class="ttdef"><b>Definition:</b> <a href="daq_8h_source.html#l00087">daq.h:87</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a8e128ab49bfb636a4597802418066784"><div class="ttname"><a href="uvfr__settings_8c.html#a8e128ab49bfb636a4597802418066784">uvForceDefaultReversionUponDeviceReset</a></div><div class="ttdeci">uv_status uvForceDefaultReversionUponDeviceReset()</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00735">uvfr_settings.c:735</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ad2bb778b8a8907a17c87de89f0eea3c0"><div class="ttname"><a href="uvfr__settings_8c.html#ad2bb778b8a8907a17c87de89f0eea3c0">uvTransmitVehicleStatus</a></div><div class="ttdeci">uv_status uvTransmitVehicleStatus()</div><div class="ttdoc">Transmits the status of the vehicle, including errorcodes and similar.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00141">uvfr_settings.c:141</a></div></div>
<div class="ttc" id="astructuv___c_a_n__msg_html_aa74af3745c8b56910d7c309245541d37"><div class="ttname"><a href="structuv___c_a_n__msg.html#aa74af3745c8b56910d7c309245541d37">uv_CAN_msg::dlc</a></div><div class="ttdeci">uint8_t dlc</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00275">uvfr_utils.h:275</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a790b81866b0c7880d2d8fcb39880885a"><div class="ttname"><a href="uvfr__settings_8h.html#a790b81866b0c7880d2d8fcb39880885a">IMD_OFFSET</a></div><div class="ttdeci">#define IMD_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00063">uvfr_settings.h:63</a></div></div>
<div class="ttc" id="astructbms__settings__t_html"><div class="ttname"><a href="structbms__settings__t.html">bms_settings_t</a></div><div class="ttdef"><b>Definition:</b> <a href="bms_8h_source.html#l00013">bms.h:13</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_gga259abff5a03eaf908dc8f03d99f478e4a9ec1eef180c6208b25b08f0526dc5eb8"><div class="ttname"><a href="group__state__engine__api.html#gga259abff5a03eaf908dc8f03d99f478e4a9ec1eef180c6208b25b08f0526dc5eb8">UV_READY</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00083">uvfr_state_engine.h:83</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_aff5e0078d7c880f42cc79e084141a6bd"><div class="ttname"><a href="uvfr__settings_8c.html#aff5e0078d7c880f42cc79e084141a6bd">setting_helper_task</a></div><div class="ttdeci">struct setting_helper_task setting_helper_task</div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a6a386c439058f4464e4b82acd1315258"><div class="ttname"><a href="structuv__vehicle__settings.html#a6a386c439058f4464e4b82acd1315258">uv_vehicle_settings::veh_info</a></div><div class="ttdeci">struct veh_gen_info * veh_info</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00136">uvfr_settings.h:136</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694ad67522ff5c2a93d043e4d26bd905ce34"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ad67522ff5c2a93d043e4d26bd905ce34">REQUEST_VCU_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00117">uvfr_settings.h:117</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a4fc65d72946e3e169f15ed0015fa3d3c"><div class="ttname"><a href="uvfr__settings_8c.html#a4fc65d72946e3e169f15ed0015fa3d3c">PRE_CHECKSUM</a></div><div class="ttdeci">#define PRE_CHECKSUM</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00568">uvfr_settings.c:568</a></div></div>
<div class="ttc" id="astructsetting__helper__task_html_a867ac831a9ae5bbfb2ee7b32d63e8916"><div class="ttname"><a href="structsetting__helper__task.html#a867ac831a9ae5bbfb2ee7b32d63e8916">setting_helper_task::meta_task_handle</a></div><div class="ttdeci">TaskHandle_t meta_task_handle</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00060">uvfr_settings.c:60</a></div></div>
<div class="ttc" id="astructveh__gen__info_html_a4561037fdc0d97cbdac2c5a92a7dd241"><div class="ttname"><a href="structveh__gen__info.html#a4561037fdc0d97cbdac2c5a92a7dd241">veh_gen_info::wheel_size</a></div><div class="ttdeci">uint32_t wheel_size</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00100">uvfr_settings.h:100</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a3e4cc3b6b2019eb461b9cd99ff70f1e7"><div class="ttname"><a href="uvfr__settings_8h.html#a3e4cc3b6b2019eb461b9cd99ff70f1e7">START_OF_USER_FLASH</a></div><div class="ttdeci">#define START_OF_USER_FLASH</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00025">uvfr_settings.h:25</a></div></div>
<div class="ttc" id="auvfr__utils_8h_html_a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0"><div class="ttname"><a href="uvfr__utils_8h.html#a71c52c44be11d0980910401cb9b5fb9ea480ef4e56d17703f0629bfe1e06bc4f0">UV_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00169">uvfr_utils.h:169</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a191aefb9e6f4516a91157e5d6d68205b"><div class="ttname"><a href="structuv__vehicle__settings.html#a191aefb9e6f4516a91157e5d6d68205b">uv_vehicle_settings::daq_param_list</a></div><div class="ttdeci">daq_datapoint * daq_param_list</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00147">uvfr_settings.h:147</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html"><div class="ttname"><a href="structuv__vehicle__settings.html">uv_vehicle_settings</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00135">uvfr_settings.h:135</a></div></div>
<div class="ttc" id="astructdaq__loop__args_html"><div class="ttname"><a href="structdaq__loop__args.html">daq_loop_args</a></div><div class="ttdoc">This struct holds info of what needs to be logged.</div><div class="ttdef"><b>Definition:</b> <a href="daq_8h_source.html#l00086">daq.h:86</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a205322c736d66df92b6d968b53648acb"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a205322c736d66df92b6d968b53648acb">REQUEST_ALL_JOURNAL_ENTRIES</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00125">uvfr_settings.h:125</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a19de39f55cc05851f5fa6a40070681e3"><div class="ttname"><a href="uvfr__settings_8c.html#a19de39f55cc05851f5fa6a40070681e3">child_task_handle</a></div><div class="ttdeci">static TaskHandle_t child_task_handle</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00092">uvfr_settings.c:92</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a550e75d7673e407aad1a5240ff83db23"><div class="ttname"><a href="uvfr__settings_8c.html#a550e75d7673e407aad1a5240ff83db23">default_vehicle</a></div><div class="ttdeci">veh_gen_info default_vehicle</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00072">uvfr_settings.c:72</a></div></div>
<div class="ttc" id="astructuv___c_a_n__msg_html_aae369fbabe3cc5b71a89bb641c24aace"><div class="ttname"><a href="structuv___c_a_n__msg.html#aae369fbabe3cc5b71a89bb641c24aace">uv_CAN_msg::msg_id</a></div><div class="ttdeci">uint32_t msg_id</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00276">uvfr_utils.h:276</a></div></div>
<div class="ttc" id="astructuv__task__info_html_ad157811debce6672bb6d00da7e90b6ca"><div class="ttname"><a href="structuv__task__info.html#ad157811debce6672bb6d00da7e90b6ca">uv_task_info::task_period</a></div><div class="ttdeci">uv_timespan_ms task_period</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00224">uvfr_state_engine.h:224</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a8ad6825ef0a84f2615148dc63202be1f"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a8ad6825ef0a84f2615148dc63202be1f">SAVE_AND_APPLY_NEW_SETTINGS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00128">uvfr_settings.h:128</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_ae0c9377c4f8df54ad4b59d4ac4ab39fe"><div class="ttname"><a href="structuv__vehicle__settings.html#ae0c9377c4f8df54ad4b59d4ac4ab39fe">uv_vehicle_settings::flags</a></div><div class="ttdeci">uint16_t flags</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00152">uvfr_settings.h:152</a></div></div>
<div class="ttc" id="agroup__state__engine__api_html_gga6166ed80f8e3bd62f1e7e6122c8817f6a052e6887345173e8b7556738c28fa920"><div class="ttname"><a href="group__state__engine__api.html#gga6166ed80f8e3bd62f1e7e6122c8817f6a052e6887345173e8b7556738c28fa920">ABOVE_NORMAL</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00140">uvfr_state_engine.h:140</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a4a1aa886008fc488d72c502d5af2aa52"><div class="ttname"><a href="uvfr__settings_8c.html#a4a1aa886008fc488d72c502d5af2aa52">last_contact_with_laptop</a></div><div class="ttdeci">TickType_t last_contact_with_laptop</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00085">uvfr_settings.c:85</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_abdad8cd245f0f77d58548f011775a572"><div class="ttname"><a href="uvfr__settings_8c.html#abdad8cd245f0f77d58548f011775a572">uvSendSpecificParam</a></div><div class="ttdeci">uv_status uvSendSpecificParam(uint8_t *origin, uint8_t mgroup, uint8_t m_offset, uint8_t size)</div><div class="ttdoc">Function that locates a specific setting parameter and sends the value over canbus.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00778">uvfr_settings.c:778</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aaad501c2b79f55f1bbbae030b6a18dcd"><div class="ttname"><a href="uvfr__settings_8h.html#aaad501c2b79f55f1bbbae030b6a18dcd">DRIVING_MGROUP</a></div><div class="ttdeci">#define DRIVING_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00054">uvfr_settings.h:54</a></div></div>
<div class="ttc" id="astructuv__task__info_html_a353ec6bf2c42ab0920f3d1e671e568a3"><div class="ttname"><a href="structuv__task__info.html#a353ec6bf2c42ab0920f3d1e671e568a3">uv_task_info::stack_size</a></div><div class="ttdeci">uint32_t stack_size</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00231">uvfr_state_engine.h:231</a></div></div>
<div class="ttc" id="amain_8h_html"><div class="ttname"><a href="main_8h.html">main.h</a></div><div class="ttdoc">: Header for main.c file. This file contains the common defines of the application.</div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_ad0b0375d2c1674abc6f972eec47e9cb7"><div class="ttname"><a href="structuv__vehicle__settings.html#ad0b0375d2c1674abc6f972eec47e9cb7">uv_vehicle_settings::mc_settings</a></div><div class="ttdeci">struct motor_controller_settings * mc_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00139">uvfr_settings.h:139</a></div></div>
<div class="ttc" id="astructuv__task__info_html_ae255dff9b38fc8c0754085060e8ae699"><div class="ttname"><a href="structuv__task__info.html#ae255dff9b38fc8c0754085060e8ae699">uv_task_info::task_args</a></div><div class="ttdeci">void * task_args</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00243">uvfr_state_engine.h:243</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_afc36afa04b73fc9a1ea92b22e6cb564f"><div class="ttname"><a href="uvfr__settings_8h.html#afc36afa04b73fc9a1ea92b22e6cb564f">DAQ_HEAD_OFFSET</a></div><div class="ttdeci">#define DAQ_HEAD_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00071">uvfr_settings.h:71</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a0be2604cded239f54f4f4ab61460a85c"><div class="ttname"><a href="uvfr__settings_8c.html#a0be2604cded239f54f4f4ab61460a85c">uvValidateFlashSettings</a></div><div class="ttdeci">uv_status uvValidateFlashSettings()</div><div class="ttdoc">Function that looks into the flash memory of the VCU, and determines if a valid set of settings exist...</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00810">uvfr_settings.c:810</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a9a7490c87797ddce618071ea477c8009"><div class="ttname"><a href="uvfr__settings_8c.html#a9a7490c87797ddce618071ea477c8009">tx_journal_args</a></div><div class="ttdeci">struct tx_journal_args tx_journal_args</div></div>
<div class="ttc" id="auvfr__settings_8c_html_a07c6d6c6f641c6fb60600b9bd7efbf7e"><div class="ttname"><a href="uvfr__settings_8c.html#a07c6d6c6f641c6fb60600b9bd7efbf7e">default_pdu_settings</a></div><div class="ttdeci">uv19_pdu_settings default_pdu_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00028">uvfr_settings.c:28</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a90cba009630be4dc991f7de6cbede4d8"><div class="ttname"><a href="uvfr__settings_8c.html#a90cba009630be4dc991f7de6cbede4d8">uvComputeMemRegionChecksum</a></div><div class="ttdeci">uv_status uvComputeMemRegionChecksum(void *sblock, uint32_t *csums, char mregion)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00463">uvfr_settings.c:463</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a06b8e5486501c8fe34e2a1c669e4a01c"><div class="ttname"><a href="uvfr__settings_8c.html#a06b8e5486501c8fe34e2a1c669e4a01c">helper_task_args</a></div><div class="ttdeci">union helper_task_args helper_task_args</div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694ab8a24171d3940ec1ea3160842c3e4b4b"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ab8a24171d3940ec1ea3160842c3e4b4b">CLEAR_FAULTS</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00118">uvfr_settings.h:118</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_ae5fe9f0cb3fad913bd688758c9b24d79"><div class="ttname"><a href="uvfr__settings_8h.html#ae5fe9f0cb3fad913bd688758c9b24d79">IMD_MGROUP</a></div><div class="ttdeci">#define IMD_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00062">uvfr_settings.h:62</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_af0cbf7f4ea57695f3b1d2d3c83844000"><div class="ttname"><a href="uvfr__settings_8c.html#af0cbf7f4ea57695f3b1d2d3c83844000">child_task_active</a></div><div class="ttdeci">static bool child_task_active</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00093">uvfr_settings.c:93</a></div></div>
<div class="ttc" id="agroup__state__engine_html_ga2f58cf65b3566bc390600f877f8bed35"><div class="ttname"><a href="group__state__engine.html#ga2f58cf65b3566bc390600f877f8bed35">vehicle_state</a></div><div class="ttdeci">enum uv_vehicle_state_t vehicle_state</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8c_source.html#l00047">uvfr_state_engine.c:47</a></div></div>
<div class="ttc" id="astructuv___c_a_n__msg_html"><div class="ttname"><a href="structuv___c_a_n__msg.html">uv_CAN_msg</a></div><div class="ttdoc">Representative of a CAN message.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__utils_8h_source.html#l00270">uvfr_utils.h:270</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ae9ab130db00266635709bb7fb72c1844"><div class="ttname"><a href="uvfr__settings_8c.html#ae9ab130db00266635709bb7fb72c1844">uvLoadSettingsFromFlash</a></div><div class="ttdeci">uv_status uvLoadSettingsFromFlash()</div><div class="ttdoc">This loads us some new settings from the flash memory.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00274">uvfr_settings.c:274</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694abe34f5f2d055215f2ff2e2d85401199a"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694abe34f5f2d055215f2ff2e2d85401199a">DISCARD_NEW_SETTINGS_AND_EXIT</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00130">uvfr_settings.h:130</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694ac53400ee472ace47006a18aaaa4a86a0"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ac53400ee472ace47006a18aaaa4a86a0">REQUEST_SPECIFIC_SETTING</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00127">uvfr_settings.h:127</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a6caecf0c9fd669e421c4005600d81b71"><div class="ttname"><a href="structuv__vehicle__settings.html#a6caecf0c9fd669e421c4005600d81b71">uv_vehicle_settings::daq_settings</a></div><div class="ttdeci">daq_loop_args * daq_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00146">uvfr_settings.h:146</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694ad99a8ce3d129dcc56d82ee11b0610f18"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694ad99a8ce3d129dcc56d82ee11b0610f18">GENERIC_ACK</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00120">uvfr_settings.h:120</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_ae727eadb1cf71a3feeb12b7bb2eb83d5"><div class="ttname"><a href="uvfr__settings_8h.html#ae727eadb1cf71a3feeb12b7bb2eb83d5">OS_SETTINGS_MGROUP</a></div><div class="ttdeci">#define OS_SETTINGS_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00046">uvfr_settings.h:46</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aa81180ef8eb37ec6e7d99d706610680d"><div class="ttname"><a href="uvfr__settings_8h.html#aa81180ef8eb37ec6e7d99d706610680d">TOP_OF_FLASH_SBLOCK</a></div><div class="ttdeci">#define TOP_OF_FLASH_SBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00027">uvfr_settings.h:27</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aeee8696051cb8180af8de030b0927694a7091f0610d47127e952576fcf2d72eac"><div class="ttname"><a href="uvfr__settings_8h.html#aeee8696051cb8180af8de030b0927694a7091f0610d47127e952576fcf2d72eac">SET_SPECIFIC_PARAM</a></div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00122">uvfr_settings.h:122</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a0acc0e528de17ca0616ca14d82e92ba5"><div class="ttname"><a href="uvfr__settings_8c.html#a0acc0e528de17ca0616ca14d82e92ba5">INVALID_SBLOCK</a></div><div class="ttdeci">#define INVALID_SBLOCK</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00564">uvfr_settings.c:564</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a6726b669a3c5795c3326238ab974f382"><div class="ttname"><a href="uvfr__settings_8c.html#a6726b669a3c5795c3326238ab974f382">ptask_handle</a></div><div class="ttdeci">static TaskHandle_t ptask_handle</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00090">uvfr_settings.c:90</a></div></div>
<div class="ttc" id="astructuv__task__info_html_aff45751f7189980589d55379d1d5a355"><div class="ttname"><a href="structuv__task__info.html#aff45751f7189980589d55379d1d5a355">uv_task_info::task_priority</a></div><div class="ttdeci">osPriority task_priority</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00228">uvfr_state_engine.h:228</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_aec8886c47c65892251b444760cb30116"><div class="ttname"><a href="uvfr__settings_8c.html#aec8886c47c65892251b444760cb30116">uvComputeChunkChecksum</a></div><div class="ttdeci">uint32_t uvComputeChunkChecksum(uint32_t *chunk)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00448">uvfr_settings.c:448</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_aad0db57c7f8c7937be54192d7b74bdcf"><div class="ttname"><a href="uvfr__settings_8h.html#aad0db57c7f8c7937be54192d7b74bdcf">MOTOR_MGROUP</a></div><div class="ttdeci">#define MOTOR_MGROUP</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00050">uvfr_settings.h:50</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ac9480e8bfbccfda4b4c7316bdb55ba87"><div class="ttname"><a href="uvfr__settings_8c.html#ac9480e8bfbccfda4b4c7316bdb55ba87">uvResetFlashToDefault</a></div><div class="ttdeci">uv_status uvResetFlashToDefault()</div></div>
<div class="ttc" id="auvfr__settings_8h_html_a3a57af5c3275b2f53fa64274b11e8d52"><div class="ttname"><a href="uvfr__settings_8h.html#a3a57af5c3275b2f53fa64274b11e8d52">CRC_POLY</a></div><div class="ttdeci">#define CRC_POLY</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00092">uvfr_settings.h:92</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a632dfb21b35fd170c003515ef4bdc291"><div class="ttname"><a href="uvfr__settings_8c.html#a632dfb21b35fd170c003515ef4bdc291">sendJournalWorker</a></div><div class="ttdeci">void sendJournalWorker(void *args)</div><div class="ttdoc">Sub-task that reads out the journal.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l01226">uvfr_settings.c:1226</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_af7c7d49fd92c65119717ab40db8725f5"><div class="ttname"><a href="uvfr__settings_8c.html#af7c7d49fd92c65119717ab40db8725f5">vcu_ack_failed_msg</a></div><div class="ttdeci">const uv_CAN_msg vcu_ack_failed_msg</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00111">uvfr_settings.c:111</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a54061e5993a5517320d425f44408cc86"><div class="ttname"><a href="uvfr__settings_8h.html#a54061e5993a5517320d425f44408cc86">MAGIC_NUMBER</a></div><div class="ttdeci">#define MAGIC_NUMBER</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00096">uvfr_settings.h:96</a></div></div>
<div class="ttc" id="agroup__state__engine_html_gad9e02be6d2d0bc1ab5cd9fd8cae34230"><div class="ttname"><a href="group__state__engine.html#gad9e02be6d2d0bc1ab5cd9fd8cae34230">default_os_settings</a></div><div class="ttdeci">struct uv_os_settings default_os_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8c_source.html#l00057">uvfr_state_engine.c:57</a></div></div>
<div class="ttc" id="astructtx__journal__args_html_a47ca8e1495cb07e794ea926dedff2da7"><div class="ttname"><a href="structtx__journal__args.html#a47ca8e1495cb07e794ea926dedff2da7">tx_journal_args::start_time</a></div><div class="ttdeci">uint32_t start_time</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00044">uvfr_settings.c:44</a></div></div>
<div class="ttc" id="astructuv__vehicle__settings_html_a01bbfda07b06d31224993ddf9745d285"><div class="ttname"><a href="structuv__vehicle__settings.html#a01bbfda07b06d31224993ddf9745d285">uv_vehicle_settings::pdu_settings</a></div><div class="ttdeci">struct uv19_pdu_settings * pdu_settings</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00149">uvfr_settings.h:149</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_add1ebdaa7f93f2a43ca6afc6e05fdd44"><div class="ttname"><a href="uvfr__settings_8c.html#add1ebdaa7f93f2a43ca6afc6e05fdd44">setupDefaultSettings</a></div><div class="ttdeci">uv_status setupDefaultSettings()</div><div class="ttdoc">Function that allocates the neccessary space for all the vehicle settings, and handles sets all of th...</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00232">uvfr_settings.c:232</a></div></div>
<div class="ttc" id="astructuv__task__info_html_ad24b438130bb3098ee5e855222dff21d"><div class="ttname"><a href="structuv__task__info.html#ad24b438130bb3098ee5e855222dff21d">uv_task_info::task_name</a></div><div class="ttdeci">char * task_name</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__state__engine_8h_source.html#l00222">uvfr_state_engine.h:222</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a854e0900506f03ff53ff3ed1a9dc97ca"><div class="ttname"><a href="uvfr__settings_8c.html#a854e0900506f03ff53ff3ed1a9dc97ca">settingCopy</a></div><div class="ttdeci">static void settingCopy(uint8_t *from, uint8_t *to, uint16_t length) PRIVILEGED_FUNCTION</div><div class="ttdoc">Internal function that is used to copy an arbitrary amount of data from point A to point B.</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00128">uvfr_settings.c:128</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_a0202712190ca1bce6a198dd196f48c4b"><div class="ttname"><a href="uvfr__settings_8c.html#a0202712190ca1bce6a198dd196f48c4b">DID_NOT_FINISH_PROGRAMMING</a></div><div class="ttdeci">#define DID_NOT_FINISH_PROGRAMMING</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00566">uvfr_settings.c:566</a></div></div>
<div class="ttc" id="astructtx__journal__args_html_a170540474cdd1a431f8e257d5a70c4ac"><div class="ttname"><a href="structtx__journal__args.html#a170540474cdd1a431f8e257d5a70c4ac">tx_journal_args::end_time</a></div><div class="ttdeci">uint32_t end_time</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00045">uvfr_settings.c:45</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a1af6d32a5f9f7c214731b3cdde2ae48d"><div class="ttname"><a href="uvfr__settings_8h.html#a1af6d32a5f9f7c214731b3cdde2ae48d">FLASH_SBLOCK_START</a></div><div class="ttdeci">#define FLASH_SBLOCK_START</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00037">uvfr_settings.h:37</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_ae9b3336d2f9087deea03d9adac5d06fd"><div class="ttname"><a href="uvfr__settings_8c.html#ae9b3336d2f9087deea03d9adac5d06fd">DATA_MISMATCH</a></div><div class="ttdeci">#define DATA_MISMATCH</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00567">uvfr_settings.c:567</a></div></div>
<div class="ttc" id="auvfr__settings_8c_html_aee72930bcdad229cbe8a8adb73e4a3b3"><div class="ttname"><a href="uvfr__settings_8c.html#aee72930bcdad229cbe8a8adb73e4a3b3">uvComputeSettingsChecksums</a></div><div class="ttdeci">uv_status uvComputeSettingsChecksums(void *sblock, uint32_t *csums)</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00472">uvfr_settings.c:472</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a16f051ea34ee4f4965e4d11f3745d742"><div class="ttname"><a href="uvfr__settings_8h.html#a16f051ea34ee4f4965e4d11f3745d742">DRIVING_OFFSET</a></div><div class="ttdeci">#define DRIVING_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00055">uvfr_settings.h:55</a></div></div>
<div class="ttc" id="aunionhelper__task__args_html_a083dff2889a9c9006875745783ed5f45"><div class="ttname"><a href="unionhelper__task__args.html#a083dff2889a9c9006875745783ed5f45">helper_task_args::setting_tx_args</a></div><div class="ttdeci">tx_all_settings_args setting_tx_args</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8c_source.html#l00052">uvfr_settings.c:52</a></div></div>
<div class="ttc" id="auvfr__settings_8h_html_a012d0d54f18a0eeee83d89f5786db5d5"><div class="ttname"><a href="uvfr__settings_8h.html#a012d0d54f18a0eeee83d89f5786db5d5">OS_SETTINGS_OFFSET</a></div><div class="ttdeci">#define OS_SETTINGS_OFFSET</div><div class="ttdef"><b>Definition:</b> <a href="uvfr__settings_8h_source.html#l00047">uvfr_settings.h:47</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li><li class="navelem"><a class="el" href="uvfr__settings_8c.html">uvfr_settings.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
